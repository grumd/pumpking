var $=Object.defineProperty;var q=(r,i,a)=>i in r?$(r,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[i]=a;var d=(r,i,a)=>(q(r,typeof i!="symbol"?i+"":i,a),a);import{i as O,j as e,u as D,at as z,au as g,G as W,a9 as T,r as p,av as V,Q as G,N as K,e as F,af as w,ae as j,aw as U,a7 as v,ax as X,aa as Y,ab as Q,ac as J,ad as Z,a0 as N,ay as b,a2 as ee,ap as se,R as ae,az as re,ag as k,ah as R,ai as L,a4 as te,S as ie}from"./index-149cb18e.js";import{c as u}from"./index-917c6aae.js";import{_ as ne}from"./Tooltip-22e88da0.js";import{a as le,G as ce,D as oe}from"./GradesGraph-21810e59.js";import{w as de,p as he,L as y,C,a as S,P as xe,R as me}from"./PlayerCompareSelect-79fa0240.js";import{T as pe}from"./Toggle-46de169c.js";import{R as E,X as P,Y as A,p as je,T as M}from"./BarChart-b57a1aeb.js";const ve=O.memo(function({grade:i}){return!i||i==="?"?null:e.jsx("img",{src:`/grades/${i}.png`,alt:i})});function fe(){const r=D();return e.jsxs("div",{className:"faq-exp",children:[r.EXP_FAQ,r.EXP_TITLES_LIST_HEADER,e.jsx("div",{className:"ranks-list",children:z.map(i=>e.jsxs("div",{className:"rank",children:[e.jsx("div",{className:"exp-rank",children:g(i)}),e.jsx("div",{className:"threshold",children:i.threshold})]},i.threshold))})]})}function Ne(r){return W({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}}]})(r)}const ge=T(r=>({charts:r.results.sharedCharts}),{fetchJson:X})(({playerId:r,charts:i,fetchJson:a})=>{const[s,l]=p.useState(!1),[n,h]=p.useState(10),[t,x]=p.useState([]),m=D();return p.useEffect(()=>{l(!0),a({url:`${V}/player/${r}/mostPlayed?limit=${n}`}).then(c=>{l(!1),c.success&&x(c.data)}).catch(()=>{l(!1)})},[r,n,a]),e.jsxs("div",{className:"most-played",children:[s&&e.jsx(G,{}),t.map(c=>{const o=i[c.shared_chart];return o?e.jsxs("div",{className:"chart",children:[e.jsxs("div",{className:u("chart-name",{single:o.chartType==="S",singlep:o.chartType==="SP",doublep:o.chartType==="DP",double:o.chartType==="D",coop:o.chartType==="COOP"}),children:[e.jsx("span",{className:"chart-letter",children:o.chartType}),e.jsx("span",{className:"chart-number",children:o.chartLevel})]}),e.jsx("div",{className:"song-name",children:e.jsx(K,{exact:!0,to:F.leaderboard.sharedChart.getPath({sharedChartId:o.sharedChartId}),children:o.song})}),e.jsx("div",{className:"date",children:c.latestDate?w(m,j(c.latestDate)):null}),e.jsxs("div",{className:"playcount",children:[e.jsx(U,{}),e.jsx("span",{children:c.count})]})]},c.shared_chart):null}),n===v.size(t)&&e.jsxs("button",{className:"show-more btn btn-sm btn-dark btn-icon",onClick:()=>h(n+10),children:[e.jsx(Ne,{})," ",m.SHOW_MORE]})]})}),_=void 0,H=he("id"),ue=(r,i)=>({profile:H(r,i),tracklist:r.tracklist.data,filter:r.profiles.filter,error:r.charts.error||r.tracklist.error,sharedCharts:r.results.sharedCharts,isLoading:r.charts.isLoading||r.results.isLoadingRanking||r.tracklist.isLoading}),be={fetchChartsData:Y,setProfilesFilter:Q,resetProfilesFilter:J};class f extends p.Component{constructor(){super(...arguments);d(this,"state",{isLevelGraphCombined:!0,showFaq:!1});d(this,"onRefresh",()=>{const{isLoading:a}=this.props;!a&&this.props.fetchChartsData()});d(this,"onChangeDayRange",a=>{const{filter:s}=this.props;this.props.setProfilesFilter({...s,dayRange:a})});d(this,"onShowFaq",()=>{this.setState({showFaq:!0})});d(this,"onHideFaq",()=>{this.setState({showFaq:!1})});d(this,"circleShape",a=>e.jsx("circle",{cx:a.cx,cy:a.cy,r:4,fill:a.fill},a.key))}componentWillUnmount(){this.props.resetProfilesFilter()}renderRankingHistory(){const{profile:a}=this.props;return e.jsx(E,{minHeight:_,aspect:1.6,children:e.jsxs(y,{data:a.ratingChanges,margin:{top:5,bottom:5,right:5,left:0},children:[e.jsx(C,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"date",type:"number",domain:["dataMin","dataMax"],tickFormatter:s=>j(s).toLocaleDateString()}),e.jsx(A,{allowDecimals:!1,domain:["dataMin - 100","dataMax + 100"],tickFormatter:Math.round,width:40}),e.jsx(je,{y:1e3,stroke:"white"}),e.jsx(M,{isAnimationActive:!1,content:({payload:s})=>!s||!s[0]?null:e.jsxs("div",{className:"history-tooltip",children:[e.jsx("div",{children:j(s[0].payload.date).toLocaleDateString()}),s&&s[0]&&e.jsxs("div",{children:["Rating: ",Math.round(s[0].value)]})]})}),e.jsx(S,{type:"monotone",isAnimationActive:!1,dataKey:"rating",stroke:"#88d3ff",strokeWidth:3,dot:!1})]})})}renderPlaceHistory(){const{profile:a}=this.props;return e.jsx(E,{minHeight:_,aspect:1.6,children:e.jsxs(y,{data:a.placesChanges,margin:{top:5,bottom:5,right:5,left:0},children:[e.jsx(C,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"date",type:"number",domain:["dataMin","dataMax"],tickFormatter:s=>j(s).toLocaleDateString()}),e.jsx(A,{allowDecimals:!1,domain:[1,s=>s<3?s+2:s+1],interval:0,reversed:!0,width:40}),e.jsx(M,{isAnimationActive:!1,content:({payload:s})=>!s||!s[0]?null:e.jsxs("div",{className:"history-tooltip",children:[e.jsx("div",{children:j(s[0].payload.date).toLocaleDateString()}),s&&s[0]&&e.jsxs("div",{children:["Place: #",s[0].value]})]})}),e.jsx(S,{isAnimationActive:!1,type:"stepAfter",dataKey:"place",stroke:"#88d3ff",strokeWidth:3,dot:!1})]})})}renderGrades(){return e.jsx(le,{})}renderGradesWithLevels(){return e.jsx(ce,{})}renderLevels(){return e.jsx(oe,{})}renderGradeBlock(a,s){const{profile:l}=this.props,n=l.progress[a],h=a==="double"?"D":"S",t=Math.floor((n[`${s}-bonus-level-coef`]||0)*100),x=n[`${s}-bonus-level-min-number`],m=n[`${s}-bonus-level-achieved-number`],c=n[`${s}-bonus-level`]?`${h}${n[`${s}-bonus-level`]}`:"?";return e.jsxs("div",{className:"grade-block",children:[e.jsx("div",{className:"grade-letter",children:e.jsx(ve,{grade:s})}),e.jsx("div",{className:"grade-level",children:c}),e.jsxs("div",{className:"grade-progress",children:[t,"% (",t===100?x:m,"/",x,")"]}),e.jsx("div",{className:u("progress-background",{complete:t===100,zero:t===0}),style:{height:`${t}%`}})]})}renderAchievement(a,s){const l=b[a].icon,n=b[a].description;return e.jsx(ne,{content:e.jsx("div",{children:n}),tooltipClassName:"pumpking-tooltip achievement-tooltip",children:e.jsxs("div",{className:"ach-block",children:[l&&e.jsx("div",{className:"ach-icon",children:e.jsx(l,{})}),e.jsx("div",{className:"ach-name",children:a}),e.jsx("div",{className:u("progress-background",{complete:s.progress===100,zero:s.progress===0}),style:{height:`${Math.round(s.progress)}%`}})]})},a)}renderResultsByLevelHeader(){const a=this.context,{isLevelGraphCombined:s}=this.state;return e.jsx("div",{className:"toggle-holder",children:e.jsx(pe,{className:"combine-toggle",checked:s,onChange:()=>this.setState(l=>({isLevelGraphCombined:!l.isLevelGraphCombined})),children:a.UNITE_GRAPHS})})}renderResultsByLevelFooter(){const a=this.context,{profile:s}=this.props;return e.jsx("div",{className:"toggle-holder",children:e.jsx(ee,{to:F.profile.resultsByLevel.getPath({id:s.id}),children:e.jsx("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",children:a.MORE_DETAILS})})})}renderProfile(){const a=this.context,{profile:s,filter:l}=this.props,{isLevelGraphCombined:n}=this.state,h=s.expRankNext?(s.exp-s.expRank.threshold)/(s.expRankNext.threshold-s.expRank.threshold):100;return e.jsxs("div",{className:"profile",children:[e.jsxs("div",{className:"profile-header",children:[e.jsxs("div",{className:"profile-name text-with-header",children:[e.jsx("div",{className:"text-header",children:a.PLAYER}),e.jsx("div",{children:s.name})]}),e.jsxs("div",{className:"text-with-header",children:[e.jsx("div",{className:"text-header",children:a.RANK}),e.jsxs("div",{children:["#",s.rank]})]}),e.jsxs("div",{className:"text-with-header",children:[e.jsx("div",{className:"text-header",children:a.PP}),e.jsx("div",{children:Math.floor(s.pp)})]}),e.jsxs("div",{className:"text-with-header",children:[e.jsx("div",{className:"text-header",children:a.LAST_TIME_PLAYED}),e.jsx("div",{children:s.lastResultDate?w(a,s.lastResultDate):a.NEVER})]}),e.jsx("div",{className:"_flex-fill"}),e.jsxs("div",{className:"text-with-header -select",children:[e.jsx("div",{className:"text-header",children:a.COMPARE_WITH}),e.jsx("div",{children:e.jsx(xe,{})})]})]}),e.jsxs("div",{className:"profile-section",children:[e.jsxs("div",{className:"profile-sm-section-header _flex-row _align-center",children:[e.jsx("span",{children:a.EXP}),e.jsx("div",{className:"_flex-fill"}),e.jsx("div",{onClick:this.onShowFaq,className:"_clickable",children:e.jsx(se,{onClick:this.onShowFaq})}),e.jsxs(ae,{ariaHideApp:!1,className:"Modal faq-modal",overlayClassName:"Overlay",isOpen:this.state.showFaq,onRequestClose:this.onHideFaq,children:[e.jsx("div",{className:"close-btn",onClick:this.onHideFaq,children:e.jsx(re,{})})," ",e.jsx(fe,{})]})]}),e.jsxs("div",{className:"exp-range",children:[e.jsxs("div",{className:"rank exp-rank",children:[g(s.expRank),s.expRank&&e.jsx("div",{children:s.expRank.threshold})]}),e.jsxs("div",{className:"exp-line-with-label",children:[e.jsx("div",{className:"exp-label",children:s.expRankNext?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"taken-num",children:Math.round(s.exp-s.expRank.threshold)}),` / ${s.expRankNext.threshold-s.expRank.threshold}`]}):null}),e.jsxs("div",{className:"exp-line",children:[e.jsx("div",{className:"taken",style:{width:Math.floor(100*h)+"%"}}),e.jsx("div",{className:"rest",style:{width:100-Math.ceil(100*h)+"%"}})]}),e.jsxs("div",{className:"exp-label",children:[a.TOTAL,": ",e.jsx("span",{className:"taken-num",children:Math.round(s.exp)})]})]}),s.expRankNext&&e.jsxs("div",{className:"rank exp-rank",children:[g(s.expRankNext),s.expRankNext&&e.jsx("div",{children:s.expRankNext.threshold})]})]})]}),e.jsxs("div",{className:"profile-section-horizontal-container",children:[e.jsx("div",{className:"profile-section",children:e.jsx("div",{className:"profile-section-content",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"profile-section-2",children:[e.jsxs("div",{className:"profile-sm-section-header flex",children:[e.jsx("span",{children:a.GRADES}),this.renderResultsByLevelHeader()]}),e.jsx("div",{className:"chart-container single-double-labels",children:this.renderGradesWithLevels()})]}),this.renderResultsByLevelFooter()]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"profile-section-2",children:[e.jsxs("div",{className:"profile-sm-section-header flex",children:[e.jsx("span",{children:"уровни"}),this.renderResultsByLevelHeader()]}),e.jsx("div",{className:"chart-container",children:this.renderLevels()})]}),e.jsxs("div",{className:"profile-section-2",children:[e.jsx("div",{className:"profile-sm-section-header",children:e.jsx("span",{children:a.GRADES})}),e.jsx("div",{className:"chart-container",children:this.renderGrades()})]}),this.renderResultsByLevelFooter()]})})}),e.jsxs("div",{className:"profile-section",children:[e.jsx("div",{className:"profile-section-content",children:e.jsxs("div",{className:"profile-section-2",children:[e.jsx("div",{className:"profile-sm-section-header",children:e.jsx("span",{children:a.PP})}),e.jsx("div",{className:"chart-container",children:this.renderRankingHistory()})]})}),(()=>{const t=l.dayRange||s.filterRange,x=k(t[0]*1e3*60*60*24).format("L"),m=k(t[1]*1e3*60*60*24).format("L"),c=Math.max(t[0]-1,s.minMaxRange[0]),o=Math.min(t[0]+1,t[1]),B=Math.max(t[1]-1,t[0]),I=Math.min(t[1]+1,s.minMaxRange[1]);return e.jsxs("div",{className:"range-container",children:[e.jsx(me,{range:t,min:s.minMaxRange[0],max:s.minMaxRange[1],onChange:this.onChangeDayRange}),e.jsxs("div",{className:"range-controls _flex-row",children:[e.jsx("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([c,t[1]]),children:e.jsx(R,{})}),e.jsx("span",{className:"date-text",children:x}),e.jsx("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([o,t[1]]),children:e.jsx(L,{})}),e.jsx("div",{className:"_flex-fill"}),e.jsx("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([t[0],B]),children:e.jsx(R,{})}),e.jsx("span",{className:"date-text",children:m}),e.jsx("button",{className:"btn btn-sm btn-dark",onClick:()=>this.onChangeDayRange([t[0],I]),children:e.jsx(L,{})})]})]})})()]})]}),e.jsxs("div",{className:"profile-section progress-section",children:[e.jsx("div",{className:"profile-sm-section-header",children:e.jsx("span",{children:a.LEVEL_ACHIEVEMENTS})}),e.jsxs("div",{className:"progress-blocks-single-double",children:[e.jsx("div",{className:"progress-block",children:e.jsxs("div",{className:"achievements-grades single",children:[this.renderGradeBlock("single","A"),this.renderGradeBlock("single","A+"),this.renderGradeBlock("single","S"),this.renderGradeBlock("single","SS")]})}),e.jsx("div",{className:"progress-block",children:e.jsxs("div",{className:"achievements-grades double",children:[this.renderGradeBlock("double","A"),this.renderGradeBlock("double","A+"),this.renderGradeBlock("double","S"),this.renderGradeBlock("double","SS")]})})]}),e.jsx("div",{className:"bonus-faq",children:a.LEVEL_ACHIEVEMENTS_HINT})]}),e.jsxs("div",{className:"profile-section",children:[e.jsx("div",{className:"profile-sm-section-header",children:e.jsx("span",{children:a.ACHIEVEMENTS})}),e.jsx("div",{className:"achievements",children:v.keys(s.achievements).map(t=>this.renderAchievement(t,s.achievements[t]))})]}),e.jsxs("div",{className:"profile-section",children:[e.jsx("div",{className:"profile-sm-section-header",children:e.jsx("span",{children:a.MOST_PLAYED_CHARTS})}),e.jsx(ge,{playerId:s.id})]})]})}render(){const{isLoading:a,profile:s,error:l}=this.props;te&&console.log("profile:",s);const n=this.context;return e.jsx("div",{className:"profile-page",children:e.jsxs("div",{className:"content",children:[l&&l.message,e.jsxs("div",{className:"top-controls",children:[e.jsx("div",{className:"_flex-fill"}),e.jsxs("button",{disabled:a,className:"btn btn-sm btn-dark btn-icon",onClick:this.onRefresh,children:[e.jsx(ie,{})," ",n.UPDATE]})]}),a&&e.jsx(G,{}),!a&&v.isEmpty(s)&&e.jsx("div",{className:"profile",children:n.PROFILE_NOT_FOUND}),!a&&!v.isEmpty(s)&&this.renderProfile()]})})}}d(f,"contextType",Z),d(f,"propTypes",{profile:N.object,error:N.object,isLoading:N.bool.isRequired}),d(f,"defaultProps",{profile:{}});const ke=de(T(ue,be)(f)),Me=Object.freeze(Object.defineProperty({__proto__:null,default:ke,profileSelector:H},Symbol.toStringTag,{value:"Module"}));export{ve as G,Me as P,H as p};
//# sourceMappingURL=Profile-fa4db648.js.map
