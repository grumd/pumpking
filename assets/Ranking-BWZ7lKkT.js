import{L as I,D as w,E as h,y as k,j as e,Q as O,a7 as F,af as M,aa as N,W as R,ab as C,ao as b,K as _,Y as L,r as S,A as Q,aU as U,aV as D,S as z,z as T,aW as q}from"./index-BZG5Btz3.js";import{_ as m,A as K}from"./fp-ClCvxmp5.js";import{m as W,E as Y}from"./ExpRankImg-Ded03_3d.js";import{F as G}from"./Flex-vYLf67HZ.js";import{u as $}from"./use-disclosure-CAavG6re.js";import{M as B}from"./Modal-BJZB6_B8.js";import{M as V}from"./MultiSelect-B0rir0l8.js";import"./Paper-DxHFABw9.js";const E=()=>{const a=I();return w(h.user.preferencesMutation.mutationOptions({onSuccess:i=>{a.setQueryData(h.user.current.queryKey(),i),a.invalidateQueries(h.charts.search.infiniteQueryFilter())}}))};function X({ranking:a,isLoading:d,preferences:i}){const c=k(),x=E();return e.jsxs("div",{className:"ranking-list",children:[m.isEmpty(a)&&!d&&"ничего не найдено",d&&e.jsx(O,{}),!d&&a&&e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"place",children:c.RANK}),e.jsx("th",{children:c.EXP}),e.jsx("th",{className:"name",children:c.NAME}),e.jsx("th",{className:"name name-piu",children:c.AMPASS}),e.jsx("th",{className:"rating",children:"pp"}),e.jsx("th",{className:"playcount",children:c.PLAYCOUNT}),e.jsx("th",{className:"playcount",children:c.SCORES_count}),e.jsx("th",{className:"accuracy",children:c.ACCURACY}),e.jsx("th",{className:"hide-col",children:" "})]})}),e.jsx("tbody",{children:a.map((s,u)=>{const r=i?.playersHiddenStatus?.[s.id],o=s.region&&i?.hiddenRegions?.[s.region];return(r||o)&&!i?.showHiddenPlayersInRanking?null:e.jsxs("tr",{className:F("player",{"hidden-player":r||o}),children:[e.jsx("td",{className:"place",children:u===0?e.jsx(W,{}):`#${u+1}`}),e.jsx("td",{className:"exp-rank",children:s.exp!=null?e.jsx(Y,{exp:s.exp}):null}),e.jsx("td",{className:"name",children:e.jsxs(G,{gap:"xxs",align:"center",children:[s.region?e.jsx(M,{region:s.region}):null,e.jsx(N,{component:C,to:R.profile.getPath({id:s.id}),children:s.nickname})]})}),e.jsx("td",{className:"name name-piu",children:e.jsx(N,{component:C,to:R.profile.getPath({id:s.id}),children:s.arcade_name})}),e.jsx("td",{className:"rating secondary",children:s.pp!=null?Math.floor(s.pp):""}),e.jsx("td",{className:"playcount",children:s.results_count}),e.jsx("td",{className:"playcount",children:s.best_results_count}),e.jsx("td",{className:"accuracy",children:s.accuracy?`${s.accuracy.toFixed(2)}%`:""}),e.jsx("td",{className:"hide-col",children:e.jsx("div",{className:"switch-wrapper",children:e.jsx(b,{onChange:()=>{i&&x.mutate(m.set(["playersHiddenStatus",s.id],!r,i))},checked:!r})})})]},s.id)})})]})]})}const ce=()=>{const a=k(),d=_(),[i,{open:c,close:x}]=$(!1),{isLoading:s,isFetching:u,error:r,data:o,refetch:H}=L(h.players.stats.queryOptions()),g=E(),n=d.data?.preferences,j=S.useMemo(()=>{if(!o)return[];const t=o.map(l=>l.region).filter(l=>l!==null);return[...new Set(t)].sort()},[o]),y=S.useMemo(()=>n?.hiddenRegions?Object.entries(n.hiddenRegions).filter(([,t])=>t).map(([t])=>t):[],[n?.hiddenRegions]),A=()=>{n&&g.mutate(m.set(["showHiddenPlayersInRanking"],!n.showHiddenPlayersInRanking,n))},v=t=>{if(n){const l=j.reduce((p,f)=>(p[f]=t.includes(f),p),{});g.mutate(m.set(["hiddenRegions"],l,n))}},P=()=>{s||H()};return e.jsxs("div",{className:"ranking-page",children:[e.jsxs("div",{className:"content",children:[r&&r.message,e.jsxs("div",{className:"top-controls",children:[e.jsx(Q,{size:"sm",disabled:u,onClick:P,leftSection:e.jsx(U,{}),children:a.UPDATE}),e.jsx(K,{variant:"subtle",size:"lg",onClick:c,disabled:!n,ml:"auto",children:e.jsx(D,{})})]}),e.jsx(X,{ranking:o,isLoading:s,preferences:n})]}),e.jsx(B,{opened:i,onClose:x,title:a.FILTERS,centered:!0,children:e.jsxs(z,{children:[e.jsx(b,{label:a.SHOW_ALL,checked:n?.showHiddenPlayersInRanking??!1,onChange:A,disabled:!n}),e.jsx(V,{label:a.HIDE_COUNTRIES,placeholder:a.HIDE_COUNTRIES,data:j,value:y,onChange:v,disabled:!n,clearable:!0,searchable:!0,renderOption:({option:t,checked:l})=>e.jsxs(T,{gap:"xs",children:[l&&e.jsx(q,{size:12}),e.jsx(M,{region:t.value,size:"sm"}),t.value]})})]})})]})};export{ce as default};
//# sourceMappingURL=Ranking-BWZ7lKkT.js.map
