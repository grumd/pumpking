import{h as G,d as k,ac as B,j as s,ad as Q,e as q,ae as T,af as Z,ag as W,ah as J,aX as w,r as E,R as S,_ as P,O as V,aa as ss,ab as es,aY as as}from"./index-b3b755ce.js";import{c as r}from"./index-8ebfad7d.js";import{n as H}from"./numeral-f945ad23.js";import{_ as U}from"./Tooltip-694880b7.js";import{F as ls}from"./index-0068a8b9.js";import{G as ns}from"./index-4b6a2fd5.js";import{c as X,O as is,R as cs,B as ts}from"./index.esm-0b8b32c1.js";import{C as ds}from"./ChartLabel-3a0349f0.js";const Y=({res:e,chart:m,placeDifference:u,showPpChange:N,highlightIndex:h,leftProfile:y={},rightProfile:v={},isSocketView:d=!1,bestGradeScore:o=!1,notBestGradeResult:D=!1})=>{const t=G(),b=k(n=>{var x;return(x=n.results.profiles[e.playerId])==null?void 0:x.region}),R=k(n=>{var x,g;return e.playerId===((g=(x=n.user.data)==null?void 0:x.player)==null?void 0:g.id)});let f=null;B?f=s.jsx(s.Fragment,{children:s.jsxs("span",{className:"debug-elo-info",children:[" ",e.pp&&`${e.pp}pp`]})}):N&&e.pp&&(f=s.jsxs(s.Fragment,{children:[" / ",s.jsxs("span",{children:[e.pp,"pp"]})]}));const O=b?s.jsx(ls,{region:b}):null,c=Q(e,m),j=q.profile.getPath({id:e.playerId});return s.jsxs("tr",{className:r({empty:!e.accuracy,latest:new Date(m.latestAddedScoreDate)-new Date(e.dateAdded)<12*60*60*1e3,left:e.nickname===y.name,right:e.nickname===v.name}),style:h>-1?{background:X[h]+"3A",outline:`1px solid ${X[h]}A0`}:{},children:[!d&&s.jsx("td",{className:"place",style:R?{fontWeight:"bold",color:"#ddd"}:{},children:e.isSecondOccurenceInResults?"":e.topPlace&&`#${e.topPlace}`}),s.jsx("td",{className:r("nickname",o&&"opacity"),style:h>-1||R?{fontWeight:"bold"}:{},children:s.jsxs("div",{className:"nickname-container",children:[O,s.jsxs("span",{className:"nickname-text",children:[s.jsx(T,{exact:!0,to:j,children:e.nickname}),!!u&&s.jsxs("span",{className:"change-holder up",children:[s.jsx("span",{children:u}),s.jsx(Z,{})]}),f]}),!d&&s.jsxs("div",{className:"mods-container",children:[d&&e.mods&&e.mods.split(" ").filter(n=>n.includes("AV")).map(n=>s.jsxs("div",{className:"mod av-mod",children:[s.jsx("div",{className:"av-text",children:"AV"}),s.jsx("div",{className:"av-number",children:n.replace("AV","")})]})),d&&e.mods&&e.mods.split(" ").filter(n=>n.endsWith("X")).map(n=>s.jsx("div",{className:"mod x-mod",children:s.jsx("div",{className:"x-number",children:n})})),e.isRank&&s.jsx("div",{className:"mod vj",children:e.mods?"R":"R?"}),e.isHJ&&s.jsx("div",{className:"mod hj",children:"HJ"})]})]})}),s.jsx("td",{className:r("score",o&&"opacity"),children:s.jsx(is,{overlayClassName:"score-overlay-outer",overlayItem:s.jsxs("span",{className:"score-span",children:[e.scoreIncrease>e.score*.8&&"*",H(e.score).format("0,0")]}),placement:"top",children:s.jsxs("div",{className:"score-overlay",children:[s.jsx("div",{children:s.jsx(cs,{resultId:e.id})}),B&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("span",{className:"_grey",children:"result id: "}),e.id]}),s.jsxs("div",{children:[s.jsx("span",{className:"_grey",children:"player id: "}),e.playerId]})]}),s.jsxs("div",{children:[s.jsxs("span",{className:"_grey",children:[t.PLAYER,": "]}),s.jsxs(T,{exact:!0,to:j,children:[e.nickname," (",e.nicknameArcade,")"]})]}),c?s.jsxs("div",{className:"important",children:[s.jsxs("span",{className:"_grey",children:[t.EXP,": "]}),"+",H(c).format("0,0")]}):null,e.pp?s.jsxs("div",{className:"important",children:[s.jsxs("span",{className:"_grey",children:[t.PP,": "]}),s.jsxs("span",{children:[e.pp,"pp"]})]}):null,!e.isExactDate&&s.jsxs("div",{className:"warning",children:[s.jsx(W,{}),t.MY_BEST_SCORE_WARNING]}),e.isExactDate&&s.jsxs(s.Fragment,{children:[e.mods&&s.jsxs("div",{children:[s.jsxs("span",{className:"_grey",children:[t.MODS,": "]}),e.mods]}),e.combo!=null&&s.jsxs("div",{className:"mobile-only",children:[s.jsxs("span",{className:"_grey",children:[t.COMBO,": "]}),e.combo]}),e.calories!=null&&s.jsxs("div",{children:[s.jsxs("span",{className:"_grey",children:[t.CCAL,": "]}),e.calories]}),e.scoreIncrease!=null&&s.jsxs("div",{children:[s.jsxs("span",{className:"_grey",children:[t.SCORE_INCREASE,": "]}),"+",H(e.scoreIncrease).format("0,0")]}),e.originalChartMix&&s.jsxs("div",{children:[s.jsxs("div",{className:"warning",children:[s.jsx(W,{}),t.ORIGINAL_MIX," ",e.originalChartMix]}),e.originalChartLabel&&s.jsxs("div",{children:[s.jsxs("span",{className:"_grey",children:[t.ORIGINAL_CHART," "]}),e.originalChartLabel]}),e.originalScore&&s.jsxs("div",{children:[s.jsxs("span",{className:"_grey",children:[t.ORIGINAL_SCORE," "]}),e.originalScore]})]}),e.scoreIncrease>e.score*.8&&t.SIGHTREAD]})]})})}),s.jsx("td",{className:r("grade",D&&"opacity"),children:s.jsx("div",{className:"img-holder",children:s.jsx(ns,{grade:e.grade})})}),d&&s.jsx("td",{className:r("mods",{vj:e.isRank,hj:e.isHJ}),children:s.jsxs("div",{className:"mods-container",children:[d&&e.mods&&e.mods.filter(n=>n.includes("AV")).map(n=>s.jsxs("div",{className:"av-mod",children:[s.jsx("div",{className:"av-text",children:"AV"}),s.jsx("div",{className:"av-number",children:n.replace("AV","")})]})),d&&e.mods&&e.mods.split(" ").filter(n=>n.endsWith("X")).map(n=>s.jsx("div",{className:"x-mod",children:s.jsx("div",{className:"x-number",children:n})})),e.isRank&&s.jsx("div",{className:"inner",children:e.isExactDate?"R":"R?"}),e.isHJ&&s.jsx("div",{className:"inner",children:"HJ"})]})}),s.jsx("td",{className:r("number","miss",o&&"opacity"),children:e.miss}),s.jsx("td",{className:r("number","bad",o&&"opacity"),children:e.bad}),s.jsx("td",{className:r("number","good",o&&"opacity"),children:e.good}),s.jsx("td",{className:r("number","great",o&&"opacity"),children:e.great}),s.jsx("td",{className:r("number","perfect",o&&"opacity"),children:e.perfect}),s.jsx("td",{className:r("combo","desktop-only",o&&"opacity"),children:e.combo&&`${e.combo}x`}),s.jsx("td",{className:r("accuracy",o&&"opacity"),children:e.accuracy?s.jsxs(U,{content:`Phoenix score: ${Math.floor(e.accuracyRaw*1e4)}`,tooltipClassName:"pumpking-tooltip",children:[e.accuracy===100?100:e.accuracy.toFixed(2),"%"]}):null}),s.jsx("td",{className:r("date",{latest:e.isLatestScore,opacity:o}),children:d?J(t,e.dateObject):s.jsxs(U,{content:w(t,e),tooltipClassName:"pumpking-tooltip",children:[J(t,e.dateObject),e.isExactDate?"":"?"]})})]},e.id)};const rs=({children:e,count:m})=>{const[u,N]=E.useState(!0),h=G();return u&&m>1?s.jsx("tr",{className:"results-collapser",onClick:()=>N(!1),children:s.jsx("td",{colSpan:"20",children:s.jsx("div",{children:s.jsx("button",{children:m&&h.SHOW_MORE_RESULTS?s.jsx(s.Fragment,{children:h.SHOW_MORE_RESULTS(m)}):s.jsx(ts,{})})})})}):s.jsx(s.Fragment,{children:e})},os=S.createContext([]),fs=S.forwardRef(({playersHiddenStatus:e,showHiddenPlayers:m=!1,showProtagonistPpChange:u=!1,uniqueSelectedNames:N=[],protagonistName:h=null,leftProfile:y={},rightProfile:v={},isSocketView:d=!1,chartIndex:o,chart:D},t)=>{const b=k(a=>{var l,i;return(i=(l=a.user.data)==null?void 0:l.player)==null?void 0:i.id}),R=k(a=>a.preferences.data.playersHiddenStatus),f=e||R||{},O=E.useContext(os),c=D||O[o],[j,n]=E.useState(!m),x=G();E.useEffect(()=>{n(!m)},[m]);let g=1;const $=[];let C=0;const M=c.results.map((a,l,i)=>{const F=!(a.nickname===h)&&j&&(f[a.playerId]||!1),I=$.includes(a.nickname);$.push(a.nickname);let _=0;if(a.scoreIncrease&&a.dateAdded===c.latestAddedScoreDate){const L=a.score-a.scoreIncrease;_=P.findLastIndex(K=>K.score>L,i)-l}return l===0?g=1:!I&&a.score!==P.get([l-1,"score"],i)&&(g+=1),F&&C++,{...a,topPlace:g,isSecondOccurenceInResults:I,isPlayerHidden:F,highlightIndex:N.indexOf(a.nickname),isProtagonist:a.nickname===h,placeDifference:_,isLatestScore:a.dateAdded===c.latestAddedScoreDate}}).filter((a,l)=>!(a.isPlayerHidden||a.isUnknownPlayer&&l!==0)).map((a,l,i)=>{const p=A=>A.playerId===b||A.isLatestScore||A.highlightIndex>-1,I=p(a),_=i.slice(l+1,l+1+2).some(p),L=i.slice(l-2,l).some(p);return{...a,isCollapsible:!I&&!_&&!L}}),z=M.reduce((a,l)=>(a.length?a[a.length-1].isGroupCollapsible!==l.isCollapsible?a.push({isGroupCollapsible:l.isCollapsible,results:[l]}):a[a.length-1].results.push(l):a.push({isGroupCollapsible:l.isCollapsible,results:[l]}),a),[]);return s.jsxs("div",{className:"song-block",ref:t,children:[s.jsxs("div",{className:"song-name",children:[s.jsx(ds,{type:c.chartType,level:c.chartLevel}),d?s.jsxs("div",{className:"song-name-text",children:[c.difficulty?`(${c.difficulty.toFixed(1)}) `:"",c.song]}):s.jsxs("div",{className:"song-name-text",children:[s.jsx(V,{exact:!0,to:q.leaderboard.sharedChart.getPath({sharedChartId:c.sharedChartId}),children:c.song})," ",s.jsx("span",{className:"_grey-text",children:c.difficulty?`(${c.difficulty.toFixed(1)}) `:""})]}),!d&&s.jsx("div",{className:"youtube-link",children:s.jsx("a",{href:`https://youtube.com/results?${ss.stringify({search_query:`${c.song} ${c.chartLabel}`.replace(/( -)|(- )/g," ")})}`,target:"_blank",rel:"noopener noreferrer",children:s.jsx(es,{})})}),s.jsx("div",{className:"_flex-fill"}),s.jsxs("div",{className:"right-side-block",children:[C>0&&s.jsxs("div",{className:r("players-hidden-count _grey-text",{"_on-hover":!d}),children:[x.HIDDEN,": ",C]}),(C>0||!j)&&!d&&s.jsx("div",{className:"globe-icon _on-hover",onClick:()=>n(!j),children:s.jsx(as,{})})]})]}),s.jsx("div",{className:"charts",children:!P.isEmpty(M)&&s.jsx("div",{className:"chart",children:s.jsx("div",{className:"results",children:s.jsx("table",{children:s.jsx("tbody",{children:z.map(a=>{const l=a.results.map(i=>{const p=i.isProtagonist&&u;return s.jsxs(S.Fragment,{children:[s.jsx(Y,{chart:c,res:i,placeDifference:i.placeDifference,showPpChange:p,highlightIndex:i.highlightIndex,leftProfile:y,rightProfile:v,isSocketView:d,notBestGradeResult:!!i.bestGradeResult}),i.bestGradeResult&&s.jsx(Y,{chart:c,res:i.bestGradeResult,placeDifference:i.placeDifference,showPpChange:p,highlightIndex:i.highlightIndex,leftProfile:y,rightProfile:v,isSocketView:d,bestGradeScore:!0})]},i.isRank+"_"+i.nickname)});return a.isGroupCollapsible?s.jsx(rs,{count:l.length,children:l}):s.jsx(s.Fragment,{children:l})})})})})})})]})});export{fs as C,os as F};
//# sourceMappingURL=Chart-24be986f.js.map
