{"version":3,"file":"Ranking-BVbIMWZA.js","sources":["../../src/hooks/usePreferencesMutation.ts","../../src/features/ranking/components/RankingList.tsx","../../src/features/ranking/Ranking.tsx"],"sourcesContent":["import type { ApiInputs, ApiOutputs } from '@/api/trpc/router';\nimport { type UseMutationResult, useMutation, useQueryClient } from '@tanstack/react-query';\n\nimport { api } from 'utils/trpc';\n\nexport const usePreferencesMutation = (): UseMutationResult<\n  ApiOutputs['user']['preferencesMutation'],\n  unknown,\n  ApiInputs['user']['preferencesMutation'],\n  undefined\n> => {\n  const queryClient = useQueryClient();\n\n  const preferencesMutation = useMutation(\n    api.user.preferencesMutation.mutationOptions({\n      onSuccess: (newUser) => {\n        queryClient.setQueryData(api.user.current.queryKey(), newUser);\n        queryClient.invalidateQueries(api.charts.search.infiniteQueryFilter());\n      },\n    })\n  );\n\n  return preferencesMutation;\n};\n","import type { ApiOutputs } from '@/api/trpc/router';\nimport { Anchor, Flex, Switch } from '@mantine/core';\nimport classNames from 'classnames';\nimport _ from 'lodash/fp';\nimport { GiQueenCrown } from 'react-icons/gi';\nimport { NavLink } from 'react-router-dom';\n\nimport { ExpRankImg } from 'components/ExpRankImg/ExpRankImg';\nimport { Flag } from 'components/Flag/Flag';\nimport Loader from 'components/Loader/Loader';\n\nimport { routes } from 'constants/routes';\n\nimport { usePreferencesMutation } from 'hooks/usePreferencesMutation';\n\nimport { useLanguage } from 'utils/context/translation';\n\ntype PlayerStats = ApiOutputs['players']['stats'][number];\ntype UserData = ApiOutputs['user']['current'];\ntype Preferences = NonNullable<UserData>['preferences'];\n\ninterface RankingListProps {\n  ranking: PlayerStats[] | undefined;\n  isLoading: boolean;\n  preferences: Preferences | undefined;\n}\n\nexport default function RankingList({ ranking, isLoading, preferences }: RankingListProps) {\n  const lang = useLanguage();\n  const preferencesMutation = usePreferencesMutation();\n\n  return (\n    <div className=\"ranking-list\">\n      {_.isEmpty(ranking) && !isLoading && 'ничего не найдено'}\n      {isLoading && <Loader />}\n      {!isLoading && ranking && (\n        <table>\n          <thead>\n            <tr>\n              <th className=\"place\">{lang.RANK}</th>\n              <th>{lang.EXP}</th>\n              <th className=\"name\">{lang.NAME}</th>\n              <th className=\"name name-piu\">{lang.AMPASS}</th>\n              <th className=\"rating\">pp</th>\n              <th className=\"playcount\">{lang.PLAYCOUNT}</th>\n              <th className=\"playcount\">{lang.SCORES_count}</th>\n              <th className=\"accuracy\">{lang.ACCURACY}</th>\n              <th className=\"hide-col\"> </th>\n            </tr>\n          </thead>\n          <tbody>\n            {ranking.map((player, playerIndex) => {\n              const isHidden = preferences?.playersHiddenStatus?.[player.id];\n              if (isHidden && !preferences?.showHiddenPlayersInRanking) {\n                return null;\n              }\n\n              return (\n                <tr className={classNames('player', { 'hidden-player': isHidden })} key={player.id}>\n                  <td className=\"place\">\n                    {playerIndex === 0 ? <GiQueenCrown /> : `#${playerIndex + 1}`}\n                  </td>\n                  <td className=\"exp-rank\">{player.exp != null ? <ExpRankImg exp={player.exp} /> : null}</td>\n                  <td className=\"name\">\n                    <Flex gap=\"xxs\" align=\"center\">\n                      {player.region ? <Flag region={player.region} /> : null}\n                      <Anchor component={NavLink} to={routes.profile.getPath({ id: player.id })}>\n                        {player.nickname}\n                      </Anchor>\n                    </Flex>\n                  </td>\n                  <td className=\"name name-piu\">\n                    <Anchor component={NavLink} to={routes.profile.getPath({ id: player.id })}>\n                      {player.arcade_name}\n                    </Anchor>\n                  </td>\n                  <td className=\"rating secondary\">\n                    {player.pp != null ? Math.floor(player.pp) : ''}\n                  </td>\n                  <td className=\"playcount\">{player.results_count}</td>\n                  <td className=\"playcount\">{player.best_results_count}</td>\n                  <td className=\"accuracy\">\n                    {player.accuracy ? `${player.accuracy.toFixed(2)}%` : ''}\n                  </td>\n                  <td className=\"hide-col\">\n                    <div className=\"switch-wrapper\">\n                      <Switch\n                        onChange={() => {\n                          if (preferences) {\n                            preferencesMutation.mutate(\n                              _.set(['playersHiddenStatus', player.id], !isHidden, preferences)\n                            );\n                          }\n                        }}\n                        checked={!isHidden}\n                      />\n                    </div>\n                  </td>\n                </tr>\n              );\n            })}\n          </tbody>\n        </table>\n      )}\n    </div>\n  );\n}\n","import { Button } from '@mantine/core';\nimport { useQuery } from '@tanstack/react-query';\nimport _ from 'lodash/fp';\nimport { FaSearch } from 'react-icons/fa';\n\nimport './ranking.scss';\n\nimport { usePreferencesMutation } from 'hooks/usePreferencesMutation';\nimport { useUser } from 'hooks/useUser';\n\nimport { useLanguage } from 'utils/context/translation';\nimport { api } from 'utils/trpc';\n\nimport RankingList from './components/RankingList';\n\nconst Ranking = () => {\n  const lang = useLanguage();\n  const userQuery = useUser();\n  const {\n    isLoading,\n    isFetching,\n    error,\n    data: ranking,\n    refetch: refetchRanking,\n  } = useQuery(api.players.stats.queryOptions());\n\n  const preferencesMutation = usePreferencesMutation();\n  const preferences = userQuery.data?.preferences;\n\n  const onChangeHidingPlayers = () => {\n    if (preferences) {\n      preferencesMutation.mutate(\n        _.set(['showHiddenPlayersInRanking'], !preferences.showHiddenPlayersInRanking, preferences)\n      );\n    }\n  };\n\n  const onRefresh = () => {\n    if (!isLoading) {\n      refetchRanking();\n    }\n  };\n\n  return (\n    <div className=\"ranking-page\">\n      <div className=\"content\">\n        {error && error.message}\n        <div className=\"top-controls\">\n          <Button size=\"sm\" mr=\"xs\" disabled={!preferences} onClick={onChangeHidingPlayers}>\n            {preferences?.showHiddenPlayersInRanking ? lang.HIDE_UNSELECTED : lang.SHOW_ALL}\n          </Button>\n          <Button size=\"sm\" disabled={isFetching} onClick={onRefresh} leftSection={<FaSearch />}>\n            {lang.UPDATE}\n          </Button>\n        </div>\n        <RankingList ranking={ranking} isLoading={isLoading} preferences={preferences} />\n      </div>\n    </div>\n  );\n};\n\nexport default Ranking;\n"],"names":["usePreferencesMutation","queryClient","useQueryClient","useMutation","api","newUser","RankingList","ranking","isLoading","preferences","lang","useLanguage","preferencesMutation","jsxs","_","Loader","jsx","player","playerIndex","isHidden","classNames","GiQueenCrown","ExpRankImg","Flex","Flag","Anchor","NavLink","routes","Switch","Ranking","userQuery","useUser","isFetching","error","refetchRanking","useQuery","onChangeHidingPlayers","onRefresh","Button","FaSearch"],"mappings":"0TAKO,MAAMA,EAAyB,IAKjC,CACH,MAAMC,EAAcC,EAAA,EAWpB,OAT4BC,EAC1BC,EAAI,KAAK,oBAAoB,gBAAgB,CAC3C,UAAYC,GAAY,CACtBJ,EAAY,aAAaG,EAAI,KAAK,QAAQ,SAAA,EAAYC,CAAO,EAC7DJ,EAAY,kBAAkBG,EAAI,OAAO,OAAO,qBAAqB,CACvE,CAAA,CACD,CAAA,CAIL,ECIA,SAAwBE,EAAY,CAAE,QAAAC,EAAS,UAAAC,EAAW,YAAAC,GAAiC,CACzF,MAAMC,EAAOC,EAAA,EACPC,EAAsBZ,EAAA,EAE5B,OACEa,EAAAA,KAAC,MAAA,CAAI,UAAU,eACZ,SAAA,CAAAC,EAAE,QAAQP,CAAO,GAAK,CAACC,GAAa,oBACpCA,SAAcO,EAAA,EAAO,EACrB,CAACP,GAAaD,GACbM,EAAAA,KAAC,QAAA,CACC,SAAA,CAAAG,EAAAA,IAAC,QAAA,CACC,gBAAC,KAAA,CACC,SAAA,CAAAA,EAAAA,IAAC,KAAA,CAAG,UAAU,QAAS,SAAAN,EAAK,KAAK,EACjCM,EAAAA,IAAC,KAAA,CAAI,SAAAN,EAAK,GAAA,CAAI,EACdM,EAAAA,IAAC,KAAA,CAAG,UAAU,OAAQ,WAAK,KAAK,EAChCA,EAAAA,IAAC,KAAA,CAAG,UAAU,gBAAiB,WAAK,OAAO,EAC3CA,EAAAA,IAAC,KAAA,CAAG,UAAU,SAAS,SAAA,KAAE,EACzBA,EAAAA,IAAC,KAAA,CAAG,UAAU,YAAa,WAAK,UAAU,EAC1CA,EAAAA,IAAC,KAAA,CAAG,UAAU,YAAa,WAAK,aAAa,EAC7CA,EAAAA,IAAC,KAAA,CAAG,UAAU,WAAY,WAAK,SAAS,EACxCA,EAAAA,IAAC,KAAA,CAAG,UAAU,WAAW,SAAA,GAAA,CAAC,CAAA,CAAA,CAC5B,CAAA,CACF,QACC,QAAA,CACE,SAAAT,EAAQ,IAAI,CAACU,EAAQC,IAAgB,CACpC,MAAMC,EAAWV,GAAa,sBAAsBQ,EAAO,EAAE,EAC7D,OAAIE,GAAY,CAACV,GAAa,2BACrB,KAIPI,OAAC,MAAG,UAAWO,EAAW,SAAU,CAAE,gBAAiBD,EAAU,EAC/D,SAAA,CAAAH,EAAAA,IAAC,KAAA,CAAG,UAAU,QACX,SAAAE,IAAgB,EAAIF,EAAAA,IAACK,EAAA,CAAA,CAAa,EAAK,IAAIH,EAAc,CAAC,GAC7D,EACAF,EAAAA,IAAC,KAAA,CAAG,UAAU,WAAY,SAAAC,EAAO,KAAO,KAAOD,EAAAA,IAACM,EAAA,CAAW,IAAKL,EAAO,GAAA,CAAK,EAAK,KAAK,EACtFD,EAAAA,IAAC,MAAG,UAAU,OACZ,gBAACO,EAAA,CAAK,IAAI,MAAM,MAAM,SACnB,SAAA,CAAAN,EAAO,OAASD,EAAAA,IAACQ,EAAA,CAAK,OAAQP,EAAO,OAAQ,EAAK,KACnDD,EAAAA,IAACS,EAAA,CAAO,UAAWC,EAAS,GAAIC,EAAO,QAAQ,QAAQ,CAAE,GAAIV,EAAO,EAAA,CAAI,EACrE,WAAO,QAAA,CACV,CAAA,CAAA,CACF,CAAA,CACF,EACAD,EAAAA,IAAC,MAAG,UAAU,gBACZ,eAACS,EAAA,CAAO,UAAWC,EAAS,GAAIC,EAAO,QAAQ,QAAQ,CAAE,GAAIV,EAAO,GAAI,EACrE,SAAAA,EAAO,YACV,CAAA,CACF,EACAD,EAAAA,IAAC,KAAA,CAAG,UAAU,mBACX,SAAAC,EAAO,IAAM,KAAO,KAAK,MAAMA,EAAO,EAAE,EAAI,EAAA,CAC/C,EACAD,EAAAA,IAAC,KAAA,CAAG,UAAU,YAAa,WAAO,cAAc,EAChDA,EAAAA,IAAC,KAAA,CAAG,UAAU,YAAa,WAAO,mBAAmB,EACrDA,EAAAA,IAAC,KAAA,CAAG,UAAU,WACX,SAAAC,EAAO,SAAW,GAAGA,EAAO,SAAS,QAAQ,CAAC,CAAC,IAAM,GACxD,QACC,KAAA,CAAG,UAAU,WACZ,SAAAD,MAAC,MAAA,CAAI,UAAU,iBACb,SAAAA,EAAAA,IAACY,EAAA,CACC,SAAU,IAAM,CACVnB,GACFG,EAAoB,OAClBE,EAAE,IAAI,CAAC,sBAAuBG,EAAO,EAAE,EAAG,CAACE,EAAUV,CAAW,CAAA,CAGtE,EACA,QAAS,CAACU,CAAA,CAAA,EAEd,CAAA,CACF,CAAA,CAAA,EAvCuEF,EAAO,EAwChF,CAEJ,CAAC,CAAA,CACH,CAAA,CAAA,CACF,CAAA,EAEJ,CAEJ,CC3FA,MAAMY,EAAU,IAAM,CACpB,MAAMnB,EAAOC,EAAA,EACPmB,EAAYC,EAAA,EACZ,CACJ,UAAAvB,EACA,WAAAwB,EACA,MAAAC,EACA,KAAM1B,EACN,QAAS2B,CAAA,EACPC,EAAS/B,EAAI,QAAQ,MAAM,cAAc,EAEvCQ,EAAsBZ,EAAA,EACtBS,EAAcqB,EAAU,MAAM,YAE9BM,EAAwB,IAAM,CAC9B3B,GACFG,EAAoB,OAClBE,EAAE,IAAI,CAAC,4BAA4B,EAAG,CAACL,EAAY,2BAA4BA,CAAW,CAAA,CAGhG,EAEM4B,EAAY,IAAM,CACjB7B,GACH0B,EAAA,CAEJ,EAEA,aACG,MAAA,CAAI,UAAU,eACb,SAAArB,EAAAA,KAAC,MAAA,CAAI,UAAU,UACZ,SAAA,CAAAoB,GAASA,EAAM,QAChBpB,EAAAA,KAAC,MAAA,CAAI,UAAU,eACb,SAAA,CAAAG,MAACsB,EAAA,CAAO,KAAK,KAAK,GAAG,KAAK,SAAU,CAAC7B,EAAa,QAAS2B,EACxD,SAAA3B,GAAa,2BAA6BC,EAAK,gBAAkBA,EAAK,SACzE,EACAM,EAAAA,IAACsB,EAAA,CAAO,KAAK,KAAK,SAAUN,EAAY,QAASK,EAAW,YAAarB,EAAAA,IAACuB,EAAA,CAAA,CAAS,EAChF,WAAK,MAAA,CACR,CAAA,EACF,EACAvB,EAAAA,IAACV,EAAA,CAAY,QAAAC,EAAkB,UAAAC,EAAsB,YAAAC,CAAA,CAA0B,CAAA,CAAA,CACjF,CAAA,CACF,CAEJ"}