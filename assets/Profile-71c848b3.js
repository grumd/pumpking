var w=Object.defineProperty;var M=(r,i,a)=>i in r?w(r,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[i]=a;var o=(r,i,a)=>(M(r,typeof i!="symbol"?i+"":i,a),a);import{d as H,b as k,r as h,j as e,i as B,u as b,au as I,av as N,G as $,aa as y,aw as q,Q as L,N as O,e as R,ag as P,af as z,ax as W,a7 as j,ay as V,ab as K,ac as U,ad as X,ae as Y,a0 as u,az as g,a2 as Q,aq as J,R as Z,aA as ee,a4 as se,S as ae}from"./index-afb59a07.js";import{c as f}from"./index-75cb439a.js";import{_ as re}from"./Tooltip-c12405e1.js";import{a as ie,G as te,D as ne}from"./GradesGraph-a01292c9.js";import{R as S,X as E,Y as D,T as A}from"./BarChart-564e823d.js";import{L as T,C,a as G,w as le,p as ce,P as oe}from"./PlayerCompareSelect-b588571f.js";import{T as de}from"./Toggle-056c0bca.js";const _=({playerId:r})=>H.players.pp.useQuery(r),he=()=>{const r=k(),{data:i}=_({playerId:r.id?Number(r.id):void 0}),a=h.useMemo(()=>i==null?void 0:i.history.map(s=>({date:new Date(s.date).getTime(),pp:parseFloat(s.pp)})),[i==null?void 0:i.history]);return a?e.jsx(S,{aspect:1.6,children:e.jsxs(T,{data:a,margin:{top:5,bottom:5,right:5,left:0},children:[e.jsx(C,{strokeDasharray:"3 3"}),e.jsx(E,{dataKey:"date",type:"number",domain:["dataMin","dataMax"],tickFormatter:s=>new Date(s).toLocaleDateString()}),e.jsx(D,{allowDecimals:!1,domain:([s,n])=>[Math.max(0,s-100),n+100],tickFormatter:s=>`${Math.round(s)}`,width:40}),e.jsx(A,{isAnimationActive:!1,content:({payload:s})=>!s||!s[0]?null:e.jsxs("div",{className:"history-tooltip",children:[e.jsx("div",{children:new Date(s[0].payload.date).toLocaleDateString()}),s&&s[0]&&e.jsxs("div",{children:["PP: ",s[0].value]})]})}),e.jsx(G,{type:"monotone",isAnimationActive:!1,dataKey:"pp",stroke:"#88d3ff",strokeWidth:3,dot:!1})]})}):null},xe=()=>{const r=k(),{data:i}=_({playerId:r.id?Number(r.id):void 0}),a=h.useMemo(()=>i==null?void 0:i.rankHistory.map(s=>({date:new Date(s.date).getTime(),rank:s.rank})),[i==null?void 0:i.rankHistory]);return a?e.jsx(S,{aspect:1.6,children:e.jsxs(T,{data:a,margin:{top:5,bottom:5,right:5,left:0},children:[e.jsx(C,{strokeDasharray:"3 3"}),e.jsx(E,{dataKey:"date",type:"number",domain:["dataMin","dataMax"],tickFormatter:s=>new Date(s).toLocaleDateString()}),e.jsx(D,{allowDecimals:!1,domain:([,s])=>[1,s<3?s+2:s+1],interval:0,reversed:!0,width:40}),e.jsx(A,{isAnimationActive:!1,content:({payload:s})=>!s||!s[0]?null:e.jsxs("div",{className:"history-tooltip",children:[e.jsx("div",{children:new Date(s[0].payload.date).toLocaleDateString()}),s&&s[0]&&e.jsxs("div",{children:["Place: #",s[0].value]})]})}),e.jsx(G,{isAnimationActive:!1,type:"stepAfter",dataKey:"rank",stroke:"#88d3ff",strokeWidth:3,dot:!1})]})}):null},pe=B.memo(function({grade:i}){return!i||i==="?"?null:e.jsx("img",{src:`/grades/${i}.png`,alt:i})});function me(){const r=b();return e.jsxs("div",{className:"faq-exp",children:[r.EXP_FAQ,r.EXP_TITLES_LIST_HEADER,e.jsx("div",{className:"ranks-list",children:I.map(i=>e.jsxs("div",{className:"rank",children:[e.jsx("div",{className:"exp-rank",children:N(i)}),e.jsx("div",{className:"threshold",children:i.threshold})]},i.threshold))})]})}function je(r){return $({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}}]})(r)}const ve=y(r=>({charts:r.results.sharedCharts}),{fetchJson:V})(({playerId:r,charts:i,fetchJson:a})=>{const[s,n]=h.useState(!1),[t,x]=h.useState(10),[d,p]=h.useState([]),m=b();return h.useEffect(()=>{n(!0),a({url:`${q}/player/${r}/mostPlayed?limit=${t}`}).then(l=>{n(!1),l.success&&p(l.data)}).catch(()=>{n(!1)})},[r,t,a]),e.jsxs("div",{className:"most-played",children:[s&&e.jsx(L,{}),d.map(l=>{const c=i[l.shared_chart];return c?e.jsxs("div",{className:"chart",children:[e.jsxs("div",{className:f("chart-name",{single:c.chartType==="S",singlep:c.chartType==="SP",doublep:c.chartType==="DP",double:c.chartType==="D",coop:c.chartType==="COOP"}),children:[e.jsx("span",{className:"chart-letter",children:c.chartType}),e.jsx("span",{className:"chart-number",children:c.chartLevel})]}),e.jsx("div",{className:"song-name",children:e.jsx(O,{exact:!0,to:R.leaderboard.sharedChart.getPath({sharedChartId:c.sharedChartId}),children:c.song})}),e.jsx("div",{className:"date",children:l.latestDate?P(m,z(l.latestDate)):null}),e.jsxs("div",{className:"playcount",children:[e.jsx(W,{}),e.jsx("span",{children:l.count})]})]},l.shared_chart):null}),t===j.size(d)&&e.jsxs("button",{className:"show-more btn btn-sm btn-dark btn-icon",onClick:()=>x(t+10),children:[e.jsx(je,{})," ",m.SHOW_MORE]})]})}),F=ce("id"),ue=(r,i)=>({profile:F(r,i),tracklist:r.tracklist.data,filter:r.profiles.filter,error:r.charts.error||r.tracklist.error,sharedCharts:r.results.sharedCharts,isLoading:r.charts.isLoading||r.results.isLoadingRanking||r.tracklist.isLoading}),Ne={fetchChartsData:K,setProfilesFilter:U,resetProfilesFilter:X};class v extends h.Component{constructor(){super(...arguments);o(this,"state",{isLevelGraphCombined:!0,showFaq:!1});o(this,"onRefresh",()=>{const{isLoading:a}=this.props;!a&&this.props.fetchChartsData()});o(this,"onChangeDayRange",a=>{const{filter:s}=this.props;this.props.setProfilesFilter({...s,dayRange:a})});o(this,"onShowFaq",()=>{this.setState({showFaq:!0})});o(this,"onHideFaq",()=>{this.setState({showFaq:!1})});o(this,"circleShape",a=>e.jsx("circle",{cx:a.cx,cy:a.cy,r:4,fill:a.fill},a.key))}componentWillUnmount(){this.props.resetProfilesFilter()}renderRankingHistory(){return e.jsx(he,{})}renderPlaceHistory(){return e.jsx(xe,{})}renderGrades(){return e.jsx(ie,{})}renderGradesWithLevels(){return e.jsx(te,{})}renderLevels(){return e.jsx(ne,{})}renderGradeBlock(a,s){const{profile:n}=this.props,t=n.progress[a],x=a==="double"?"D":"S",d=Math.floor((t[`${s}-bonus-level-coef`]||0)*100),p=t[`${s}-bonus-level-min-number`],m=t[`${s}-bonus-level-achieved-number`],l=t[`${s}-bonus-level`]?`${x}${t[`${s}-bonus-level`]}`:"?";return e.jsxs("div",{className:"grade-block",children:[e.jsx("div",{className:"grade-letter",children:e.jsx(pe,{grade:s})}),e.jsx("div",{className:"grade-level",children:l}),e.jsxs("div",{className:"grade-progress",children:[d,"% (",d===100?p:m,"/",p,")"]}),e.jsx("div",{className:f("progress-background",{complete:d===100,zero:d===0}),style:{height:`${d}%`}})]})}renderAchievement(a,s){const n=g[a].icon,t=g[a].description;return e.jsx(re,{content:e.jsx("div",{children:t}),tooltipClassName:"pumpking-tooltip achievement-tooltip",children:e.jsxs("div",{className:"ach-block",children:[n&&e.jsx("div",{className:"ach-icon",children:e.jsx(n,{})}),e.jsx("div",{className:"ach-name",children:a}),e.jsx("div",{className:f("progress-background",{complete:s.progress===100,zero:s.progress===0}),style:{height:`${Math.round(s.progress)}%`}})]})},a)}renderResultsByLevelHeader(){const a=this.context,{isLevelGraphCombined:s}=this.state;return e.jsx("div",{className:"toggle-holder",children:e.jsx(de,{className:"combine-toggle",checked:s,onChange:()=>this.setState(n=>({isLevelGraphCombined:!n.isLevelGraphCombined})),children:a.UNITE_GRAPHS})})}renderResultsByLevelFooter(){const a=this.context,{profile:s}=this.props;return e.jsx("div",{className:"toggle-holder",children:e.jsx(Q,{to:R.profile.resultsByLevel.getPath({id:s.id}),children:e.jsx("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",children:a.MORE_DETAILS})})})}renderProfile(){const a=this.context,{profile:s}=this.props,{isLevelGraphCombined:n}=this.state,t=s.expRankNext?(s.exp-s.expRank.threshold)/(s.expRankNext.threshold-s.expRank.threshold):100;return e.jsxs("div",{className:"profile",children:[e.jsxs("div",{className:"profile-header",children:[e.jsxs("div",{className:"profile-name text-with-header",children:[e.jsx("div",{className:"text-header",children:a.PLAYER}),e.jsx("div",{children:s.name})]}),e.jsxs("div",{className:"text-with-header",children:[e.jsx("div",{className:"text-header",children:a.RANK}),e.jsxs("div",{children:["#",s.rank]})]}),e.jsxs("div",{className:"text-with-header",children:[e.jsx("div",{className:"text-header",children:a.PP}),e.jsx("div",{children:Math.floor(s.pp)})]}),e.jsxs("div",{className:"text-with-header",children:[e.jsx("div",{className:"text-header",children:a.LAST_TIME_PLAYED}),e.jsx("div",{children:s.lastResultDate?P(a,s.lastResultDate):a.NEVER})]}),e.jsx("div",{className:"_flex-fill"}),e.jsxs("div",{className:"text-with-header -select",children:[e.jsx("div",{className:"text-header",children:a.COMPARE_WITH}),e.jsx("div",{children:e.jsx(oe,{})})]})]}),e.jsxs("div",{className:"profile-section",children:[e.jsxs("div",{className:"profile-sm-section-header _flex-row _align-center",children:[e.jsx("span",{children:a.EXP}),e.jsx("div",{className:"_flex-fill"}),e.jsx("div",{onClick:this.onShowFaq,className:"_clickable",children:e.jsx(J,{onClick:this.onShowFaq})}),e.jsxs(Z,{ariaHideApp:!1,className:"Modal faq-modal",overlayClassName:"Overlay",isOpen:this.state.showFaq,onRequestClose:this.onHideFaq,children:[e.jsx("div",{className:"close-btn",onClick:this.onHideFaq,children:e.jsx(ee,{})})," ",e.jsx(me,{})]})]}),e.jsxs("div",{className:"exp-range",children:[e.jsxs("div",{className:"rank exp-rank",children:[N(s.expRank),s.expRank&&e.jsx("div",{children:s.expRank.threshold})]}),e.jsxs("div",{className:"exp-line-with-label",children:[e.jsx("div",{className:"exp-label",children:s.expRankNext?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"taken-num",children:Math.round(s.exp-s.expRank.threshold)}),` / ${s.expRankNext.threshold-s.expRank.threshold}`]}):null}),e.jsxs("div",{className:"exp-line",children:[e.jsx("div",{className:"taken",style:{width:Math.floor(100*t)+"%"}}),e.jsx("div",{className:"rest",style:{width:100-Math.ceil(100*t)+"%"}})]}),e.jsxs("div",{className:"exp-label",children:[a.TOTAL,": ",e.jsx("span",{className:"taken-num",children:Math.round(s.exp)})]})]}),s.expRankNext&&e.jsxs("div",{className:"rank exp-rank",children:[N(s.expRankNext),s.expRankNext&&e.jsx("div",{children:s.expRankNext.threshold})]})]})]}),e.jsxs("div",{className:"profile-section-horizontal-container",children:[e.jsx("div",{className:"profile-section",children:e.jsx("div",{className:"profile-section-content",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"profile-section-2",children:[e.jsxs("div",{className:"profile-sm-section-header flex",children:[e.jsx("span",{children:a.GRADES}),this.renderResultsByLevelHeader()]}),e.jsx("div",{className:"chart-container single-double-labels",children:this.renderGradesWithLevels()})]}),this.renderResultsByLevelFooter()]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"profile-section-2",children:[e.jsxs("div",{className:"profile-sm-section-header flex",children:[e.jsx("span",{children:"уровни"}),this.renderResultsByLevelHeader()]}),e.jsx("div",{className:"chart-container",children:this.renderLevels()})]}),e.jsxs("div",{className:"profile-section-2",children:[e.jsx("div",{className:"profile-sm-section-header",children:e.jsx("span",{children:a.GRADES})}),e.jsx("div",{className:"chart-container",children:this.renderGrades()})]}),this.renderResultsByLevelFooter()]})})}),e.jsx("div",{className:"profile-section",children:e.jsxs("div",{className:"profile-section-content",children:[e.jsxs("div",{className:"profile-section-2",children:[e.jsx("div",{className:"profile-sm-section-header",children:e.jsx("span",{children:a.PP})}),e.jsx("div",{className:"chart-container",children:this.renderRankingHistory()})]}),e.jsxs("div",{className:"profile-section-2",children:[e.jsx("div",{className:"profile-sm-section-header",children:e.jsx("span",{children:a.PLACE_IN_TOP})}),e.jsx("div",{className:"chart-container",children:this.renderPlaceHistory()})]})]})})]}),e.jsxs("div",{className:"profile-section progress-section",children:[e.jsx("div",{className:"profile-sm-section-header",children:e.jsx("span",{children:a.LEVEL_ACHIEVEMENTS})}),e.jsxs("div",{className:"progress-blocks-single-double",children:[e.jsx("div",{className:"progress-block",children:e.jsxs("div",{className:"achievements-grades single",children:[this.renderGradeBlock("single","A"),this.renderGradeBlock("single","A+"),this.renderGradeBlock("single","S"),this.renderGradeBlock("single","SS")]})}),e.jsx("div",{className:"progress-block",children:e.jsxs("div",{className:"achievements-grades double",children:[this.renderGradeBlock("double","A"),this.renderGradeBlock("double","A+"),this.renderGradeBlock("double","S"),this.renderGradeBlock("double","SS")]})})]}),e.jsx("div",{className:"bonus-faq",children:a.LEVEL_ACHIEVEMENTS_HINT})]}),e.jsxs("div",{className:"profile-section",children:[e.jsx("div",{className:"profile-sm-section-header",children:e.jsx("span",{children:a.ACHIEVEMENTS})}),e.jsx("div",{className:"achievements",children:j.keys(s.achievements).map(x=>this.renderAchievement(x,s.achievements[x]))})]}),e.jsxs("div",{className:"profile-section",children:[e.jsx("div",{className:"profile-sm-section-header",children:e.jsx("span",{children:a.MOST_PLAYED_CHARTS})}),e.jsx(ve,{playerId:s.id})]})]})}render(){const{isLoading:a,profile:s,error:n}=this.props;se&&console.log("profile:",s);const t=this.context;return e.jsx("div",{className:"profile-page",children:e.jsxs("div",{className:"content",children:[n&&n.message,e.jsxs("div",{className:"top-controls",children:[e.jsx("div",{className:"_flex-fill"}),e.jsxs("button",{disabled:a,className:"btn btn-sm btn-dark btn-icon",onClick:this.onRefresh,children:[e.jsx(ae,{})," ",t.UPDATE]})]}),a&&e.jsx(L,{}),!a&&j.isEmpty(s)&&e.jsx("div",{className:"profile",children:t.PROFILE_NOT_FOUND}),!a&&!j.isEmpty(s)&&this.renderProfile()]})})}}o(v,"contextType",Y),o(v,"propTypes",{profile:u.object,error:u.object,isLoading:u.bool.isRequired}),o(v,"defaultProps",{profile:{}});const fe=le(y(ue,Ne)(v)),Ee=Object.freeze(Object.defineProperty({__proto__:null,default:fe,profileSelector:F},Symbol.toStringTag,{value:"Module"}));export{pe as G,Ee as P,F as p};
//# sourceMappingURL=Profile-71c848b3.js.map
