import{_ as s,a as B,b as k,u as E,r as L,ae as v,e as g,j as e,L as P,T,ah as O,ai as _,N as I}from"./index-a8ec4dd6.js";import{c as y,S as w}from"./PlayerCompareSelect-46785be7.js";import{n as D}from"./numeral-065c25c8.js";import{p as C,G as N}from"./Profile-47821d58.js";import{C as R}from"./ChartLabel-c739f077.js";import{a as G}from"./leaderboards-dba84202.js";import"./env-026301e6.js";import"./usePlayers-05529281.js";import"./index-dd0aa871.js";import"./PpRankHistoryGraph-6fdae59f.js";import"./ExpRankImg-3e1a766f.js";import"./Text-a69c1a5b.js";import"./Stack-e6399caa.js";import"./BarChart-a8462810.js";import"./Toggle-c1c9ce03.js";import"./index-70a59dcb.js";import"./index.esm-2ba1bc29.js";const U=y(l=>l.tracklist.data,l=>s.flow(s.get("chartLevels"),s.keys,s.filter(r=>0<r),s.map(r=>({label:r,value:r})))(l)),A=y(l=>l.results.sharedCharts,C,(l,r)=>r.params.level,(l,r)=>r.sortOrder,(l,r,o,m)=>{if(!r||!o)return null;const x=s.toString(o),c=s.flow(s.values,s.filter(t=>t.chartLevel===x&&!t.results.some(i=>i.playerId===r.id)),s.map(t=>({chart:t})),s.groupBy("chart.chartType"))(l);return{byType:s.flow(s.groupBy("chart.chartType"),t=>({...Object.keys(c).reduce((i,f)=>({...i,[f]:[]}),{}),...t}),s.mapValues(s.flow(s.groupBy("result.grade"),s.toPairs,s.orderBy(([t])=>G[t],m))),s.toPairs,s.orderBy(([t])=>t==="S"?0:t==="D"?1:2,"asc"),s.map(([t,i])=>m==="asc"?[t,[["X",c[t]||[]],...i]]:[t,[...i,["X",c[t]||[]]]]))(r.bestGradeResultsByLevel[o])}}),ae=()=>{const l=B(),r=k(),o=E(),[m,x]=L.useState("asc"),c=v(U),d=v(a=>C(a,{params:r})),t=v(a=>A(a,{params:r,sortOrder:m})),i=v(a=>a.charts.isLoading||a.results.isLoadingRanking||a.tracklist.isLoading);if(L.useEffect(()=>{if(d&&!r.level){const a=s.flow(s.get("resultsByLevel"),s.toPairs,s.maxBy("[1].length"),s.first)(d);l(g.profile.resultsByLevel.level.getPath({...r,level:a}))}},[r,d,l]),i)return e.jsx(P,{});if(!t)return null;const f={D:o.DOUBLES,S:o.SINGLES},b=a=>{l(g.profile.resultsByLevel.level.getPath({id:d.id,level:a}))};return e.jsxs("div",{className:"profile-results-by-level",children:[e.jsxs("header",{children:[e.jsx(T,{to:g.profile.getPath({id:d.id}),children:e.jsx("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",children:o.BACK_BUTTON})}),e.jsx("div",{className:"_flex-fill"}),e.jsxs("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:()=>x(a=>a==="asc"?"desc":"asc"),children:[m==="desc"?e.jsx(O,{}):e.jsx(_,{})," ",o.SORTING]}),e.jsx("button",{className:"btn btn-sm btn-dark _margin-right",disabled:r.level==="1",onClick:()=>b(Number(r.level)-1),children:"-"}),e.jsx(w,{className:"select levels _margin-right",classNamePrefix:"select",placeholder:o.LEVEL_PLACEHOLDER,options:c,value:c.find(a=>a.value===r.level),onChange:a=>b(a.value)}),e.jsx("button",{className:"btn btn-sm btn-dark",disabled:r.level==="28",onClick:()=>b(Number(r.level)+1),children:"+"})]}),e.jsx("div",{className:"chart-types",children:t.byType.map(([a,j])=>{const S=j.map(n=>n[1].length).reduce((n,p)=>n+p,0);return e.jsxs("div",{className:"chart-type",children:[e.jsx("header",{children:`${f[a]||a} (${S})`}),e.jsx("div",{className:"grades-groups",children:j.map(([n,p])=>s.isEmpty(p)?null:e.jsxs("div",{className:"grades-group",children:[e.jsxs("header",{children:[n==="X"?o.UNPLAYED:n==="?"?"?":e.jsx(N,{grade:n}),` (${p.length})`]}),e.jsx("div",{className:"charts-for-grade",children:p.map(({chart:u,result:h})=>e.jsxs("div",{className:"chart-block",children:[e.jsx(R,{type:u.chartType,level:u.chartLevel}),e.jsx(I,{exact:!0,to:g.leaderboard.sharedChart.getPath({sharedChartId:u.sharedChartId}),children:u.song}),h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"_flex-fill"}),e.jsx(N,{grade:n}),e.jsxs("span",{className:"score-span desktop-only",children:[h.scoreIncrease>h.score*.8&&"*",D(h.score).format("0,0")]})]})]},u.sharedChartId))})]},n))})]},a)})})]})};export{ae as default};
//# sourceMappingURL=ResultsByLevel-aaa7ab38.js.map
