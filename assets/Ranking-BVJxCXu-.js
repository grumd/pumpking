import{K as I,A as w,D as h,y as k,j as e,N as F,a3 as O,a7 as M,a4 as N,Q as R,a5 as C,ab as b,J as _,V as Q,r as S,z as L,S as D,G as U,aF as z}from"./index-BR044fRZ.js";import{_ as m,A as T}from"./fp-Cq6pd7DY.js";import{n as q,o as G}from"./index.esm-BPPdmaM7.js";import{m as K,E as Y}from"./ExpRankImg-CjZi-CdQ.js";import{F as $}from"./Flex-VBlYDnZB.js";import{u as B}from"./use-disclosure-BUfPaEyO.js";import{M as J}from"./Modal-CKzzehKo.js";import{M as V}from"./MultiSelect-Cdq2i6In.js";import"./Paper-DNgGSVPq.js";const E=()=>{const a=I();return w(h.user.preferencesMutation.mutationOptions({onSuccess:i=>{a.setQueryData(h.user.current.queryKey(),i),a.invalidateQueries(h.charts.search.infiniteQueryFilter())}}))};function W({ranking:a,isLoading:d,preferences:i}){const c=k(),x=E();return e.jsxs("div",{className:"ranking-list",children:[m.isEmpty(a)&&!d&&"ничего не найдено",d&&e.jsx(F,{}),!d&&a&&e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"place",children:c.RANK}),e.jsx("th",{children:c.EXP}),e.jsx("th",{className:"name",children:c.NAME}),e.jsx("th",{className:"name name-piu",children:c.AMPASS}),e.jsx("th",{className:"rating",children:"pp"}),e.jsx("th",{className:"playcount",children:c.PLAYCOUNT}),e.jsx("th",{className:"playcount",children:c.SCORES_count}),e.jsx("th",{className:"accuracy",children:c.ACCURACY}),e.jsx("th",{className:"hide-col",children:" "})]})}),e.jsx("tbody",{children:a.map((s,u)=>{const r=i?.playersHiddenStatus?.[s.id],o=s.region&&i?.hiddenRegions?.[s.region];return(r||o)&&!i?.showHiddenPlayersInRanking?null:e.jsxs("tr",{className:O("player",{"hidden-player":r||o}),children:[e.jsx("td",{className:"place",children:u===0?e.jsx(K,{}):`#${u+1}`}),e.jsx("td",{className:"exp-rank",children:s.exp!=null?e.jsx(Y,{exp:s.exp}):null}),e.jsx("td",{className:"name",children:e.jsxs($,{gap:"xxs",align:"center",children:[s.region?e.jsx(M,{region:s.region}):null,e.jsx(N,{component:C,to:R.profile.getPath({id:s.id}),children:s.nickname})]})}),e.jsx("td",{className:"name name-piu",children:e.jsx(N,{component:C,to:R.profile.getPath({id:s.id}),children:s.arcade_name})}),e.jsx("td",{className:"rating secondary",children:s.pp!=null?Math.floor(s.pp):""}),e.jsx("td",{className:"playcount",children:s.results_count}),e.jsx("td",{className:"playcount",children:s.best_results_count}),e.jsx("td",{className:"accuracy",children:s.accuracy?`${s.accuracy.toFixed(2)}%`:""}),e.jsx("td",{className:"hide-col",children:e.jsx("div",{className:"switch-wrapper",children:e.jsx(b,{onChange:()=>{i&&x.mutate(m.set(["playersHiddenStatus",s.id],!r,i))},checked:!r})})})]},s.id)})})]})]})}const re=()=>{const a=k(),d=_(),[i,{open:c,close:x}]=B(!1),{isLoading:s,isFetching:u,error:r,data:o,refetch:H}=Q(h.players.stats.queryOptions()),g=E(),n=d.data?.preferences,j=S.useMemo(()=>{if(!o)return[];const t=o.map(l=>l.region).filter(l=>l!==null);return[...new Set(t)].sort()},[o]),y=S.useMemo(()=>n?.hiddenRegions?Object.entries(n.hiddenRegions).filter(([,t])=>t).map(([t])=>t):[],[n?.hiddenRegions]),A=()=>{n&&g.mutate(m.set(["showHiddenPlayersInRanking"],!n.showHiddenPlayersInRanking,n))},v=t=>{if(n){const l=j.reduce((p,f)=>(p[f]=t.includes(f),p),{});g.mutate(m.set(["hiddenRegions"],l,n))}},P=()=>{s||H()};return e.jsxs("div",{className:"ranking-page",children:[e.jsxs("div",{className:"content",children:[r&&r.message,e.jsxs("div",{className:"top-controls",children:[e.jsx(L,{size:"sm",disabled:u,onClick:P,leftSection:e.jsx(q,{}),children:a.UPDATE}),e.jsx(T,{variant:"subtle",size:"lg",onClick:c,disabled:!n,ml:"auto",children:e.jsx(G,{})})]}),e.jsx(W,{ranking:o,isLoading:s,preferences:n})]}),e.jsx(J,{opened:i,onClose:x,title:a.FILTERS,centered:!0,children:e.jsxs(D,{children:[e.jsx(b,{label:a.SHOW_ALL,checked:n?.showHiddenPlayersInRanking??!1,onChange:A,disabled:!n}),e.jsx(V,{label:a.HIDE_COUNTRIES,placeholder:a.HIDE_COUNTRIES,data:j,value:y,onChange:v,disabled:!n,clearable:!0,searchable:!0,renderOption:({option:t,checked:l})=>e.jsxs(U,{gap:"xs",children:[l&&e.jsx(z,{size:12}),e.jsx(M,{region:t.value,size:"sm"}),t.value]})})]})})]})};export{re as default};
//# sourceMappingURL=Ranking-BVJxCXu-.js.map
