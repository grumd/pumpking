import{s as I,m as w,n as h,k,j as e,L as O,W as F,Z as M,X as N,x as R,N as C,a2 as b,q as _,y as L,r as S,l as Q,S as U,G as D,ax as T}from"./index-k0Q3n1S8.js";import{_ as m,A as q}from"./fp-CgfZFDQm.js";import{n as z,o as G}from"./index.esm-C1w3OZm8.js";import{m as K,E as W}from"./ExpRankImg-D4u05kzD.js";import{F as X}from"./Flex-CVtTlct6.js";import{u as Y}from"./use-disclosure-CAwfJcH5.js";import{M as $}from"./Modal-CXA46Ui8.js";import{M as B}from"./MultiSelect-DVOUVRds.js";import"./Paper-Dy3IOP_O.js";const E=()=>{const a=I();return w(h.user.preferencesMutation.mutationOptions({onSuccess:i=>{a.setQueryData(h.user.current.queryKey(),i),a.invalidateQueries(h.charts.search.infiniteQueryFilter())}}))};function Z({ranking:a,isLoading:d,preferences:i}){const c=k(),x=E();return e.jsxs("div",{className:"ranking-list",children:[m.isEmpty(a)&&!d&&"ничего не найдено",d&&e.jsx(O,{}),!d&&a&&e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"place",children:c.RANK}),e.jsx("th",{children:c.EXP}),e.jsx("th",{className:"name",children:c.NAME}),e.jsx("th",{className:"name name-piu",children:c.AMPASS}),e.jsx("th",{className:"rating",children:"pp"}),e.jsx("th",{className:"playcount",children:c.PLAYCOUNT}),e.jsx("th",{className:"playcount",children:c.SCORES_count}),e.jsx("th",{className:"accuracy",children:c.ACCURACY}),e.jsx("th",{className:"hide-col",children:" "})]})}),e.jsx("tbody",{children:a.map((s,u)=>{const r=i?.playersHiddenStatus?.[s.id],o=s.region&&i?.hiddenRegions?.[s.region];return(r||o)&&!i?.showHiddenPlayersInRanking?null:e.jsxs("tr",{className:F("player",{"hidden-player":r||o}),children:[e.jsx("td",{className:"place",children:u===0?e.jsx(K,{}):`#${u+1}`}),e.jsx("td",{className:"exp-rank",children:s.exp!=null?e.jsx(W,{exp:s.exp}):null}),e.jsx("td",{className:"name",children:e.jsxs(X,{gap:"xxs",align:"center",children:[s.region?e.jsx(M,{region:s.region}):null,e.jsx(N,{component:C,to:R.profile.getPath({id:s.id}),children:s.nickname})]})}),e.jsx("td",{className:"name name-piu",children:e.jsx(N,{component:C,to:R.profile.getPath({id:s.id}),children:s.arcade_name})}),e.jsx("td",{className:"rating secondary",children:s.pp!=null?Math.floor(s.pp):""}),e.jsx("td",{className:"playcount",children:s.results_count}),e.jsx("td",{className:"playcount",children:s.best_results_count}),e.jsx("td",{className:"accuracy",children:s.accuracy?`${s.accuracy.toFixed(2)}%`:""}),e.jsx("td",{className:"hide-col",children:e.jsx("div",{className:"switch-wrapper",children:e.jsx(b,{onChange:()=>{i&&x.mutate(m.set(["playersHiddenStatus",s.id],!r,i))},checked:!r})})})]},s.id)})})]})]})}const re=()=>{const a=k(),d=_(),[i,{open:c,close:x}]=Y(!1),{isLoading:s,isFetching:u,error:r,data:o,refetch:H}=L(h.players.stats.queryOptions()),g=E(),n=d.data?.preferences,j=S.useMemo(()=>{if(!o)return[];const t=o.map(l=>l.region).filter(l=>l!==null);return[...new Set(t)].sort()},[o]),y=S.useMemo(()=>n?.hiddenRegions?Object.entries(n.hiddenRegions).filter(([,t])=>t).map(([t])=>t):[],[n?.hiddenRegions]),v=()=>{n&&g.mutate(m.set(["showHiddenPlayersInRanking"],!n.showHiddenPlayersInRanking,n))},A=t=>{if(n){const l=j.reduce((p,f)=>(p[f]=t.includes(f),p),{});g.mutate(m.set(["hiddenRegions"],l,n))}},P=()=>{s||H()};return e.jsxs("div",{className:"ranking-page",children:[e.jsxs("div",{className:"content",children:[r&&r.message,e.jsxs("div",{className:"top-controls",children:[e.jsx(Q,{size:"sm",disabled:u,onClick:P,leftSection:e.jsx(z,{}),children:a.UPDATE}),e.jsx(q,{variant:"subtle",size:"lg",onClick:c,disabled:!n,ml:"auto",children:e.jsx(G,{})})]}),e.jsx(Z,{ranking:o,isLoading:s,preferences:n})]}),e.jsx($,{opened:i,onClose:x,title:a.FILTERS,centered:!0,children:e.jsxs(U,{children:[e.jsx(b,{label:a.SHOW_ALL,checked:n?.showHiddenPlayersInRanking??!1,onChange:v,disabled:!n}),e.jsx(B,{label:a.HIDE_COUNTRIES,placeholder:a.HIDE_COUNTRIES,data:j,value:y,onChange:A,disabled:!n,clearable:!0,searchable:!0,renderOption:({option:t,checked:l})=>e.jsxs(D,{gap:"xs",children:[l&&e.jsx(T,{size:12}),e.jsx(M,{region:t.value,size:"sm"}),t.value]})})]})})]})};export{re as default};
//# sourceMappingURL=Ranking-DXipM9La.js.map
