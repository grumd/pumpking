import{j as s,G as w,a5 as S,x as q,N as ae,T as f,a6 as C,s as ce,m as le,n as E,k as V,q as W,a4 as h,a7 as oe,a8 as L,P as N,B as M,A as de,l as me,r as y}from"./index-D5APUIOP.js";import{_ as z}from"./fp-q9G7WCRS.js";import{f as fe,g as he,h as xe,i as pe,j as ue,G as ge,k as ye}from"./index.esm-BOaJYbiZ.js";import{b as O,f as R,u as je}from"./useFilter--6Mnexvr.js";import{l as Fe,C as be,M as K,i as Ee,G as B,T as Se,A as Ce}from"./Grade-B5DMR_z-.js";import{g as Ae}from"./timeAgo-CC3omANb.js";const Ne=()=>{const e=O(R);return[...e.playersAll??[],...e.playersNone??[],...e.playersSome??[],...e.sortChartsByPlayers??[]]},Q="%[a-f0-9]{2}",P=new RegExp("("+Q+")|([^%]+?)","gi"),G=new RegExp("("+Q+")+","gi");function D(e,r){try{return[decodeURIComponent(e.join(""))]}catch{}if(e.length===1)return e;r=r||1;const n=e.slice(0,r),t=e.slice(r);return Array.prototype.concat.call([],D(n),D(t))}function we(e){try{return decodeURIComponent(e)}catch{let r=e.match(P)||[];for(let n=1;n<r.length;n++)e=D(r,n).join(""),r=e.match(P)||[];return e}}function De(e){const r={"%FE%FF":"��","%FF%FE":"��"};let n=G.exec(e);for(;n;){try{r[n[0]]=decodeURIComponent(n[0])}catch{const i=we(n[0]);i!==n[0]&&(r[n[0]]=i)}n=G.exec(e)}r["%C2"]="�";const t=Object.keys(r);for(const i of t)e=e.replace(new RegExp(i,"g"),r[i]);return e}function Ie(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return decodeURIComponent(e)}catch{return De(e)}}function Y(e,r){if(!(typeof e=="string"&&typeof r=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e===""||r==="")return[];const n=e.indexOf(r);return n===-1?[]:[e.slice(0,n),e.slice(n+r.length)]}function Oe(e,r){const n={};if(Array.isArray(r))for(const t of r){const i=Object.getOwnPropertyDescriptor(e,t);i?.enumerable&&Object.defineProperty(n,t,i)}else for(const t of Reflect.ownKeys(e)){const i=Object.getOwnPropertyDescriptor(e,t);if(i.enumerable){const a=e[t];r(t,a,e)&&Object.defineProperty(n,t,i)}}return n}const Re=e=>e==null,Te=e=>encodeURIComponent(e).replace(/[!'()*]/g,r=>`%${r.charCodeAt(0).toString(16).toUpperCase()}`),I=Symbol("encodeFragmentIdentifier");function _e(e){switch(e.arrayFormat){case"index":return r=>(n,t)=>{const i=n.length;return t===void 0||e.skipNull&&t===null||e.skipEmptyString&&t===""?n:t===null?[...n,[m(r,e),"[",i,"]"].join("")]:[...n,[m(r,e),"[",m(i,e),"]=",m(t,e)].join("")]};case"bracket":return r=>(n,t)=>t===void 0||e.skipNull&&t===null||e.skipEmptyString&&t===""?n:t===null?[...n,[m(r,e),"[]"].join("")]:[...n,[m(r,e),"[]=",m(t,e)].join("")];case"colon-list-separator":return r=>(n,t)=>t===void 0||e.skipNull&&t===null||e.skipEmptyString&&t===""?n:t===null?[...n,[m(r,e),":list="].join("")]:[...n,[m(r,e),":list=",m(t,e)].join("")];case"comma":case"separator":case"bracket-separator":{const r=e.arrayFormat==="bracket-separator"?"[]=":"=";return n=>(t,i)=>i===void 0||e.skipNull&&i===null||e.skipEmptyString&&i===""?t:(i=i===null?"":i,t.length===0?[[m(n,e),r,m(i,e)].join("")]:[[t,m(i,e)].join(e.arrayFormatSeparator)])}default:return r=>(n,t)=>t===void 0||e.skipNull&&t===null||e.skipEmptyString&&t===""?n:t===null?[...n,m(r,e)]:[...n,[m(r,e),"=",m(t,e)].join("")]}}function $e(e){let r;switch(e.arrayFormat){case"index":return(n,t,i)=>{if(r=/\[(\d*)]$/.exec(n),n=n.replace(/\[\d*]$/,""),!r){i[n]=t;return}i[n]===void 0&&(i[n]={}),i[n][r[1]]=t};case"bracket":return(n,t,i)=>{if(r=/(\[])$/.exec(n),n=n.replace(/\[]$/,""),!r){i[n]=t;return}if(i[n]===void 0){i[n]=[t];return}i[n]=[...i[n],t]};case"colon-list-separator":return(n,t,i)=>{if(r=/(:list)$/.exec(n),n=n.replace(/:list$/,""),!r){i[n]=t;return}if(i[n]===void 0){i[n]=[t];return}i[n]=[...i[n],t]};case"comma":case"separator":return(n,t,i)=>{const a=typeof t=="string"&&t.includes(e.arrayFormatSeparator),c=typeof t=="string"&&!a&&x(t,e).includes(e.arrayFormatSeparator);t=c?x(t,e):t;const o=a||c?t.split(e.arrayFormatSeparator).map(u=>x(u,e)):t===null?t:x(t,e);i[n]=o};case"bracket-separator":return(n,t,i)=>{const a=/(\[])$/.test(n);if(n=n.replace(/\[]$/,""),!a){i[n]=t&&x(t,e);return}const c=t===null?[]:t.split(e.arrayFormatSeparator).map(o=>x(o,e));if(i[n]===void 0){i[n]=c;return}i[n]=[...i[n],...c]};default:return(n,t,i)=>{if(i[n]===void 0){i[n]=t;return}i[n]=[...[i[n]].flat(),t]}}}function J(e){if(typeof e!="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function m(e,r){return r.encode?r.strict?Te(e):encodeURIComponent(e):e}function x(e,r){return r.decode?Ie(e):e}function X(e){return Array.isArray(e)?e.sort():typeof e=="object"?X(Object.keys(e)).sort((r,n)=>Number(r)-Number(n)).map(r=>e[r]):e}function Z(e){const r=e.indexOf("#");return r!==-1&&(e=e.slice(0,r)),e}function Le(e){let r="";const n=e.indexOf("#");return n!==-1&&(r=e.slice(n)),r}function U(e,r){return r.parseNumbers&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?e=Number(e):r.parseBooleans&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")&&(e=e.toLowerCase()==="true"),e}function T(e){e=Z(e);const r=e.indexOf("?");return r===-1?"":e.slice(r+1)}function _(e,r){r={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,...r},J(r.arrayFormatSeparator);const n=$e(r),t=Object.create(null);if(typeof e!="string"||(e=e.trim().replace(/^[?#&]/,""),!e))return t;for(const i of e.split("&")){if(i==="")continue;const a=r.decode?i.replace(/\+/g," "):i;let[c,o]=Y(a,"=");c===void 0&&(c=a),o=o===void 0?null:["comma","separator","bracket-separator"].includes(r.arrayFormat)?o:x(o,r),n(x(c,r),o,t)}for(const[i,a]of Object.entries(t))if(typeof a=="object"&&a!==null)for(const[c,o]of Object.entries(a))a[c]=U(o,r);else t[i]=U(a,r);return r.sort===!1?t:(r.sort===!0?Object.keys(t).sort():Object.keys(t).sort(r.sort)).reduce((i,a)=>{const c=t[a];return c&&typeof c=="object"&&!Array.isArray(c)?i[a]=X(c):i[a]=c,i},Object.create(null))}function v(e,r){if(!e)return"";r={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...r},J(r.arrayFormatSeparator);const n=c=>r.skipNull&&Re(e[c])||r.skipEmptyString&&e[c]==="",t=_e(r),i={};for(const[c,o]of Object.entries(e))n(c)||(i[c]=o);const a=Object.keys(i);return r.sort!==!1&&a.sort(r.sort),a.map(c=>{const o=e[c];return o===void 0?"":o===null?m(c,r):Array.isArray(o)?o.length===0&&r.arrayFormat==="bracket-separator"?m(c,r)+"[]":o.reduce(t(c),[]).join("&"):m(c,r)+"="+m(o,r)}).filter(c=>c.length>0).join("&")}function ee(e,r){r={decode:!0,...r};let[n,t]=Y(e,"#");return n===void 0&&(n=e),{url:n?.split("?")?.[0]??"",query:_(T(e),r),...r&&r.parseFragmentIdentifier&&t?{fragmentIdentifier:x(t,r)}:{}}}function re(e,r){r={encode:!0,strict:!0,[I]:!0,...r};const n=Z(e.url).split("?")[0]||"",t=T(e.url),i={..._(t,{sort:!1}),...e.query};let a=v(i,r);a&&(a=`?${a}`);let c=Le(e.url);if(e.fragmentIdentifier){const o=new URL(n);o.hash=e.fragmentIdentifier,c=r[I]?o.hash:`#${e.fragmentIdentifier}`}return`${n}${a}${c}`}function ne(e,r,n){n={parseFragmentIdentifier:!0,[I]:!1,...n};const{url:t,query:i,fragmentIdentifier:a}=ee(e,n);return re({url:t,query:Oe(i,r),fragmentIdentifier:a},n)}function Me(e,r,n){const t=Array.isArray(r)?i=>!r.includes(i):(i,a)=>!r(i,a);return ne(e,t,n)}const ze=Object.freeze(Object.defineProperty({__proto__:null,exclude:Me,extract:T,parse:_,parseUrl:ee,pick:ne,stringify:v,stringifyUrl:re},Symbol.toStringTag,{value:"Module"})),te={24:"#48283a99",25:"#432a4e99",26:"#2d2a4e99",27:"#2a434e99"},H=["#4DB3FF","#80B300","#FF6655","#FF99E6","#33FFCC","#e633c8","#dbe812","#FF1A66","#991AFF","#E6B333","#1AB399","#4D8066","#CC9999","#00E680","#809980","#E6FF80","#1AFF33","#999933","#E6331A","#CCCC00","#66E64D","#4D80CC","#9900B3","#4DB380","#FF4D4D"],Be=({chart:e,children:r=null})=>{const n=e.otherChartInstances.slice().sort((a,c)=>c.mix-a.mix),[t,i]=Fe(e.label);return s.jsxs(w,{p:"xs",bdrs:"xl",gap:"sm",align:"center",wrap:"nowrap",children:[s.jsx(be,{type:t,level:i??"?"}),s.jsx(S,{size:"xl",lh:"xs",fw:"bold",style:{textOverflow:"ellipsis",overflow:"hidden"},component:ae,to:q.leaderboard.sharedChart.getPath({sharedChartId:e.id}),children:e.songName})," ",s.jsx(f,{component:"span",c:"dimmed",children:e.difficulty?`(${e.difficulty.toFixed(1)}) `:""}),s.jsx(S,{href:`https://youtube.com/results?${ze.stringify({search_query:`${e.songName} ${e.label}`.replace(/( -)|(- )/g," ")})}`,target:"_blank",rel:"noopener noreferrer",fz:"xl",lh:1,children:s.jsx(fe,{})}),n.map(a=>a.level===e.level?null:s.jsxs(C,{color:te[a.mix],children:[K[a.mix],": ",a.label]},a.mix)),r]})},Pe=({resultId:e})=>s.jsxs("a",{href:`https://api.pumpking.top:3001/results/${e}/screenshot`,target:"_blank",rel:"noopener noreferrer",children:["screenshot ",s.jsx(he,{style:{fontSize:"80%"}})]}),Ge=()=>{const e=ce();return le(E.admin.deleteResult.mutationOptions({onSuccess:()=>{e.invalidateQueries(E.charts.search.infiniteQueryFilter()),e.invalidateQueries(E.charts.chart.queryFilter()),e.invalidateQueries(E.players.stats.queryFilter())}}))},k={xx:26,phoenix:27},Ue=({mix:e})=>{const{scoring:r}=je();return!r||!k[r]?null:Ee(e)&&k[r]!==e?s.jsx(C,{size:"xs",color:te[e],children:K[e]}):null},He=!1,ke=(e,r)=>{if(r.recognitionType==="manual")return s.jsxs("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[!r.isExactGainedDate&&s.jsx("div",{children:e.EXACT_DATE_UNKNOWN}),s.jsxs("div",{children:[e.SCORE_ADDED_MANUALLY," ",new Date(r.added).toLocaleDateString()]}),r.isExactGainedDate&&s.jsxs("div",{children:[e.SCORE_WAS_TAKEN," ",new Date(r.gained).toLocaleDateString()]})]});if(r.isExactGainedDate)return new Date(r.gained).toLocaleDateString();{const n=r.recognitionType==null?`${e.FROM} my best ${e.OR} machine best`:r.recognitionType==="personal_best"?`${e.FROM} my best`:r.recognitionType==="machine_best"?`${e.FROM} machine best`:"???";return s.jsxs("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[s.jsx("div",{children:e.EXACT_DATE_UNKNOWN}),s.jsxs("div",{children:[e.SCORE_WAS_TAKEN," ",n]}),s.jsxs("div",{children:[e.DATE_RECORDED,": ",new Date(r.gained).toLocaleDateString()]})]})}},qe=({result:e,chart:r})=>{const n=V(),t=W(),i=O(R),a=i.sortChartsBy==="pp",c=e.playerId===t.data?.id,o=!!t.data?.is_admin,u=Ge(),A=async()=>{window.confirm(n.DELETE_RESULT_CONFIRM)&&u.mutate({resultId:e.id})},l=e.playerId==null?null:q.profile.getPath({id:e.playerId});return s.jsxs("tr",{className:h({latest:e.isLatestScore}),style:e.highlightIndex>=0?{background:H[e.highlightIndex]+"3A",outline:`1px solid ${H[e.highlightIndex]}A0`}:{},children:[s.jsx("td",{className:"place",style:c?{fontWeight:"bold",color:"#ddd"}:{},children:`#${r.results.findIndex(d=>d.id===e.id)+1}`}),s.jsx("td",{className:h("nickname"),style:e.highlightIndex>=0||c?{fontWeight:"bold"}:{},children:s.jsxs(w,{gap:"xxs",align:"center",children:[e.region?s.jsx(oe,{region:e.region,size:"sm"}):null,s.jsxs(f,{size:"sm",style:{flex:"1 1 0",textOverflow:"ellipsis",overflow:"hidden"},children:[l?s.jsx(S,{component:L,to:l,size:"sm",children:e.playerName}):s.jsx("span",{children:e.playerName}),!!e.placeDifference&&s.jsxs(f,{component:"span",ml:"xxs",children:[s.jsx(xe,{style:{paddingTop:"0.3em",width:"0.8em"}}),e.placeDifference]})]}),a&&e.highlightIndex>=0&&s.jsxs("span",{className:"debug-elo-info",children:[" ",e.pp&&`${e.pp}pp`]}),s.jsxs(w,{gap:"0.25em",ml:"auto",wrap:"nowrap",children:[e.mods?.includes("HJ")&&s.jsx(C,{color:"orange",size:"xs",children:"HJ"}),e.mods?.includes("VJ")&&s.jsx(C,{color:"red",size:"xs",children:"R"}),s.jsx(Ue,{mix:e.mix})]})]})}),s.jsx("td",{className:h("score"),children:s.jsxs(N,{withArrow:!0,shadow:"sm",width:200,position:"top",children:[s.jsx(N.Target,{children:s.jsxs("span",{className:"score-span",children:[s.jsx("span",{children:Math.floor(e.score/1e3)}),s.jsxs("span",{style:{fontSize:"70%"},children:[",",`${e.score%1e3}`.padStart(3,"0")]})]})}),s.jsx(N.Dropdown,{p:"sm",children:s.jsxs(M,{children:[s.jsx(Pe,{resultId:e.id}),s.jsxs(M,{component:"dl",m:0,style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:"0.25rem 0.5rem"},children:[He,s.jsxs(f,{component:"dt",c:"dimmed",size:"sm",children:[n.PLAYER,":"]}),s.jsx(f,{component:"dd",m:0,size:"sm",children:l?s.jsxs(S,{component:L,to:l,children:[e.playerName,e.playerNameArcade?` (${e.playerNameArcade})`:null]}):`${e.playerName}`+e.playerNameArcade?` (${e.playerNameArcade})`:null}),e.exp?s.jsxs(s.Fragment,{children:[s.jsxs(f,{component:"dt",c:"dimmed",size:"sm",fw:700,children:[n.EXP,":"]}),s.jsxs(f,{component:"dd",m:0,size:"sm",fw:700,bg:"dark.5",px:4,children:["+",e.exp]})]}):null,e.pp?s.jsxs(s.Fragment,{children:[s.jsxs(f,{component:"dt",c:"dimmed",size:"sm",fw:700,children:[n.PP,":"]}),s.jsxs(f,{component:"dd",m:0,size:"sm",fw:700,bg:"dark.5",px:4,children:[e.pp,"pp"]})]}):null,e.isExactGainedDate&&e.mods&&s.jsxs(s.Fragment,{children:[s.jsxs(f,{component:"dt",c:"dimmed",size:"sm",children:[n.MODS,":"]}),s.jsx(f,{component:"dd",m:0,size:"sm",children:e.mods})]}),e.isExactGainedDate&&e.combo!=null&&s.jsxs(s.Fragment,{children:[s.jsxs(f,{component:"dt",c:"dimmed",size:"sm",hiddenFrom:"sm",children:[n.COMBO,":"]}),s.jsx(f,{component:"dd",m:0,size:"sm",hiddenFrom:"sm",children:e.combo})]})]}),!e.isExactGainedDate&&s.jsx(de,{mt:"xs",lh:"xs",color:"yellow",p:"xxs",pl:"xs",pr:"xs",icon:s.jsx(pe,{}),styles:{message:{fontSize:"var(--mantine-font-size-sm)"}},children:n.MY_BEST_SCORE_WARNING}),e.isExactGainedDate&&!e.scoreIncrease&&s.jsx(f,{size:"sm",mt:"xs",children:n.SIGHTREAD}),o&&s.jsx(me,{mt:"xs",size:"xs",color:"red",variant:"light",fullWidth:!0,leftSection:s.jsx(ue,{}),onClick:A,loading:u.isPending,children:n.DELETE_RESULT})]})})]})}),s.jsx("td",{className:h("grade"),children:s.jsx("div",{className:"img-holder",children:!i.scoring||i.scoring==="phoenix"?s.jsx(B,{w:"auto",h:"1rem",score:e.score,isPass:e.passed??!1,scoring:"phoenix"}):s.jsx(B,{w:"auto",h:"1rem",grade:e.grade,scoring:"xx"})})}),s.jsx("td",{className:h("number","miss"),children:e.stats[4]}),s.jsx("td",{className:h("number","bad"),children:e.stats[3]}),s.jsx("td",{className:h("number","good"),children:e.stats[2]}),s.jsx("td",{className:h("number","great"),children:e.stats[1]}),s.jsx("td",{className:h("number","perfect"),children:e.stats[0]}),s.jsx("td",{className:h("combo","desktop-only"),children:e.combo&&`${e.combo}x`}),s.jsx("td",{className:h("date",{latest:e.isLatestScore}),children:s.jsx(Se,{label:ke(n,e),children:s.jsxs("div",{children:[Ae(n,new Date(e.gained)),e.isExactGainedDate?"":"?"]})})})]},e.id)};function Ve(e){return ge({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8ZM7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708l2-2ZM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10Z"}}]})(e)}const We=({children:e,count:r})=>{const[n,t]=y.useState(!0),i=V();return n&&r>1?s.jsx("tr",{className:"results-collapser",onClick:()=>t(!1),children:s.jsx("td",{colSpan:"20",children:s.jsx("div",{children:s.jsx("button",{children:r&&i.SHOW_MORE_RESULTS?s.jsx(s.Fragment,{children:i.SHOW_MORE_RESULTS(r)}):s.jsx(Ve,{})})})})}):s.jsx(s.Fragment,{children:e})},er=y.memo(function({chart:r}){const n=W().data?.id,t=O(R),i=Ne(),[a,c]=y.useState(!1),o=r.results.reduce((l,d)=>d.isHidden?l+1:l,0),u=r.results.filter(l=>a||!l.isHidden).map((l,d,p)=>{const j=new Date(l.added).getTime()===new Date(r.updatedOn).getTime(),F=t.sortChartsBy==="pp"&&!t.sortChartsByPlayers?.length?p[0].playerId:null,b=(F?[F,...i]:i).indexOf(l.playerId??-1),g=j||l.playerId===n||b>=0;let $=0;if(l.scoreIncrease&&j){const se=l.score-l.scoreIncrease;$=z.findLastIndex(ie=>ie.score>se,p)-d}return{...l,topPlace:d+1,isImportant:g,highlightIndex:b,placeDifference:$,isLatestScore:j}}).map((l,d,p)=>{const F=p.slice(d+1,d+1+2).some(g=>g.isImportant),b=p.slice(d-2,d).some(g=>g.isImportant);return{...l,isCollapsible:!l.isImportant&&!F&&!b}}),A=u.reduce((l,d)=>(l.length?l[l.length-1].isGroupCollapsible!==d.isCollapsible?l.push({isGroupCollapsible:d.isCollapsible,results:[d]}):l[l.length-1].results.push(d):l.push({isGroupCollapsible:d.isCollapsible,results:[d]}),l),[]);return s.jsxs("div",{className:"song-block",children:[s.jsx(Be,{chart:r,children:o>0&&s.jsx(Ce,{ml:"auto",variant:"subtle","aria-label":"Show all",onClick:()=>c(!a),children:s.jsx(ye,{})})}),s.jsx("div",{className:"charts",children:!z.isEmpty(u)&&s.jsx("div",{className:"chart",children:s.jsx("div",{className:"results",children:s.jsx("table",{children:s.jsx("tbody",{children:A.map(l=>{const d=l.results.map(p=>s.jsx(y.Fragment,{children:s.jsx(qe,{chart:r,result:p})},p.id));return l.isGroupCollapsible?s.jsx(We,{count:d.length,children:d},`group-${l.results[0].id}`):s.jsx(y.Fragment,{children:d},`group-${l.results[0].id}`)})})})})})})]})});export{er as C};
//# sourceMappingURL=Chart-CWPpW3wl.js.map
