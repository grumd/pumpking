import{j as s,N as ie,h as z,a2 as f,G as V,a3 as N,u as I,c as W,$ as h,a4 as ce,a5 as L,a0 as S,s as T,A as oe,r as j}from"./index-B6NMOy3i.js";import{_ as B}from"./fp-spnMem_c.js";import{f as de,g as le,h as me,i as fe,G as he,j as xe}from"./index.esm-B-2bGnWi.js";import{b as D,f as O,u as pe}from"./useFilter-BpW6s_pc.js";import{l as ge,C as ue,M as q,i as je,G,T as ye,A as Fe}from"./Grade-asTTVZl4.js";import{g as be}from"./timeAgo-B23DxlQU.js";import{F as Ne}from"./Flex-D4AyTukK.js";const Se=()=>{const e=D(O);return[...e.playersAll??[],...e.playersNone??[],...e.playersSome??[],...e.sortChartsByPlayers??[]]},K="%[a-f0-9]{2}",M=new RegExp("("+K+")|([^%]+?)","gi"),P=new RegExp("("+K+")+","gi");function E(e,r){try{return[decodeURIComponent(e.join(""))]}catch{}if(e.length===1)return e;r=r||1;const n=e.slice(0,r),t=e.slice(r);return Array.prototype.concat.call([],E(n),E(t))}function Ce(e){try{return decodeURIComponent(e)}catch{let r=e.match(M)||[];for(let n=1;n<r.length;n++)e=E(r,n).join(""),r=e.match(M)||[];return e}}function Ee(e){const r={"%FE%FF":"��","%FF%FE":"��"};let n=P.exec(e);for(;n;){try{r[n[0]]=decodeURIComponent(n[0])}catch{const a=Ce(n[0]);a!==n[0]&&(r[n[0]]=a)}n=P.exec(e)}r["%C2"]="�";const t=Object.keys(r);for(const a of t)e=e.replace(new RegExp(a,"g"),r[a]);return e}function Ae(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return decodeURIComponent(e)}catch{return Ee(e)}}function Y(e,r){if(!(typeof e=="string"&&typeof r=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e===""||r==="")return[];const n=e.indexOf(r);return n===-1?[]:[e.slice(0,n),e.slice(n+r.length)]}function Ie(e,r){const n={};if(Array.isArray(r))for(const t of r){const a=Object.getOwnPropertyDescriptor(e,t);a?.enumerable&&Object.defineProperty(n,t,a)}else for(const t of Reflect.ownKeys(e)){const a=Object.getOwnPropertyDescriptor(e,t);if(a.enumerable){const i=e[t];r(t,i,e)&&Object.defineProperty(n,t,a)}}return n}const De=e=>e==null,Oe=e=>encodeURIComponent(e).replace(/[!'()*]/g,r=>`%${r.charCodeAt(0).toString(16).toUpperCase()}`),A=Symbol("encodeFragmentIdentifier");function we(e){switch(e.arrayFormat){case"index":return r=>(n,t)=>{const a=n.length;return t===void 0||e.skipNull&&t===null||e.skipEmptyString&&t===""?n:t===null?[...n,[m(r,e),"[",a,"]"].join("")]:[...n,[m(r,e),"[",m(a,e),"]=",m(t,e)].join("")]};case"bracket":return r=>(n,t)=>t===void 0||e.skipNull&&t===null||e.skipEmptyString&&t===""?n:t===null?[...n,[m(r,e),"[]"].join("")]:[...n,[m(r,e),"[]=",m(t,e)].join("")];case"colon-list-separator":return r=>(n,t)=>t===void 0||e.skipNull&&t===null||e.skipEmptyString&&t===""?n:t===null?[...n,[m(r,e),":list="].join("")]:[...n,[m(r,e),":list=",m(t,e)].join("")];case"comma":case"separator":case"bracket-separator":{const r=e.arrayFormat==="bracket-separator"?"[]=":"=";return n=>(t,a)=>a===void 0||e.skipNull&&a===null||e.skipEmptyString&&a===""?t:(a=a===null?"":a,t.length===0?[[m(n,e),r,m(a,e)].join("")]:[[t,m(a,e)].join(e.arrayFormatSeparator)])}default:return r=>(n,t)=>t===void 0||e.skipNull&&t===null||e.skipEmptyString&&t===""?n:t===null?[...n,m(r,e)]:[...n,[m(r,e),"=",m(t,e)].join("")]}}function _e(e){let r;switch(e.arrayFormat){case"index":return(n,t,a)=>{if(r=/\[(\d*)]$/.exec(n),n=n.replace(/\[\d*]$/,""),!r){a[n]=t;return}a[n]===void 0&&(a[n]={}),a[n][r[1]]=t};case"bracket":return(n,t,a)=>{if(r=/(\[])$/.exec(n),n=n.replace(/\[]$/,""),!r){a[n]=t;return}if(a[n]===void 0){a[n]=[t];return}a[n]=[...a[n],t]};case"colon-list-separator":return(n,t,a)=>{if(r=/(:list)$/.exec(n),n=n.replace(/:list$/,""),!r){a[n]=t;return}if(a[n]===void 0){a[n]=[t];return}a[n]=[...a[n],t]};case"comma":case"separator":return(n,t,a)=>{const i=typeof t=="string"&&t.includes(e.arrayFormatSeparator),c=typeof t=="string"&&!i&&x(t,e).includes(e.arrayFormatSeparator);t=c?x(t,e):t;const o=i||c?t.split(e.arrayFormatSeparator).map(g=>x(g,e)):t===null?t:x(t,e);a[n]=o};case"bracket-separator":return(n,t,a)=>{const i=/(\[])$/.test(n);if(n=n.replace(/\[]$/,""),!i){a[n]=t&&x(t,e);return}const c=t===null?[]:t.split(e.arrayFormatSeparator).map(o=>x(o,e));if(a[n]===void 0){a[n]=c;return}a[n]=[...a[n],...c]};default:return(n,t,a)=>{if(a[n]===void 0){a[n]=t;return}a[n]=[...[a[n]].flat(),t]}}}function J(e){if(typeof e!="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function m(e,r){return r.encode?r.strict?Oe(e):encodeURIComponent(e):e}function x(e,r){return r.decode?Ae(e):e}function X(e){return Array.isArray(e)?e.sort():typeof e=="object"?X(Object.keys(e)).sort((r,n)=>Number(r)-Number(n)).map(r=>e[r]):e}function Z(e){const r=e.indexOf("#");return r!==-1&&(e=e.slice(0,r)),e}function Re(e){let r="";const n=e.indexOf("#");return n!==-1&&(r=e.slice(n)),r}function U(e,r){return r.parseNumbers&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?e=Number(e):r.parseBooleans&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")&&(e=e.toLowerCase()==="true"),e}function w(e){e=Z(e);const r=e.indexOf("?");return r===-1?"":e.slice(r+1)}function _(e,r){r={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,...r},J(r.arrayFormatSeparator);const n=_e(r),t=Object.create(null);if(typeof e!="string"||(e=e.trim().replace(/^[?#&]/,""),!e))return t;for(const a of e.split("&")){if(a==="")continue;const i=r.decode?a.replace(/\+/g," "):a;let[c,o]=Y(i,"=");c===void 0&&(c=i),o=o===void 0?null:["comma","separator","bracket-separator"].includes(r.arrayFormat)?o:x(o,r),n(x(c,r),o,t)}for(const[a,i]of Object.entries(t))if(typeof i=="object"&&i!==null)for(const[c,o]of Object.entries(i))i[c]=U(o,r);else t[a]=U(i,r);return r.sort===!1?t:(r.sort===!0?Object.keys(t).sort():Object.keys(t).sort(r.sort)).reduce((a,i)=>{const c=t[i];return c&&typeof c=="object"&&!Array.isArray(c)?a[i]=X(c):a[i]=c,a},Object.create(null))}function Q(e,r){if(!e)return"";r={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...r},J(r.arrayFormatSeparator);const n=c=>r.skipNull&&De(e[c])||r.skipEmptyString&&e[c]==="",t=we(r),a={};for(const[c,o]of Object.entries(e))n(c)||(a[c]=o);const i=Object.keys(a);return r.sort!==!1&&i.sort(r.sort),i.map(c=>{const o=e[c];return o===void 0?"":o===null?m(c,r):Array.isArray(o)?o.length===0&&r.arrayFormat==="bracket-separator"?m(c,r)+"[]":o.reduce(t(c),[]).join("&"):m(c,r)+"="+m(o,r)}).filter(c=>c.length>0).join("&")}function v(e,r){r={decode:!0,...r};let[n,t]=Y(e,"#");return n===void 0&&(n=e),{url:n?.split("?")?.[0]??"",query:_(w(e),r),...r&&r.parseFragmentIdentifier&&t?{fragmentIdentifier:x(t,r)}:{}}}function ee(e,r){r={encode:!0,strict:!0,[A]:!0,...r};const n=Z(e.url).split("?")[0]||"",t=w(e.url),a={..._(t,{sort:!1}),...e.query};let i=Q(a,r);i&&(i=`?${i}`);let c=Re(e.url);if(e.fragmentIdentifier){const o=new URL(n);o.hash=e.fragmentIdentifier,c=r[A]?o.hash:`#${e.fragmentIdentifier}`}return`${n}${i}${c}`}function re(e,r,n){n={parseFragmentIdentifier:!0,[A]:!1,...n};const{url:t,query:a,fragmentIdentifier:i}=v(e,n);return ee({url:t,query:Ie(a,r),fragmentIdentifier:i},n)}function $e(e,r,n){const t=Array.isArray(r)?a=>!r.includes(a):(a,i)=>!r(a,i);return re(e,t,n)}const Le=Object.freeze(Object.defineProperty({__proto__:null,exclude:$e,extract:w,parse:_,parseUrl:v,pick:re,stringify:Q,stringifyUrl:ee},Symbol.toStringTag,{value:"Module"})),Te="_songHeader_1ri0k_1",Be="_youtubeLink_1ri0k_15",Ge="_songName_1ri0k_32",C={songHeader:Te,youtubeLink:Be,songName:Ge},ne={24:"#48283a99",25:"#432a4e99",26:"#2d2a4e99",27:"#2a434e99"},H=["#4DB3FF","#80B300","#FF6655","#FF99E6","#33FFCC","#e633c8","#dbe812","#FF1A66","#991AFF","#E6B333","#1AB399","#4D8066","#CC9999","#00E680","#809980","#E6FF80","#1AFF33","#999933","#E6331A","#CCCC00","#66E64D","#4D80CC","#9900B3","#4DB380","#FF4D4D"],Me=({chart:e,children:r=null})=>{const n=e.otherChartInstances.slice().sort((i,c)=>c.mix-i.mix),[t,a]=ge(e.label);return s.jsxs("div",{className:C.songHeader,children:[s.jsx(ue,{type:t,level:a??"?"}),s.jsxs("div",{className:C.songName,children:[s.jsx(ie,{to:z.leaderboard.sharedChart.getPath({sharedChartId:e.id}),children:e.songName})," ",s.jsx(f,{component:"span",c:"dimmed",children:e.difficulty?`(${e.difficulty.toFixed(1)}) `:""})]}),s.jsx("div",{className:C.youtubeLink,children:s.jsx("a",{href:`https://youtube.com/results?${Le.stringify({search_query:`${e.songName} ${e.label}`.replace(/( -)|(- )/g," ")})}`,target:"_blank",rel:"noopener noreferrer",children:s.jsx(de,{})})}),s.jsxs(V,{gap:"xs",ml:"auto",fz:"sm",children:[n.map(i=>i.level===e.level?null:s.jsxs(N,{color:ne[i.mix],children:[q[i.mix],": ",i.label]},i.mix)),r]})]})},Pe=({resultId:e})=>s.jsxs("a",{href:`https://api.pumpking.top:3001/results/${e}/screenshot`,target:"_blank",rel:"noopener noreferrer",children:["screenshot ",s.jsx(le,{style:{fontSize:"80%"}})]}),k={xx:26,phoenix:27},Ue=({mix:e})=>{const{scoring:r}=pe();return!r||!k[r]?null:je(e)&&k[r]!==e?s.jsx(N,{color:ne[e],children:q[e]}):null},He=!1,ke=(e,r)=>{if(r.recognitionType==="manual")return s.jsxs("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[!r.isExactGainedDate&&s.jsx("div",{children:e.EXACT_DATE_UNKNOWN}),s.jsxs("div",{children:[e.SCORE_ADDED_MANUALLY," ",new Date(r.added).toLocaleDateString()]}),r.isExactGainedDate&&s.jsxs("div",{children:[e.SCORE_WAS_TAKEN," ",new Date(r.gained).toLocaleDateString()]})]});if(r.isExactGainedDate)return new Date(r.gained).toLocaleDateString();{const n=r.recognitionType==null?`${e.FROM} my best ${e.OR} machine best`:r.recognitionType==="personal_best"?`${e.FROM} my best`:r.recognitionType==="machine_best"?`${e.FROM} machine best`:"???";return s.jsxs("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[s.jsx("div",{children:e.EXACT_DATE_UNKNOWN}),s.jsxs("div",{children:[e.SCORE_WAS_TAKEN," ",n]}),s.jsxs("div",{children:[e.DATE_RECORDED,": ",new Date(r.gained).toLocaleDateString()]})]})}},ze=({result:e,chart:r})=>{const n=I(),t=W(),a=D(O),i=a.sortChartsBy==="pp",c=e.playerId===t.data?.id,o=e.playerId==null?null:z.profile.getPath({id:e.playerId});return s.jsxs("tr",{className:h({latest:e.isLatestScore}),style:e.highlightIndex>=0?{background:H[e.highlightIndex]+"3A",outline:`1px solid ${H[e.highlightIndex]}A0`}:{},children:[s.jsx("td",{className:"place",style:c?{fontWeight:"bold",color:"#ddd"}:{},children:`#${r.results.findIndex(g=>g.id===e.id)+1}`}),s.jsx("td",{className:h("nickname"),style:e.highlightIndex>=0||c?{fontWeight:"bold"}:{},children:s.jsxs(Ne,{gap:"xxs",align:"center",children:[e.region?s.jsx(ce,{region:e.region}):null,s.jsxs("span",{className:"nickname-text",children:[o?s.jsx(L,{to:o,children:e.playerName}):e.playerName,!!e.placeDifference&&s.jsxs("span",{className:"change-holder up",children:[s.jsx("span",{children:e.placeDifference}),s.jsx(me,{})]}),i&&e.highlightIndex>=0&&s.jsxs("span",{className:"debug-elo-info",children:[" ",e.pp&&`${e.pp}pp`]})]}),s.jsxs(V,{gap:"0.25em",ml:"auto",children:[e.mods?.includes("HJ")&&s.jsx(N,{color:"orange",children:"HJ"}),e.mods?.includes("VJ")&&s.jsx(N,{color:"red",children:"R"}),s.jsx(Ue,{mix:e.mix})]})]})}),s.jsx("td",{className:h("score"),children:s.jsxs(S,{withArrow:!0,shadow:"sm",width:200,position:"top",children:[s.jsx(S.Target,{children:s.jsxs("span",{className:"score-span",children:[!e.scoreIncrease&&s.jsx("span",{style:{fontSize:"80%"},children:"* "}),s.jsx("span",{children:Math.floor(e.score/1e3)}),s.jsxs("span",{style:{fontSize:"70%"},children:[",",`${e.score%1e3}`.padStart(3,"0")]})]})}),s.jsx(S.Dropdown,{p:"sm",children:s.jsxs(T,{children:[s.jsx(Pe,{resultId:e.id}),s.jsxs(T,{component:"dl",m:0,style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:"0.25rem 0.5rem"},children:[He,s.jsxs(f,{component:"dt",c:"dimmed",size:"sm",children:[n.PLAYER,":"]}),s.jsx(f,{component:"dd",m:0,size:"sm",children:o?s.jsxs(L,{to:o,children:[e.playerName," (",e.playerNameArcade,")"]}):`${e.playerName} (${e.playerNameArcade})`}),e.exp?s.jsxs(s.Fragment,{children:[s.jsxs(f,{component:"dt",c:"dimmed",size:"sm",fw:700,children:[n.EXP,":"]}),s.jsxs(f,{component:"dd",m:0,size:"sm",fw:700,bg:"dark.5",px:4,children:["+",e.exp]})]}):null,e.pp?s.jsxs(s.Fragment,{children:[s.jsxs(f,{component:"dt",c:"dimmed",size:"sm",fw:700,children:[n.PP,":"]}),s.jsxs(f,{component:"dd",m:0,size:"sm",fw:700,bg:"dark.5",px:4,children:[e.pp,"pp"]})]}):null,e.isExactGainedDate&&e.mods&&s.jsxs(s.Fragment,{children:[s.jsxs(f,{component:"dt",c:"dimmed",size:"sm",children:[n.MODS,":"]}),s.jsx(f,{component:"dd",m:0,size:"sm",children:e.mods})]}),e.isExactGainedDate&&e.combo!=null&&s.jsxs(s.Fragment,{children:[s.jsxs(f,{component:"dt",c:"dimmed",size:"sm",hiddenFrom:"sm",children:[n.COMBO,":"]}),s.jsx(f,{component:"dd",m:0,size:"sm",hiddenFrom:"sm",children:e.combo})]})]}),!e.isExactGainedDate&&s.jsx(oe,{mt:"xs",lh:"xs",color:"yellow",p:"xxs",pl:"xs",pr:"xs",icon:s.jsx(fe,{}),styles:{message:{fontSize:"var(--mantine-font-size-sm)"}},children:n.MY_BEST_SCORE_WARNING}),e.isExactGainedDate&&!e.scoreIncrease&&s.jsx(f,{size:"sm",mt:"xs",children:n.SIGHTREAD})]})})]})}),s.jsx("td",{className:h("grade"),children:s.jsx("div",{className:"img-holder",children:!a.scoring||a.scoring==="phoenix"?s.jsx(G,{w:"auto",h:"1rem",score:e.score,isPass:e.passed??!1,scoring:"phoenix"}):s.jsx(G,{w:"auto",h:"1rem",grade:e.grade,scoring:"xx"})})}),s.jsx("td",{className:h("number","miss"),children:e.stats[4]}),s.jsx("td",{className:h("number","bad"),children:e.stats[3]}),s.jsx("td",{className:h("number","good"),children:e.stats[2]}),s.jsx("td",{className:h("number","great"),children:e.stats[1]}),s.jsx("td",{className:h("number","perfect"),children:e.stats[0]}),s.jsx("td",{className:h("combo","desktop-only"),children:e.combo&&`${e.combo}x`}),s.jsx("td",{className:h("date",{latest:e.isLatestScore}),children:s.jsx(ye,{label:ke(n,e),children:s.jsxs("div",{children:[be(n,new Date(e.gained)),e.isExactGainedDate?"":"?"]})})})]},e.id)};function Ve(e){return he({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8ZM7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708l2-2ZM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10Z"}}]})(e)}const We=({children:e,count:r})=>{const[n,t]=j.useState(!0),a=I();return n&&r>1?s.jsx("tr",{className:"results-collapser",onClick:()=>t(!1),children:s.jsx("td",{colSpan:"20",children:s.jsx("div",{children:s.jsx("button",{children:r&&a.SHOW_MORE_RESULTS?s.jsx(s.Fragment,{children:a.SHOW_MORE_RESULTS(r)}):s.jsx(Ve,{})})})})}):s.jsx(s.Fragment,{children:e})},er=j.memo(function({chart:r}){const n=W().data?.id,t=D(O),a=Se(),[i,c]=j.useState(!1),o=I(),g=r.results.reduce((d,l)=>l.isHidden?d+1:d,0),R=r.results.filter(d=>i||!d.isHidden).map((d,l,p)=>{const y=d.added===r.updatedOn,F=t.sortChartsBy==="pp"&&!t.sortChartsByPlayers?.length?p[0].playerId:null,b=(F?[F,...a]:a).indexOf(d.playerId??-1),u=y||d.playerId===n||b>=0;let $=0;if(d.scoreIncrease&&y){const te=d.score-d.scoreIncrease;$=B.findLastIndex(ae=>ae.score>te,p)-l}return{...d,topPlace:l+1,isImportant:u,highlightIndex:b,placeDifference:$,isLatestScore:y}}).map((d,l,p)=>{const F=p.slice(l+1,l+1+2).some(u=>u.isImportant),b=p.slice(l-2,l).some(u=>u.isImportant);return{...d,isCollapsible:!d.isImportant&&!F&&!b}}),se=R.reduce((d,l)=>(d.length?d[d.length-1].isGroupCollapsible!==l.isCollapsible?d.push({isGroupCollapsible:l.isCollapsible,results:[l]}):d[d.length-1].results.push(l):d.push({isGroupCollapsible:l.isCollapsible,results:[l]}),d),[]);return s.jsxs("div",{className:"song-block",children:[s.jsx(Me,{chart:r,children:g>0&&s.jsxs(s.Fragment,{children:[s.jsxs(f,{size:"xs",lh:1,children:[o.HIDDEN,": ",g]}),s.jsx(Fe,{variant:"subtle","aria-label":"Show all",onClick:()=>c(!i),children:s.jsx(xe,{})})]})}),s.jsx("div",{className:"charts",children:!B.isEmpty(R)&&s.jsx("div",{className:"chart",children:s.jsx("div",{className:"results",children:s.jsx("table",{children:s.jsx("tbody",{children:se.map(d=>{const l=d.results.map(p=>s.jsx(j.Fragment,{children:s.jsx(ze,{chart:r,result:p})},p.id));return d.isGroupCollapsible?s.jsx(We,{count:l.length,children:l},`group-${d.results[0].id}`):s.jsx(j.Fragment,{children:l},`group-${d.results[0].id}`)})})})})})})]})});export{er as C};
//# sourceMappingURL=Chart-Cm9KmjB1.js.map
