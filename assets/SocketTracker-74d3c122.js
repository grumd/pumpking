import{B as Te,r as u,j as d,aN as U,aF as Pe,R as ke,a7 as we,a3 as Oe,_ as m,t as me,v as be,a as He,aO as Me,aP as Le,a9 as _e,at as Fe,aQ as Ie,aR as We,aS as $e,aT as Ve,aU as k,aV as ge,aW as ze,Q as Ke}from"./index-51e5af50.js";import{c as Ue}from"./index-fa5dac72.js";import{c as Ae}from"./index-600c6899.js";import{C as Xe}from"./ChartLabel-dcd5a873.js";import{C as Ye}from"./Chart-00142672.js";import"./numeral-b6eac470.js";import"./Tooltip-66b2f19e.js";import"./index-cf5e2c2a.js";import"./index-bfc2a002.js";import"./index.esm-72d3b49b.js";var X={exports:{}};X.exports;(function(i,t){(function(){var r;try{r=typeof Intl<"u"&&typeof Intl.Collator<"u"?Intl.Collator("generic",{sensitivity:"base"}):null}catch{console.log("Collator could not be initialized and wouldn't be used")}var e=[],a=[],l={get:function(n,o,s){var c=s&&r&&s.useCollator,p=n.length,g=o.length;if(p===0)return g;if(g===0)return p;var y,v,N,P,f;for(N=0;N<g;++N)e[N]=N,a[N]=o.charCodeAt(N);e[g]=g;var A;if(c)for(N=0;N<p;++N){for(v=N+1,P=0;P<g;++P)y=v,A=r.compare(n.charAt(N),String.fromCharCode(a[P]))===0,v=e[P]+(A?0:1),f=y+1,v>f&&(v=f),f=e[P+1]+1,v>f&&(v=f),e[P]=y;e[P]=v}else for(N=0;N<p;++N){for(v=N+1,P=0;P<g;++P)y=v,A=n.charCodeAt(N)===a[P],v=e[P]+(A?0:1),f=y+1,v>f&&(v=f),f=e[P+1]+1,v>f&&(v=f),e[P]=y;e[P]=v}return v}};i!==null&&i.exports===t?i.exports=l:typeof self<"u"&&typeof self.postMessage=="function"&&typeof self.importScripts=="function"?self.Levenshtein=l:typeof window<"u"&&window!==null&&(window.Levenshtein=l)})()})(X,X.exports);var qe=X.exports;const ve=Te(qe);const Y={ACHIEVEMENT:"ACHIEVEMENT",RANK_UP:"RANK_UP"},Je=(i,t)=>{const r=Pe[i].icon;return d.jsxs("div",{className:"ach-block",children:[r&&d.jsx("div",{className:"ach-icon",children:d.jsx(r,{})}),d.jsx("div",{className:"ach-name",children:i}),d.jsx("div",{className:Ae("progress-background",{complete:t===100,zero:t===0}),style:{height:`${Math.round(t)}%`}})]})},Qe=({playerName:i,achievementName:t,progress:r})=>{const[e,a]=u.useState(r[0]);return u.useEffect(()=>{a(r[1])},[]),d.jsxs("div",{className:"achievement-popup popup",children:[d.jsxs("div",{className:"player",children:[d.jsx(U,{}),d.jsx("span",{children:i}),d.jsx(U,{})]}),d.jsx("div",{className:"ach-holder",children:Je(t,e)}),d.jsx("div",{className:"description",children:Pe[t].description})]})};function Ce(i){var t=!1;return function(){t||(console.warn(i),t=!0)}}var Ge=Ce(`
>> Warning, via react-flip-move <<

When using "wrapperless" mode (by supplying 'typeName' of 'null'), strange things happen when the direct parent has the default "static" position.

FlipMove has added 'position: relative' to this node, to ensure Flip Move animates correctly.

To avoid seeing this warning, simply apply a non-static position to that parent node.
`),Ze=Ce(`
>> Warning, via react-flip-move <<

One or more of Flip Move's child elements have the html attribute 'disabled' set to true.

Please note that this will cause animations to break in Internet Explorer 11 and below. Either remove the disabled attribute or set 'animation' to false.
`),De={elevator:{from:{transform:"scale(0)",opacity:"0"},to:{transform:"",opacity:""}},fade:{from:{opacity:"0"},to:{opacity:""}},accordionVertical:{from:{transform:"scaleY(0)",transformOrigin:"center top"},to:{transform:"",transformOrigin:"center top"}},accordionHorizontal:{from:{transform:"scaleX(0)",transformOrigin:"left center"},to:{transform:"",transformOrigin:"left center"}},none:null},et={elevator:{from:{transform:"scale(1)",opacity:"1"},to:{transform:"scale(0)",opacity:"0"}},fade:{from:{opacity:"1"},to:{opacity:"0"}},accordionVertical:{from:{transform:"scaleY(1)",transformOrigin:"center top"},to:{transform:"scaleY(0)",transformOrigin:"center top"}},accordionHorizontal:{from:{transform:"scaleX(1)",transformOrigin:"left center"},to:{transform:"scaleX(0)",transformOrigin:"left center"}},none:null},tt=De,z="elevator",nt="none",ne=function(t,r){for(var e=0;e<r.length;e++)if(t(r[e],e,r))return r[e]},rt=function(t,r){for(var e=0;e<r.length;e++)if(!t(r[e],e,r))return!1;return!0},q=function(t){return q=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"},q(t)};function it(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r={};return Object.keys(i).forEach(function(e){t.indexOf(e)===-1&&(r[e]=i[e])}),r}function at(i,t){var r=i===t;if(r)return!0;var e=!q(i)||!q(t),a=i.length!==t.length;return e||a?!1:rt(function(l,n){return l===t[n]},i)}function ot(i){var t={};return function(r){return t[r]||(t[r]=i(r)),t[r]}}var st=ot(function(i){return i.replace(/([A-Z])/g,"-$1").toLowerCase()}),lt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Be=function(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")},R=Object.assign||function(i){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(i[e]=r[e])}return i},Se=function(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)},re=function(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i};function ct(i){var t,r;return r=t=function(e){Se(a,e);function a(){return Be(this,a),re(this,e.apply(this,arguments))}return a.prototype.checkChildren=function(n){},a.prototype.convertProps=function(n){var o={children:n.children,easing:n.easing,onStart:n.onStart,onFinish:n.onFinish,onStartAll:n.onStartAll,onFinishAll:n.onFinishAll,typeName:n.typeName,disableAllAnimations:n.disableAllAnimations,getPosition:n.getPosition,maintainContainerHeight:n.maintainContainerHeight,verticalAlignment:n.verticalAlignment,duration:this.convertTimingProp("duration"),delay:this.convertTimingProp("delay"),staggerDurationBy:this.convertTimingProp("staggerDurationBy"),staggerDelayBy:this.convertTimingProp("staggerDelayBy"),appearAnimation:this.convertAnimationProp(n.appearAnimation,tt),enterAnimation:this.convertAnimationProp(n.enterAnimation,De),leaveAnimation:this.convertAnimationProp(n.leaveAnimation,et),delegated:{}};this.checkChildren(o.children);var s=Object.keys(o),c=it(this.props,s);return c.style=R({position:"relative"},c.style),o.delegated=c,o},a.prototype.convertTimingProp=function(n){var o=this.props[n],s=typeof o=="number"?o:parseInt(o,10);if(isNaN(s)){var c=a.defaultProps[n];return c}return s},a.prototype.convertAnimationProp=function(n,o){switch(typeof n>"u"?"undefined":lt(n)){case"boolean":return o[n?z:nt];case"string":{var s=Object.keys(o);return s.indexOf(n)===-1?o[z]:o[n]}default:return n}},a.prototype.render=function(){return ke.createElement(i,this.convertProps(this.props))},a}(u.Component),t.defaultProps={easing:"ease-in-out",duration:350,delay:0,staggerDurationBy:0,staggerDelayBy:0,typeName:"div",enterAnimation:z,leaveAnimation:z,disableAllAnimations:!1,getPosition:function(a){return a.getBoundingClientRect()},maintainContainerHeight:!1,verticalAlignment:"top"},r}function _(i){var t=i.domNode,r=i.styles;Object.keys(r).forEach(function(e){t.style.setProperty(st(e),r[e])})}function dt(){var i={transition:"transitionend","-o-transition":"oTransitionEnd","-moz-transition":"transitionend","-webkit-transition":"webkitTransitionEnd"};if(typeof document>"u")return"";var t=document.createElement("fakeelement"),r=ne(function(e){return t.style.getPropertyValue(e)!==void 0},Object.keys(i));return r?i[r]:""}var pt=function(t){var r=t.childDomNode,e=t.parentDomNode,a=t.getPosition,l=a(e),n=a(r),o=n.top,s=n.left,c=n.right,p=n.bottom,g=n.width,y=n.height;return{top:o-l.top,left:s-l.left,right:l.right-c,bottom:l.bottom-p,width:g,height:y}},ye=function(t){var r=t.childDomNode,e=t.childBoundingBox,a=t.parentBoundingBox,l=t.getPosition,n={top:0,left:0,right:0,bottom:0,height:0,width:0},o=e||n,s=a||n,c=l(r),p={top:c.top-s.top,left:c.left-s.left};return[o.left-p.left,o.top-p.top]},ut=function(t,r){var e=t.domNode,a=t.boundingBox;if(!(!e||!a)){var l=window.getComputedStyle(e),n=["margin-top","margin-left","margin-right"],o=n.reduce(function(p,g){var y,v=l.getPropertyValue(g);return R({},p,(y={},y[g]=Number(v.replace("px","")),y))},{}),s=r==="bottom"?a.top-a.height:a.top,c={position:"absolute",top:s-o["margin-top"]+"px",left:a.left-o["margin-left"]+"px",right:a.right-o["margin-right"]+"px"};_({domNode:e,styles:c})}},ht=function(t){var r=t.domNode,e=t.parentData,a=t.getPosition,l=e.domNode,n=e.boundingBox;if(!(!l||!n)){_({domNode:r,styles:{height:"0"}});var o=n.height,s=a(l).height,c=o-s,p={height:c>0?c+"px":"0"};_({domNode:r,styles:p})}},ft=function(t){if(typeof HTMLElement>"u")return null;if(t instanceof HTMLElement)return t;var r=Oe.findDOMNode(t);return r&&r.nodeType===Node.TEXT_NODE?null:r},mt=function(t,r){var e=r.delay,a=r.duration,l=r.staggerDurationBy,n=r.staggerDelayBy,o=r.easing;e+=t*n,a+=t*l;var s=["transform","opacity"];return s.map(function(c){return c+" "+a+"ms "+o+" "+e+"ms"}).join(", ")},ie=dt(),gt=!ie;function E(i){return i.key||""}function K(i){return u.Children.toArray(i)}var vt=function(i){Se(t,i);function t(){var r,e,a;Be(this,t);for(var l=arguments.length,n=Array(l),o=0;o<l;o++)n[o]=arguments[o];return a=(r=(e=re(this,i.call.apply(i,[this].concat(n))),e),e.state={children:K(e.props?e.props.children:[]).map(function(s){return R({},s,{element:s,appearing:!0})})},e.childrenData={},e.parentData={domNode:null,boundingBox:null},e.heightPlaceholderData={domNode:null},e.remainingAnimations=0,e.childrenToAnimate=[],e.findDOMContainer=function(){var s=we.findDOMNode(e),c=s&&s.parentNode;!c||!(c instanceof HTMLElement)||(window.getComputedStyle(c).position==="static"&&(c.style.position="relative",Ge()),e.parentData.domNode=c)},e.runAnimation=function(){var s=e.state.children.filter(e.doesChildNeedToBeAnimated),c=s.map(function(p){return e.computeInitialStyles(p)});s.forEach(function(p,g){e.remainingAnimations+=1,e.childrenToAnimate.push(E(p)),e.animateChild(p,g,c[g])}),typeof e.props.onStartAll=="function"&&e.callChildrenHook(e.props.onStartAll)},e.doesChildNeedToBeAnimated=function(s){if(!E(s))return!1;var c=e.getChildData(E(s)),p=c.domNode,g=c.boundingBox,y=e.parentData.boundingBox;if(!p)return!1;var v=e.props,N=v.appearAnimation,P=v.enterAnimation,f=v.leaveAnimation,A=v.getPosition,C=s.appearing&&N,w=s.entering&&P,F=s.leaving&&f;if(C||w||F)return!0;var L=ye({childDomNode:p,childBoundingBox:g,parentBoundingBox:y,getPosition:A}),M=L[0],I=L[1];return M!==0||I!==0},r),re(e,a)}return t.prototype.componentDidMount=function(){this.props.typeName===null&&this.findDOMContainer();var e=this.props.appearAnimation&&!this.isAnimationDisabled(this.props);e&&(this.prepForAnimation(),this.runAnimation())},t.prototype.componentDidUpdate=function(e){this.props.typeName===null&&this.findDOMContainer();var a=K(this.props.children).map(function(o){return o.key}),l=K(e.children).map(function(o){return o.key}),n=!at(a,l)&&!this.isAnimationDisabled(this.props);n&&(this.prepForAnimation(),this.runAnimation())},t.prototype.calculateNextSetOfChildren=function(e){var a=this,l=e.map(function(o){var s=a.findChildByKey(o.key),c=!s||s.leaving;return R({},o,{element:o,entering:c})}),n=0;return this.state.children.forEach(function(o,s){var c=!ne(function(y){var v=y.key;return v===E(o)},e);if(!(!c||!a.props.leaveAnimation)){var p=R({},o,{leaving:!0}),g=s+n;l.splice(g,0,p),n+=1}}),l},t.prototype.prepForAnimation=function(){var e=this,a=this.props,l=a.leaveAnimation,n=a.maintainContainerHeight,o=a.getPosition;if(l){var s=this.state.children.filter(function(c){return c.leaving});s.forEach(function(c){var p=e.getChildData(E(c));!e.isAnimationDisabled(e.props)&&p.domNode&&p.domNode.disabled&&Ze(),p.boundingBox&&ut(p,e.props.verticalAlignment)}),n&&this.heightPlaceholderData.domNode&&ht({domNode:this.heightPlaceholderData.domNode,parentData:this.parentData,getPosition:o})}this.state.children.forEach(function(c){var p=e.getChildData(E(c)),g=p.domNode;g&&!c.entering&&!c.leaving&&_({domNode:g,styles:{transition:""}})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e){this.updateBoundingBoxCaches();var a=K(e.children);this.setState({children:this.isAnimationDisabled(e)?a.map(function(l){return R({},l,{element:l})}):this.calculateNextSetOfChildren(a)})},t.prototype.animateChild=function(e,a,l){var n=this,o=this.getChildData(E(e)),s=o.domNode;s&&(_({domNode:s,styles:l}),this.props.onStart&&this.props.onStart(e,s),requestAnimationFrame(function(){requestAnimationFrame(function(){var c={transition:mt(a,n.props),transform:"",opacity:""};e.appearing&&n.props.appearAnimation?c=R({},c,n.props.appearAnimation.to):e.entering&&n.props.enterAnimation?c=R({},c,n.props.enterAnimation.to):e.leaving&&n.props.leaveAnimation&&(c=R({},c,n.props.leaveAnimation.to)),_({domNode:s,styles:c})})}),this.bindTransitionEndHandler(e))},t.prototype.bindTransitionEndHandler=function(e){var a=this,l=this.getChildData(E(e)),n=l.domNode;if(n){var o=function s(c){c.target===n&&(n.style.transition="",a.triggerFinishHooks(e,n),n.removeEventListener(ie,s),e.leaving&&a.removeChildData(E(e)))};n.addEventListener(ie,o)}},t.prototype.triggerFinishHooks=function(e,a){var l=this;if(this.props.onFinish&&this.props.onFinish(e,a),this.remainingAnimations-=1,this.remainingAnimations===0){var n=this.state.children.filter(function(o){var s=o.leaving;return!s}).map(function(o){return R({},o,{element:o.element,appearing:!1,entering:!1})});this.setState({children:n},function(){typeof l.props.onFinishAll=="function"&&l.callChildrenHook(l.props.onFinishAll),l.childrenToAnimate=[]}),this.heightPlaceholderData.domNode&&(this.heightPlaceholderData.domNode.style.height="0")}},t.prototype.callChildrenHook=function(e){var a=this,l=[],n=[];this.childrenToAnimate.forEach(function(o){var s=a.findChildByKey(o);s&&(l.push(s),a.hasChildData(o)&&n.push(a.getChildData(o).domNode))}),e(l,n)},t.prototype.updateBoundingBoxCaches=function(){var e=this,a=this.parentData.domNode;if(a){this.parentData.boundingBox=this.props.getPosition(a);var l=[];this.state.children.forEach(function(n){var o=E(n);if(!o){l.push(null);return}if(!e.hasChildData(o)){l.push(null);return}var s=e.getChildData(o);if(!s.domNode||!n){l.push(null);return}l.push(pt({childDomNode:s.domNode,parentDomNode:a,getPosition:e.props.getPosition}))}),this.state.children.forEach(function(n,o){var s=E(n),c=l[o];s&&e.setChildData(s,{boundingBox:c})})}},t.prototype.computeInitialStyles=function(e){if(e.appearing)return this.props.appearAnimation?this.props.appearAnimation.from:{};if(e.entering)return this.props.enterAnimation?R({position:"",top:"",left:"",right:"",bottom:""},this.props.enterAnimation.from):{};if(e.leaving)return this.props.leaveAnimation?this.props.leaveAnimation.from:{};var a=this.getChildData(E(e)),l=a.domNode,n=a.boundingBox,o=this.parentData.boundingBox;if(!l)return{};var s=ye({childDomNode:l,childBoundingBox:n,parentBoundingBox:o,getPosition:this.props.getPosition}),c=s[0],p=s[1];return{transform:"translate("+c+"px, "+p+"px)"}},t.prototype.isAnimationDisabled=function(e){return gt||e.disableAllAnimations||e.duration===0&&e.delay===0&&e.staggerDurationBy===0&&e.staggerDelayBy===0},t.prototype.findChildByKey=function(e){return ne(function(a){return E(a)===e},this.state.children)},t.prototype.hasChildData=function(e){return Object.prototype.hasOwnProperty.call(this.childrenData,e)},t.prototype.getChildData=function(e){return this.hasChildData(e)?this.childrenData[e]:{}},t.prototype.setChildData=function(e,a){this.childrenData[e]=R({},this.getChildData(e),a)},t.prototype.removeChildData=function(e){delete this.childrenData[e],this.setState(function(a){return R({},a,{children:a.children.filter(function(l){return l.element.key!==e})})})},t.prototype.createHeightPlaceholder=function(){var e=this,a=this.props.typeName,l=a==="ul"||a==="ol",n=l?"li":"div";return u.createElement(n,{key:"height-placeholder",ref:function(s){e.heightPlaceholderData.domNode=s},style:{visibility:"hidden",height:0}})},t.prototype.childrenWithRefs=function(){var e=this;return this.state.children.map(function(a){return u.cloneElement(a.element,{ref:function(n){if(n){var o=ft(n);e.setChildData(E(a),{domNode:o})}}})})},t.prototype.render=function(){var e=this,a=this.props,l=a.typeName,n=a.delegated,o=a.leaveAnimation,s=a.maintainContainerHeight,c=this.childrenWithRefs();if(o&&s&&c.push(this.createHeightPlaceholder()),!l)return c;var p=R({},n,{children:c,ref:function(y){e.parentData.domNode=y}});return u.createElement(l,p)},t}(u.Component),yt=ct(vt);const xt=yt,Nt=(i,t)=>d.jsxs("div",{className:`closest-player ${t?"current-player":""}`,children:[d.jsxs("div",{className:"place",children:["#",i.place]}),d.jsx("div",{className:"name",children:i.name}),d.jsx("div",{className:"elo",children:Math.floor(i.pp)})]}),Pt=({playerName:i,place:[t,r],list:[e,a]})=>{const[l,n]=u.useState(t),[o,s]=u.useState(e);u.useEffect(()=>{s(a),n(r)},[]);const c=Math.min(0,Math.max(-60*(m.size(o)-7),-60*(l-4)));return d.jsxs("div",{className:"rank-up-popup popup",children:[d.jsxs("div",{className:"player",children:[d.jsx(U,{}),d.jsx("span",{children:i}),d.jsx(U,{})]}),d.jsx("div",{className:"ranking-holder",children:d.jsx("div",{className:"moving-list",style:{top:c},children:d.jsx(xt,{duration:4500,delay:2e3,maintainContainerHeight:!0,children:o.map((p,g)=>d.jsx("div",{className:Ae("player-block",{current:g===l-1}),children:Nt(p,g===l-1)},p.id))})})})]})},bt={[Y.ACHIEVEMENT]:Qe,[Y.RANK_UP]:Pt},xe={overlay:{backgroundColor:"rgba(0, 0, 0, 0.1)"},content:{top:null,bottom:null,left:null,right:null,position:null,borderRadius:null,padding:null,background:null,display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",transition:"2.5s opacity ease",opacity:1}},At=i=>({popups:i.popups.popups}),Ct={removePopup:Me},je=({popups:i,removePopup:t})=>{const[r,e]=u.useState(null),a=u.useRef(null);u.useEffect(()=>{if(i.length>0){const s=i[0];e(s),s.persistent||setTimeout(()=>{s&&s.fadeOut?(a.current.style.opacity=0,setTimeout(()=>{e(null),t(s)},2500)):(e(null),t(s))},s.timeout||6e3)}else e(null)},[i,t]);const l=u.useCallback(()=>{r&&r.fadeIn&&(a.current.style.opacity=1)},[r]);let n=xe,o=null;if(r){const s=bt[r.type];o=s?d.jsx(s,{...r.parameters}):d.jsx("div",{children:JSON.stringify(r)}),r.fadeIn&&(n=m.set("content.opacity",0,xe))}return d.jsx("div",{className:"popups-holder",children:d.jsx(He,{isOpen:!!r,contentRef:s=>a.current=s,onAfterOpen:l,style:n,children:o})})};je.propTypes={popups:me.array,removePopup:me.func};const Dt=be(At,Ct)(je),Ne=({player:i,profile:t,label:r,trackedData:e,isLeft:a=!1,preferences:l,topPlayersList:n,addPopup:o})=>{const s=m.getOr({},"playersHiddenStatus",l),c=(f,A)=>{if(!A||A===f)return null;const C=f-A;return d.jsx("span",{className:`change ${C>=0?"pos":"neg"}`,children:C<0?C.toFixed(1):`+${C.toFixed(1)}`})},p=()=>{if(!t.expRank||!t.exp)return null;let f=t.expRankNext?(t.exp-t.expRank.threshold)/(t.expRankNext.threshold-t.expRank.threshold):1;const A=1-f;let C=0;return e.exp[1]&&(f=t.expRankNext?(e.exp[1]-t.expRank.threshold)/(t.expRankNext.threshold-t.expRank.threshold):1,C=1-A-f),d.jsxs("div",{className:"exp-line",children:[d.jsx("div",{className:"taken",style:{width:Math.floor(100*f)+"%"}}),d.jsx("div",{className:"diff",style:{width:Math.ceil(100*C)+"%"}}),d.jsx("div",{className:"rest",style:{width:Math.ceil(100*A)+"%"}})]})},g=n.filter(f=>!s[f.id]),y=m.findIndex({id:t.id},g),v=y<0?[]:g.slice(Math.max(0,y-2),Math.min(y+3,g.length));Le({data:n,resetData:t.name,isDataValid:u.useCallback(f=>m.get("[0].rating",f),[]),onChange:u.useCallback((f,A)=>{const C=m.get("place",m.find({id:t.id},f)),w=m.get("place",m.find({id:t.id},A));C&&w&&C>w&&o({type:Y.RANK_UP,fadeIn:!0,fadeOut:!0,timeout:7500,parameters:{playerName:t.name,place:[C,w],list:[f,A]}})},[o,t.id,t.name])});const[N,P]=_e(r);return d.jsx("div",{className:`player-container ${a?"left":"right"}`,children:i&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"name-with-label",children:[d.jsx("div",{className:"name",children:t.name||i}),d.jsx("div",{className:"chart-label",children:d.jsx(Xe,{type:N,level:P})})]}),t.exp&&t.expRank&&d.jsxs("div",{className:"exp exp-rank",children:[Fe(t.expRank),p()]}),e.exp[0]&&d.jsxs("div",{className:"exp-text",children:[d.jsx("span",{className:"_grey-text",children:"exp:"}),d.jsx("span",{children:Math.round(e.exp[0])}),c(e.exp[0],e.exp[1])]}),e.pp[0]&&d.jsxs("div",{className:"rating",children:[d.jsx("span",{className:"_grey-text",children:"pp:"}),d.jsx("span",{children:Math.round(e.pp[0])}),c(e.pp[0],e.pp[1])]}),d.jsx("div",{className:"closest-players",children:m.map(f=>d.jsxs("div",{className:`closest-player ${t.id===f.id?"current-player":""}`,children:[d.jsxs("div",{className:"place",children:["#",f.place]}),d.jsx("div",{className:"name",children:f.name}),d.jsx("div",{className:"elo",children:Math.floor(f.pp)})]}),v)})]})})},Bt=5*60+10,St=Ue(i=>i.results.profiles,m.flow(m.values,m.orderBy("ratingRaw","desc"),i=>i.map((t,r)=>({place:r+1,...m.pick(["id","name","rating"],t)})))),jt=i=>({isLoading:i.topPerSong.isLoading,songTopData:i.topPerSong.data,error:i.topPerSong.error,profiles:i.results.profiles,topPlayersList:St(i),sharedCharts:i.results.sharedCharts}),Et={fetchTopPerSong:Ie,appendNewResults:We,addPopup:$e,fetchUserPreferences:Ve};function Rt({isLoading:i,fetchTopPerSong:t,fetchUserPreferences:r,appendNewResults:e,songTopData:a,error:l,profiles:n,topPlayersList:o,sharedCharts:s={},addPopup:c}){const[p,g]=u.useState(""),[y,v]=u.useState(""),[N,P]=u.useState(!1),[f,A]=u.useState(null),[C,w]=u.useState(null),[F,L]=u.useState(null),[M,I]=u.useState(null),[W,J]=u.useState(null),[Q,G]=u.useState(""),[ae,oe]=u.useState(null),[se,le]=u.useState(null),B=u.useRef(null),$=u.useRef(null),Z=u.useRef(null),V=u.useRef(null),ee=u.useRef(null),S=u.useMemo(()=>!M||m.isEmpty(n)?{}:m.minBy(x=>ve.get(x.nameArcade,M),m.values(n))||{},[M,n]),j=u.useMemo(()=>!W||m.isEmpty(n)?{}:m.minBy(x=>ve.get(x.nameArcade,W),m.values(n))||{},[W,n]),ce=x=>(h,b)=>{m.keys(h).forEach(D=>{h[D].progress!==b[D].progress&&c({type:Y.ACHIEVEMENT,fadeIn:!0,fadeOut:!0,parameters:{playerName:x,achievementName:D,progress:[h[D].progress,b[D].progress]}})})},de={pp:k(m.get("pp",S),S.name),elo:k(S.ratingRaw,S.name),exp:k(S.exp,S.name),expRank:k(S.expRank,S.name),achievements:k(S.achievements,S.name,ce(S.name))},pe=ge(de),ue={pp:k(m.get("pp",j),j.name),elo:k(j.ratingRaw,j.name),exp:k(j.exp,j.name),expRank:k(j.expRank,j.name),achievements:k(j.achievements,j.name,ce(j.name))},he=ge(ue);u.useEffect(()=>{S.id&&r(S.id).then(x=>{oe(x.preferences)})},[S.id,r]),u.useEffect(()=>{j.id&&r(j.id).then(x=>{le(x.preferences)})},[j.id,r]);const fe=u.useCallback(()=>{A(!0),ee.current&&clearTimeout(ee.current),ee.current=setTimeout(()=>{A(!1),I(null),J(null),w(null),L(null),G(""),oe(null),le(null)},Bt*1e3)},[]);u.useEffect(()=>{V.current=new WebSocket(ze),V.current.onerror=()=>{g("Cannot connect to websocket server, please reload the page")},V.current.onopen=x=>{P(!0)}},[]),u.useEffect(()=>{V.current.onmessage=x=>{fe();try{const h=x&&x.data&&JSON.parse(x.data);if(console.log(h),h.type==="result_screen"){console.log("Resetting tracking because received result screen"),pe(),he();const b=h.data.track_name,D=m.get("left.chart_label",h.data),H=m.get("right.chart_label",h.data),T=m.get("left.result.player_name",h.data),O=m.get("right.result.player_name",h.data);I(T),J(O),w(D),L(H),G(b),e(h.data.gained),t(b,D,H)}else if(h.type==="chart_selected"&&(v(h.data.error||""),(h.data.leftPlayer||h.data.rightPlayer)&&(I(h.data.leftPlayer),J(h.data.rightPlayer)),(h.data.leftLabel||h.data.rightLabel)&&(w(h.data.leftLabel),L(h.data.rightLabel),h.data.text))){const b=h.data.text;G(b),console.log("song name",b,Q),Q!==b&&t(b,h.data.leftLabel,h.data.rightLabel)}}catch(h){console.log("on message error",h),g(`Error: ${h.message}`)}}},[Q,t,fe,e,pe,he]),u.useEffect(()=>{if(B.current&&$.current)if(Z.current){const x=$.current,h=Z.current,b={w:B.current.clientWidth,h:B.current.clientHeight},D=b.w/(x.offsetWidth+h.offsetWidth),H=b.h/Math.max(x.offsetHeight,h.offsetHeight),T=b.w/Math.max(x.offsetWidth,h.offsetWidth),O=b.h/(x.offsetHeight+h.offsetHeight);Math.min(D,H)>Math.min(T,O)?(B.current.style.flexDirection="row",B.current.style.alignItems="center",D>H?B.current.style.transform=`scale(${.98*H})`:B.current.style.transform=`scale(${.98*D})`):(B.current.style.flexDirection="column",B.current.style.alignItems="center",T>O?B.current.style.transform=`scale(${.98*O})`:B.current.style.transform=`scale(${.98*T})`)}else{const x=$.current,h={w:B.current.clientWidth,h:B.current.clientHeight},b=h.w/x.offsetWidth,D=h.h/x.offsetHeight;b<D?B.current.style.transform=`scale(${.98*b})`:B.current.style.transform=`scale(${.98*D})`}});const Ee=m.find({chartLabel:C},a),Re=m.find({chartLabel:F},a),te=m.uniq(m.compact([Ee,Re]));return d.jsxs("div",{className:"tracker-container",children:[d.jsx(Dt,{}),d.jsxs("div",{className:"sidebar",children:[d.jsx(Ne,{player:M,profile:S,label:C,trackedData:de,preferences:ae,topPlayersList:o,isLeft:!0,addPopup:c}),d.jsx(Ne,{player:W,profile:j,label:F,trackedData:ue,preferences:se,topPlayersList:o,addPopup:c})]}),d.jsxs("div",{className:"results",ref:B,children:[(l||p)&&d.jsxs("div",{className:"error",children:[p,d.jsx("br",{}),l&&l.message]}),N&&!M&&!W&&!y&&!i&&m.isEmpty(te)&&(f===null?d.jsx("div",{className:"msg",children:"Waiting for recognizer..."}):f?d.jsx("div",{className:"msg",children:"Waiting for chart select..."}):d.jsx("div",{className:"offline msg",children:"Recognizer is offline"})),N&&(C||F)&&!y&&!i&&m.isEmpty(te)&&"No results for this chart",i&&d.jsx(Ke,{}),!i&&te.map((x,h)=>{const b=m.omitBy(T=>!T,m.getOr({},"playersHiddenStatus",ae)),D=m.omitBy(T=>!T,m.getOr({},"playersHiddenStatus",se)),H=Object.keys(b).reduce((T,O)=>({...T,[O]:b[O]&&D[O]}),{});return d.jsx(Ye,{ref:h===0?$:Z,playersHiddenStatus:H,chart:x,leftProfile:S,rightProfile:j,isSocketView:!0},x.sharedChartId)})]})]})}const Wt=be(jt,Et)(Rt);export{Wt as default};
//# sourceMappingURL=SocketTracker-74d3c122.js.map
