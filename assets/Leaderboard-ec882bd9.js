var Se=Object.defineProperty;var ve=(e,t,a)=>t in e?Se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var j=(e,t,a)=>(ve(e,typeof t!="symbol"?t+"":t,a),a);import{R as ue,t as P,_ as n,j as s,c as J,r as W,F as Ee,C as R,D as V,i as fe,k as ae,l as ne,m as _,L as G,n as be,o as Ce,q as re,s as Oe,v as _e,w as Re,x as Pe,y as Te,z as he,A as ye,B as me,E as je,I as Le,J as T,S as m,K as Q,d as ke,b as Ie,u as He,e as H,M as De,N as le,O as Me,P as Fe,f as we,Q as Be,T as Ue,U as oe,V as We,W as Ye,X as Ke,g as Ge,h as Ve}from"./index-179573be.js";import{R as $e,S as k}from"./index-74a83fdc.js";import{T as D}from"./ToggleButton-2185ae40.js";import{T as Xe}from"./Toggle-c902527b.js";import{O as pe,c as qe,C as ze,F as Qe}from"./Chart-7dbd7984.js";import{c as ee}from"./index-fa5dac72.js";import"./ChartLabel-384d0003.js";import"./Tooltip-ed1dc00c.js";import"./index-c0617087.js";import"./index-d053c0cc.js";class B extends ue.Component{constructor(t){super(t),this.state={value:(n.isNil(t.value)?t.defaultValue:t.value)||""},n.bindAll(["handleChange","handleBlur","handleKeyPress"],this)}componentDidUpdate(t){t.value!==this.props.value&&this.setState({value:this.props.value})}handleChange(t){const a=t.target.value;this.setState({value:a},()=>this.props.onChange(a))}handleBlur(t){const{type:a}=this.props,{value:r}=this.state;if(a==="number"){const o=Number(r);o>=Number(t.target.min)&&o<=Number(t.target.max)?this.props.onBlur(o,t):(this.setState({value:this.props.value}),this.props.onBlur(this.props.value,t))}}handleKeyPress(t){t.key==="Enter"&&this.handleBlur(t)}render(){const{className:t}=this.props;return s.jsx("input",{...n.omit(["defaultValue","onChange"],this.props),className:J(t,"text-input"),value:this.state.value,onBlur:this.handleBlur,onKeyPress:this.handleKeyPress,onInput:this.handleChange,onChange:n.noop})}}j(B,"propTypes",{value:P.any,defaultValue:P.any,onChange:P.func,onBlur:P.func,type:P.string,className:P.string,trimOnBlur:P.bool}),j(B,"defaultProps",{value:null,type:"text",onChange:n.noop,onBlur:n.noop});class Z extends W.PureComponent{constructor(t){super(),this.state={open:t.defaultOpen||!1}}render(){const{children:t,title:a,className:r}=this.props,{open:o}=this.state;return s.jsxs("div",{className:J("collapsible-bar",r,{open:o}),children:[s.jsxs("div",{className:"header",onClick:()=>this.setState(d=>({open:!d.open})),children:[s.jsx("div",{className:"collapse-button",children:s.jsx(Ee,{})}),s.jsx("div",{className:"title",children:a})]}),t&&s.jsx("div",{className:"collapsible-children",children:t})]})}}j(Z,"propTypes",{className:P.string,children:P.any,title:P.any,defaultOpen:P.bool});function Ze({filterValue:e,onChange:t}){const a=n.getOr(R,"range",e),r=n.getOr(null,"type",e),o=n.getOr(V,"duration",e),d=fe();let u=d.FILTER_CHARTS;if(e){const l=r||"";u=a[0]===a[1]?`${l}${a[0]}`:`${l}${a[0]} - ${l}${a[1]}`,u=d.CHARTS+": "+u,n.isEqual(o,V)||(u+=" ***")}const c=l=>{t({range:a,type:r,...l,duration:n.isEmpty(l.duration)?o:l.duration})};return s.jsx("div",{children:s.jsx(pe,{overlayClassName:"chart-range-overlay-outer",overlayItem:s.jsx("button",{className:"filter-charts-button btn btn-sm btn-dark",children:u}),children:s.jsxs("div",{className:"chart-range-overlay",children:[s.jsxs("div",{className:"buttons",children:[s.jsx(D,{text:"Single",active:r==="S",onToggle:l=>{c({type:l?"S":null})}}),s.jsx(D,{text:"Double",active:r==="D",onToggle:l=>{c({type:l?"D":null})}})]}),s.jsx($e,{range:a,min:R[0],max:R[1],onChange:l=>c({range:l})}),s.jsxs("div",{className:"inputs",children:[s.jsx("button",{className:"btn btn-sm btn-dark",onClick:()=>c({range:[Math.max(a[0]-1,R[0]),a[1]]}),children:s.jsx(ae,{})}),s.jsx(B,{type:"number",className:"form-control",min:R[0],max:Math.min(R[1],a[1]),value:a[0],onBlur:l=>{c({range:[l,a[1]]})}}),s.jsx("button",{className:"btn btn-sm btn-dark",onClick:()=>{const l=Math.min(a[0]+1,R[1]);c({range:[l,a[1]<l?l:a[1]]})},children:s.jsx(ne,{})}),s.jsx("div",{className:"_flex-fill"}),s.jsx("button",{className:"btn btn-sm btn-dark",onClick:()=>{const l=Math.max(a[1]-1,R[0]);c({range:[a[0]>l?l:a[0],l]})},children:s.jsx(ae,{})}),s.jsx(B,{type:"number",className:"form-control",min:Math.max(R[0],a[0]),max:R[1],value:a[1],onBlur:l=>c({range:[a[0],l]})}),s.jsx("button",{className:"btn btn-sm btn-dark",onClick:()=>c({range:[a[0],Math.min(a[1]+1,R[1])]}),children:s.jsx(ne,{})})]}),s.jsxs("div",{className:"buttons-duration",children:[s.jsx(D,{text:"Standard",active:o.includes(_.STD),onToggle:l=>{c({duration:l?[...o,_.STD]:n.without([_.STD],o)})}}),s.jsx(D,{text:"Short",active:o.includes(_.SHORT),onToggle:l=>{c({duration:l?[...o,_.SHORT]:n.without([_.SHORT],o)})}}),s.jsx(D,{text:"Remix",active:o.includes(_.REMIX),onToggle:l=>{c({duration:l?[...o,_.REMIX]:n.without([_.REMIX],o)})}}),s.jsx(D,{text:"Full",active:o.includes(_.FULL),onToggle:l=>{c({duration:l?[...o,_.FULL]:n.without([_.FULL],o)})}})]})]})})})}const Je=e=>({...e.presets}),es={loadPresets:Pe,savePreset:Te,openPreset:he,deletePreset:ye,selectPreset:me};class xe extends ue.Component{constructor(){super(...arguments);j(this,"state",{});j(this,"onChangeSelection",a=>{this.props.selectPreset(a.name)});j(this,"onRewritePreset",()=>{const{currentPreset:a}=this.props;this.props.savePreset(a.name)});j(this,"onSavePreset",()=>{const{name:a}=this.state;this.props.savePreset(a),this.setState({isAddingNew:!1})})}componentDidMount(){this.props.loadPresets()}render(){const{presets:a,currentPreset:r,isLoading:o}=this.props,{name:d,isAddingNew:u}=this.state,c=this.context;return s.jsx("div",{children:s.jsx(pe,{overlayItem:s.jsxs("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",children:[s.jsx(be,{}),c.PRESETS]}),children:s.jsxs("div",{className:"presets-control-overlay",children:[s.jsx(k,{className:"select _margin-bottom",classNamePrefix:"select",placeholder:c.PRESETS_PLACEHOLDER,options:a,value:r,onChange:this.props.selectPreset,noOptionsMessage:()=>c.EMPTY}),r&&s.jsxs("div",{className:"buttons-presets _margin-bottom",children:[s.jsx("div",{className:"_flex-fill"}),s.jsxs("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:this.props.openPreset,disabled:o,children:[s.jsx(Ce,{})," ",c.OPEN]}),s.jsxs("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:this.onRewritePreset,disabled:o,children:[s.jsx(re,{})," ",c.OVERWRITE]}),s.jsxs("button",{className:"btn btn-sm btn-dark btn-icon",onClick:this.props.deletePreset,disabled:o,children:[s.jsx(Oe,{})," ",c.DELETE]})]}),!u&&s.jsxs("div",{className:"buttons-presets _margin-bottom",children:[s.jsx("div",{className:"_flex-fill"}),s.jsxs("button",{className:"btn btn-sm btn-dark btn-icon _margin-left _self-align-end",onClick:()=>this.setState({isAddingNew:!0}),disabled:o,children:[s.jsx(_e,{})," ",c.ADD]})]}),u&&s.jsxs("div",{className:"adding-new _margin-bottom",children:[s.jsx(B,{value:d,placeholder:c.PRESET_NAME_PLACEHOLDER,className:"form-control",onChange:l=>this.setState({name:l})}),s.jsxs("button",{className:"btn btn-sm btn-dark btn-icon _margin-left",onClick:this.onSavePreset,disabled:!d||o,children:[s.jsx(re,{})," ",c.SAVE]}),s.jsx("button",{className:"btn btn-sm btn-dark btn-icon _margin-left",onClick:()=>this.setState({isAddingNew:!1}),disabled:o,children:c.CANCEL})]})]})})})}}j(xe,"contextType",G);const ss=Re(Je,es)(xe);var $={exports:{}},ge={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",Ấ:"A",Ắ:"A",Ẳ:"A",Ẵ:"A",Ặ:"A",Æ:"AE",Ầ:"A",Ằ:"A",Ȃ:"A",Ç:"C",Ḉ:"C",È:"E",É:"E",Ê:"E",Ë:"E",Ế:"E",Ḗ:"E",Ề:"E",Ḕ:"E",Ḝ:"E",Ȇ:"E",Ì:"I",Í:"I",Î:"I",Ï:"I",Ḯ:"I",Ȋ:"I",Ð:"D",Ñ:"N",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",Ố:"O",Ṍ:"O",Ṓ:"O",Ȏ:"O",Ù:"U",Ú:"U",Û:"U",Ü:"U",Ý:"Y",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",ấ:"a",ắ:"a",ẳ:"a",ẵ:"a",ặ:"a",æ:"ae",ầ:"a",ằ:"a",ȃ:"a",ç:"c",ḉ:"c",è:"e",é:"e",ê:"e",ë:"e",ế:"e",ḗ:"e",ề:"e",ḕ:"e",ḝ:"e",ȇ:"e",ì:"i",í:"i",î:"i",ï:"i",ḯ:"i",ȋ:"i",ð:"d",ñ:"n",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",ố:"o",ṍ:"o",ṓ:"o",ȏ:"o",ù:"u",ú:"u",û:"u",ü:"u",ý:"y",ÿ:"y",Ā:"A",ā:"a",Ă:"A",ă:"a",Ą:"A",ą:"a",Ć:"C",ć:"c",Ĉ:"C",ĉ:"c",Ċ:"C",ċ:"c",Č:"C",č:"c",C̆:"C",c̆:"c",Ď:"D",ď:"d",Đ:"D",đ:"d",Ē:"E",ē:"e",Ĕ:"E",ĕ:"e",Ė:"E",ė:"e",Ę:"E",ę:"e",Ě:"E",ě:"e",Ĝ:"G",Ǵ:"G",ĝ:"g",ǵ:"g",Ğ:"G",ğ:"g",Ġ:"G",ġ:"g",Ģ:"G",ģ:"g",Ĥ:"H",ĥ:"h",Ħ:"H",ħ:"h",Ḫ:"H",ḫ:"h",Ĩ:"I",ĩ:"i",Ī:"I",ī:"i",Ĭ:"I",ĭ:"i",Į:"I",į:"i",İ:"I",ı:"i",Ĳ:"IJ",ĳ:"ij",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",Ḱ:"K",ḱ:"k",K̆:"K",k̆:"k",Ĺ:"L",ĺ:"l",Ļ:"L",ļ:"l",Ľ:"L",ľ:"l",Ŀ:"L",ŀ:"l",Ł:"l",ł:"l",Ḿ:"M",ḿ:"m",M̆:"M",m̆:"m",Ń:"N",ń:"n",Ņ:"N",ņ:"n",Ň:"N",ň:"n",ŉ:"n",N̆:"N",n̆:"n",Ō:"O",ō:"o",Ŏ:"O",ŏ:"o",Ő:"O",ő:"o",Œ:"OE",œ:"oe",P̆:"P",p̆:"p",Ŕ:"R",ŕ:"r",Ŗ:"R",ŗ:"r",Ř:"R",ř:"r",R̆:"R",r̆:"r",Ȓ:"R",ȓ:"r",Ś:"S",ś:"s",Ŝ:"S",ŝ:"s",Ş:"S",Ș:"S",ș:"s",ş:"s",Š:"S",š:"s",Ţ:"T",ţ:"t",ț:"t",Ț:"T",Ť:"T",ť:"t",Ŧ:"T",ŧ:"t",T̆:"T",t̆:"t",Ũ:"U",ũ:"u",Ū:"U",ū:"u",Ŭ:"U",ŭ:"u",Ů:"U",ů:"u",Ű:"U",ű:"u",Ų:"U",ų:"u",Ȗ:"U",ȗ:"u",V̆:"V",v̆:"v",Ŵ:"W",ŵ:"w",Ẃ:"W",ẃ:"w",X̆:"X",x̆:"x",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Y̆:"Y",y̆:"y",Ź:"Z",ź:"z",Ż:"Z",ż:"z",Ž:"Z",ž:"z",ſ:"s",ƒ:"f",Ơ:"O",ơ:"o",Ư:"U",ư:"u",Ǎ:"A",ǎ:"a",Ǐ:"I",ǐ:"i",Ǒ:"O",ǒ:"o",Ǔ:"U",ǔ:"u",Ǖ:"U",ǖ:"u",Ǘ:"U",ǘ:"u",Ǚ:"U",ǚ:"u",Ǜ:"U",ǜ:"u",Ứ:"U",ứ:"u",Ṹ:"U",ṹ:"u",Ǻ:"A",ǻ:"a",Ǽ:"AE",ǽ:"ae",Ǿ:"O",ǿ:"o",Þ:"TH",þ:"th",Ṕ:"P",ṕ:"p",Ṥ:"S",ṥ:"s",X́:"X",x́:"x",Ѓ:"Г",ѓ:"г",Ќ:"К",ќ:"к",A̋:"A",a̋:"a",E̋:"E",e̋:"e",I̋:"I",i̋:"i",Ǹ:"N",ǹ:"n",Ồ:"O",ồ:"o",Ṑ:"O",ṑ:"o",Ừ:"U",ừ:"u",Ẁ:"W",ẁ:"w",Ỳ:"Y",ỳ:"y",Ȁ:"A",ȁ:"a",Ȅ:"E",ȅ:"e",Ȉ:"I",ȉ:"i",Ȍ:"O",ȍ:"o",Ȑ:"R",ȑ:"r",Ȕ:"U",ȕ:"u",B̌:"B",b̌:"b",Č̣:"C",č̣:"c",Ê̌:"E",ê̌:"e",F̌:"F",f̌:"f",Ǧ:"G",ǧ:"g",Ȟ:"H",ȟ:"h",J̌:"J",ǰ:"j",Ǩ:"K",ǩ:"k",M̌:"M",m̌:"m",P̌:"P",p̌:"p",Q̌:"Q",q̌:"q",Ř̩:"R",ř̩:"r",Ṧ:"S",ṧ:"s",V̌:"V",v̌:"v",W̌:"W",w̌:"w",X̌:"X",x̌:"x",Y̌:"Y",y̌:"y",A̧:"A",a̧:"a",B̧:"B",b̧:"b",Ḑ:"D",ḑ:"d",Ȩ:"E",ȩ:"e",Ɛ̧:"E",ɛ̧:"e",Ḩ:"H",ḩ:"h",I̧:"I",i̧:"i",Ɨ̧:"I",ɨ̧:"i",M̧:"M",m̧:"m",O̧:"O",o̧:"o",Q̧:"Q",q̧:"q",U̧:"U",u̧:"u",X̧:"X",x̧:"x",Z̧:"Z",z̧:"z"},Ne=Object.keys(ge).join("|"),ts=new RegExp(Ne,"g"),as=new RegExp(Ne,""),Ae=function(e){return e.replace(ts,function(t){return ge[t]})},ns=function(e){return!!e.match(as)};$.exports=Ae;$.exports.has=ns;$.exports.remove=Ae;var rs=$.exports;const ls=je(rs);var b={CASE_SENSITIVE_EQUAL:9,EQUAL:8,STARTS_WITH:7,WORD_STARTS_WITH:6,STRING_CASE:5,STRING_CASE_ACRONYM:4,CONTAINS:3,ACRONYM:2,MATCHES:1,NO_MATCH:0},O={CAMEL:.8,PASCAL:.6,KEBAB:.4,SNAKE:.2,NO_CASE:0};se.rankings=b;se.caseRankings=O;function se(e,t,a){if(a===void 0&&(a={}),!t)return e;var r=a,o=r.keys,d=r.threshold,u=d===void 0?b.MATCHES:d,c=e.reduce(l,[]);return c.sort(ms).map(function(v){var g=v.item;return g});function l(v,g,E){var A=os(g,o,t,a),N=A.rankedItem,p=A.rank,S=A.keyIndex,y=A.keyThreshold,M=y===void 0?u:y;return p>=M&&v.push({rankedItem:N,item:g,rank:p,index:E,keyIndex:S}),v}}function os(e,t,a,r){if(!t)return{rankedItem:e,rank:ie(e,a,r),keyIndex:-1,keyThreshold:r.threshold};var o=xs(e,t);return o.reduce(function(d,u,c){var l=d.rank,v=d.keyIndex,g=d.keyThreshold,E=u.itemValue,A=u.attributes,N=ie(E,a,r),p=A.minRanking,S=A.maxRanking,y=A.threshold;return N<p&&N>=b.MATCHES?N=p:N>S&&(N=S),N>l&&(l=N,v=c,g=y),{rankedItem:E,rank:l,keyIndex:v,keyThreshold:g}},{rank:b.NO_MATCH,keyIndex:-1,keyThreshold:r.threshold})}function ie(e,t,a){if(e=ce(e,a),t=ce(t,a),t.length>e.length)return b.NO_MATCH;if(e===t)return b.CASE_SENSITIVE_EQUAL;var r=cs(e),o=ds(e,t,r),d=us(e,t,r);return e=e.toLowerCase(),t=t.toLowerCase(),e===t?b.EQUAL+r:e.indexOf(t)===0?b.STARTS_WITH+r:e.indexOf(" "+t)!==-1?b.WORD_STARTS_WITH+r:o?b.STRING_CASE+r:r>0&&d?b.STRING_CASE_ACRONYM+r:e.indexOf(t)!==-1?b.CONTAINS+r:t.length===1?b.NO_MATCH:is(e).indexOf(t)!==-1?b.ACRONYM+r:hs(e,t)}function is(e){var t="",a=e.split(" ");return a.forEach(function(r){var o=r.split("-");o.forEach(function(d){t+=d.substr(0,1)})}),t}function cs(e){var t=e.toLowerCase()!==e,a=e.indexOf("-")>=0,r=e.indexOf("_")>=0;if(!t&&!r&&a)return O.KEBAB;if(!t&&r&&!a)return O.SNAKE;if(t&&!a&&!r){var o=e[0].toUpperCase()===e[0];return o?O.PASCAL:O.CAMEL}return O.NO_CASE}function ds(e,t,a){var r=e.toLowerCase().indexOf(t.toLowerCase());switch(a){case O.SNAKE:return e[r-1]==="_";case O.KEBAB:return e[r-1]==="-";case O.PASCAL:case O.CAMEL:return r!==-1&&e[r]===e[r].toUpperCase();default:return!1}}function us(e,t,a){var r=null;switch(a){case O.SNAKE:r="_";break;case O.KEBAB:r="-";break;case O.PASCAL:case O.CAMEL:r=/(?=[A-Z])/;break;default:r=null}var o=e.split(r);return t.toLowerCase().split("").reduce(function(d,u,c){var l=o[c];return d&&l&&l[0].toLowerCase()===u},!0)}function hs(e,t){var a=0,r=0;function o(E,A,N){for(var p=N;p<A.length;p++){var S=A[p];if(S===E)return a+=1,p+1}return-1}function d(E){var A=a/t.length,N=b.MATCHES+A*(1/E);return N}var u=o(t[0],e,0);if(u<0)return b.NO_MATCH;r=u;for(var c=1;c<t.length;c++){var l=t[c];r=o(l,e,r);var v=r>-1;if(!v)return b.NO_MATCH}var g=r-u;return d(g)}function ms(e,t){var a=-1,r=1,o=e.rankedItem,d=e.rank,u=e.keyIndex,c=t.rankedItem,l=t.rank,v=t.keyIndex;return d===l?u===v?String(o).localeCompare(c):u<v?a:r:d>l?a:r}function ce(e,t){var a=t.keepDiacritics;return e=""+e,a||(e=ls(e)),e}function ps(e,t){typeof t=="object"&&(t=t.key);var a;return typeof t=="function"?a=t(e):t.indexOf(".")!==-1?a=t.split(".").reduce(function(r,o){return r?r[o]:null},e):a=e[t],a!=null?[].concat(a):null}function xs(e,t){return t.reduce(function(a,r){var o=ps(e,r);return o&&o.forEach(function(d){a.push({itemValue:d,attributes:gs(r)})}),a},[])}function gs(e){return typeof e=="string"&&(e={key:e}),Le({maxRanking:1/0,minRanking:-1/0},e)}const Ns=ee(e=>e.results.players,e=>e.user.data.player.id,(e,t)=>n.flow(n.toPairs,n.map(([,{nickname:a,arcade_name:r,id:o,region:d}])=>({label:`${a} (${r})`,value:a,isCurrentPlayer:t===o})),n.sortBy(a=>a.isCurrentPlayer?"!":n.toLower(a.label)))(e)),As=(e,t)=>{const a=n.getOr(R,"range",e),r=n.getOr(null,"type",e),o=n.getOr(V,"duration",e);return n.filter(d=>o!==V&&!o.includes(d.duration)?!1:d.chartLevel>=a[0]&&d.chartLevel<=a[1]&&(!r||d.chartType.startsWith(r)),t)},Ss=(e,t=Q,a)=>{if(e.length===0)return[];const r=performance.now(),o=a.playersHiddenStatus,d=t.showHiddenFromPreferences,u=n.map("value",t.players),c=n.map("value",t.playersOr),l=n.map("value",t.playersNot),v=n.get("value",t.sortingType),g=n.get("value",t.rank)||T.SHOW_ALL,E=[m.PROTAGONIST,m.PP_ASC,m.PP_DESC,m.NEW_SCORES_PLAYER].includes(v)?n.get("value",t.protagonist):null,A=n.map("value",t.excludeAntagonists),N=[n.orderBy([h=>n.max(n.map(x=>d||!o[x.playerId]?x.dateAddedObject.getTime():0,h.results))],["desc"])],p=E?[n.orderBy([h=>n.max(n.map(x=>x.nickname===E?x.dateAddedObject.getTime():0,h.results))],["desc"])]:N,S=[n.filter(h=>n.map("nickname",h.results).includes(E)),n.map(h=>{const x=n.findIndex({nickname:E},h.results),C=h.results[x].score,I=n.flow([n.take(x),n.uniqBy("nickname"),n.remove(f=>A.includes(f.nickname)||f.score===C)])(h.results),F=Math.sqrt(n.reduce((f,L)=>f+(L.score/C-.99)**2,0,I));return{...h,distanceFromProtagonist:F}}),n.orderBy(["distanceFromProtagonist"],["desc"])],y=(h="desc")=>[n.filter(x=>n.map("nickname",x.results).includes(E)),n.orderBy(x=>n.find({nickname:E},x.results).pp||0,h)],M=(h="desc")=>[n.orderBy(x=>x.difficulty??Number(x.chartLevel),h)],X={[m.DEFAULT]:N,[m.NEW_SCORES_PLAYER]:p,[m.PROTAGONIST]:S,[m.PP_ASC]:y("asc"),[m.PP_DESC]:y("desc"),[m.EASIEST_SONGS]:M("asc"),[m.HARDEST_SONGS]:M("desc")}[v]||N,q=n.flow(n.compact([n.map(h=>{let x=null,C=null;const I=[],F=h.results.filter((f,L)=>{const Y=!g||g===T.SHOW_ALL?!0:g===T.SHOW_ONLY_RANK?f.isRank:g===T.SHOW_ONLY_NORANK?!f.isRank:g===T.SHOW_BEST?!I.includes(f.playerId):!0;g===T.SHOW_BEST&&I.push(f.playerId);const K=(!f.isUnknownPlayer||L===0)&&Y;return K&&((!x||x<f.date)&&(x=f.date),(!C||C<f.dateAdded)&&(C=f.dateAdded)),K},h.results);return{...h,latestScoreDate:x,latestAddedScoreDate:C,results:F}}),t.chartRange&&(h=>As(t.chartRange,h)),(u.length||c.length||l.length)&&n.filter(h=>{const x=n.map("nickname",h.results);return(!u.length||n.every(C=>x.includes(C),u))&&(!c.length||n.some(C=>x.includes(C),c))&&(!l.length||!n.some(C=>x.includes(C),l))}),n.filter(h=>n.size(h.results)),...X,t.song&&(h=>se(h,t.song.trim(),{keys:["song"]}))]))(e);return console.log("Sorting took",performance.now()-r,"ms"),q},vs=ee(e=>e.results.data,e=>e.results.filter,e=>e.preferences.data,Ss),Es=ee(e=>e.results.data,(e,t)=>t.params.sharedChartId,(e,t)=>e.filter(r=>r.sharedChartId==t).map(r=>({...r,latestScoreDate:n.max(n.map("date",r.results)),latestAddedScoreDate:n.max(n.map("dateAdded",r.results))}))),z=10,de=n.memoize(e=>[{label:e.NEW_TO_OLD_SCORES,value:m.DEFAULT},{label:e.NEW_TO_OLD_SCORES_OF_A_PLAYER,value:m.NEW_SCORES_PLAYER},{label:e.WORST_TO_BEST_BY_PP,value:m.PP_ASC},{label:e.BEST_TO_WORST_BY_PP,value:m.PP_DESC},{label:e.EASY_TO_HARD_CHARTS,value:m.EASIEST_SONGS},{label:e.HARD_TO_EASY_CHARTS,value:m.HARDEST_SONGS}]),fs=n.memoize(e=>[{label:e.SHOW_ALL_SCORES,value:T.SHOW_ALL},{label:e.BEST_SCORE,value:T.SHOW_BEST},{label:e.RANK_ONLY,value:T.SHOW_ONLY_RANK},{label:e.ONLY_NO_RANK,value:T.SHOW_ONLY_NORANK}]),Is=()=>{var te;const e=ke(),t=Ie(),a=He(),r=!!t.sharedChartId,o=H(i=>{var w,U;return(U=(w=i.user.data)==null?void 0:w.player)==null?void 0:U.can_add_results_manually}),d=H(Ns),u=H(i=>r?Es(i,{params:t}):vs(i)),c=H(i=>i.results.filter),l=r?Q:c,v=H(i=>i.charts.error||i.tracklist.error),g=H(i=>i.charts.isLoading||i.tracklist.isLoading||i.results.isLoading),E=H(i=>i.presets.presets),[A,N]=W.useState(z),p=W.useContext(G),S=n.curry((i,w)=>{const U={...l,[i]:w};e(De(U)),N(z),le(oe.filter,U)}),y=()=>{e(Ke()),le(oe.filter,Q)},M=async()=>{N(z),g||(await e(Ge()),e(Ve()))},X=n.debounce(300,i=>{S("song",i)}),q=()=>s.jsx(G.Consumer,{children:i=>s.jsxs("div",{className:"simple-search",children:[s.jsx("div",{className:"song-name _margin-right _margin-bottom",children:s.jsx(B,{value:l.song||"",placeholder:i.SONG_NAME_PLACEHOLDER,className:"form-control",onChange:X})}),s.jsx("div",{className:"chart-range _margin-right _margin-bottom",children:s.jsx(Ze,{filterValue:l.chartRange,onChange:S("chartRange")})}),s.jsx("div",{className:"_flex-fill"}),s.jsxs("div",{className:"_flex-row _margin-bottom",children:[s.jsx(ss,{}),s.jsxs("button",{className:"btn btn-sm btn-dark btn-icon _margin-right",onClick:y,children:[s.jsx(We,{})," ",i.RESET_FILTERS]}),s.jsxs("button",{disabled:g,className:"btn btn-sm btn-dark btn-icon",onClick:M,children:[s.jsx(Ye,{})," ",i.REFRESH]})]})]})}),h=()=>s.jsx(G.Consumer,{children:i=>s.jsxs("div",{className:"filters",children:[s.jsxs("div",{className:"people-filters",children:[s.jsx("label",{className:"label",children:i.SHOW_CHARTS_PLAYED_BY}),s.jsxs("div",{className:"players-block",children:[s.jsxs("div",{className:"_margin-right",children:[s.jsx("label",{className:"label",children:i.EACH_OF_THESE}),s.jsx(k,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:i.PLAYERS_PLACEHOLDER,isMulti:!0,options:d,value:n.getOr(null,"players",l),onChange:S("players")})]}),s.jsxs("div",{className:"_margin-right",children:[s.jsx("label",{className:"label",children:i.AND_ANY_OF_THESE}),s.jsx(k,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:i.PLAYERS_PLACEHOLDER,isMulti:!0,options:d,value:n.getOr(null,"playersOr",l),onChange:S("playersOr")})]}),s.jsxs("div",{className:"_margin-right",children:[s.jsx("label",{className:"label",children:i.AND_NONE_OF_THESE}),s.jsx(k,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:i.PLAYERS_PLACEHOLDER,isMulti:!0,options:d,value:n.getOr(null,"playersNot",l),onChange:S("playersNot")})]})]})]}),s.jsx("div",{className:"people-filters",children:s.jsx("div",{className:"players-block",children:s.jsxs("div",{className:"_margin-right",children:[s.jsx("label",{className:"label",children:i.SHOW_RANK}),s.jsx(k,{closeMenuOnSelect:!1,className:"select",classNamePrefix:"select",placeholder:"...",options:fs(i),value:n.getOr(null,"rank",l)||T.SHOW_ALL,onChange:S("rank")})]})})}),s.jsx("div",{children:s.jsx(Xe,{checked:n.getOr(!1,"showHiddenFromPreferences",l),onChange:S("showHiddenFromPreferences"),children:i.SHOW_HIDDEN_PLAYERS})})]})}),x=()=>s.jsxs("div",{className:"sortings",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:p.SORTING_LABEL}),s.jsx(k,{placeholder:p.SORTING_PLACEHOLDER,className:"select",classNamePrefix:"select",isClearable:!1,options:de(p),value:n.getOr(de(p)[0],"sortingType",l),onChange:S("sortingType")})]}),[m.PROTAGONIST,m.PP_ASC,m.PP_DESC,m.NEW_SCORES_PLAYER].includes(n.get("sortingType.value",l))&&s.jsxs("div",{children:[s.jsx("label",{className:"label",children:p.PLAYER_LABEL}),s.jsx(k,{className:J("select players",{"red-border":!n.get("protagonist",l)}),classNamePrefix:"select",placeholder:p.PLAYERS_PLACEHOLDER,options:d,value:n.getOr(null,"protagonist",l),onChange:S("protagonist")})]}),[m.PROTAGONIST].includes(n.get("sortingType.value",l))&&s.jsxs("div",{children:[s.jsx("label",{className:"label",children:p.EXCLUDE_FROM_COMPARISON}),s.jsx(k,{closeMenuOnSelect:!1,className:"select players",classNamePrefix:"select",placeholder:p.PLAYERS_PLACEHOLDER,options:d,isMulti:!0,value:n.getOr([],"excludeAntagonists",l),onChange:S("excludeAntagonists")})]})]}),C=u.length>A,I=n.get("sortingType.value",l),F=[m.PP_ASC,m.PP_DESC].includes(I),f=[m.PROTAGONIST,m.PP_ASC,m.PP_DESC,m.NEW_SCORES_PLAYER].includes(I),L=(te=l==null?void 0:l.protagonist)==null?void 0:te.value,Y=W.useMemo(()=>n.slice(0,qe.length,n.uniq(n.compact([f&&L,...n.map("value",l.players),...n.map("value",l.playersOr)]))),[l.players,l.playersOr,f,L]),K=W.useCallback(i=>s.jsx(ze,{showHiddenPlayers:l.showHiddenFromPreferences,chartIndex:i,showProtagonistPpChange:F,uniqueSelectedNames:Y,protagonistName:L,isChartView:r},u[i].sharedChartId),[l.showHiddenFromPreferences,L,F,Y,u,r]);return s.jsx(Qe.Provider,{value:u,children:s.jsx("div",{className:"leaderboard-page",children:s.jsxs("div",{className:"content",children:[r&&s.jsxs("div",{className:"simple-search",children:[s.jsxs("button",{className:"btn btn-sm btn-dark btn-icon",onClick:()=>a(-1),children:[s.jsx(Me,{})," ",p.BACK_BUTTON]}),s.jsx("div",{className:"_flex-fill"}),o&&s.jsx(Fe,{exact:!0,to:we.leaderboard.sharedChart.addResult.getPath(t),children:s.jsxs("button",{className:"btn btn-sm btn-dark btn-icon",children:[s.jsx(Be,{})," Add result"]})})]}),!r&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"search-block",children:[q(),s.jsx(Z,{title:p.FILTERS,children:h()}),s.jsx(Z,{title:p.SORTING,children:x()})]}),!!E.length&&s.jsxs("div",{className:"presets-buttons",children:[s.jsxs("span",{children:[p.PRESETS,":"]}),E.map(i=>s.jsx(D,{text:i.name,className:"btn btn-sm btn-dark _margin-right",active:n.get("filter",i)===l,onToggle:()=>{e(me(i)),e(he())}},i.name))]})]}),s.jsxs("div",{className:"top-list",children:[g&&s.jsx(Ue,{}),n.isEmpty(u)&&!g&&(v?v.message:p.NO_RESULTS),!g&&Array(A<u.length?A:u.length).fill(()=>{}).map((i,w)=>K(w)),!g&&C&&s.jsx("button",{className:"btn btn-primary",onClick:()=>N(A+10),children:p.SHOW_MORE})]})]})})})};export{Is as default};
//# sourceMappingURL=Leaderboard-ec882bd9.js.map
