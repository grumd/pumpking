import{j as t,a5 as I,x as W,N as oe,T as f,G as K,a6 as C,p as le,q as de,s as S,l as O,o as Q,a3 as h,a7 as me,a8 as B,a4 as A,B as P,A as fe,k as he,r as y}from"./index-B9gjETYj.js";import{_ as G}from"./fp-Dgj3Kg7l.js";import{f as xe,g as pe,h as ue,i as ge,j as je,G as ye,k as Fe}from"./index.esm-DTEx3WGo.js";import{b as _,f as T,u as be}from"./useFilter-DTioUlzs.js";import{l as Ee,C as Ne,M as Y,i as Se,G as U,T as Ce,A as Ae}from"./Grade-BEqe6a0D.js";import{g as De}from"./timeAgo-C9p8lh7j.js";import{F as Ie}from"./Flex-BkS3l2Wg.js";const Re=()=>{const e=_(T);return[...e.playersAll??[],...e.playersNone??[],...e.playersSome??[],...e.sortChartsByPlayers??[]]},J="%[a-f0-9]{2}",k=new RegExp("("+J+")|([^%]+?)","gi"),z=new RegExp("("+J+")+","gi");function R(e,r){try{return[decodeURIComponent(e.join(""))]}catch{}if(e.length===1)return e;r=r||1;const n=e.slice(0,r),s=e.slice(r);return Array.prototype.concat.call([],R(n),R(s))}function we(e){try{return decodeURIComponent(e)}catch{let r=e.match(k)||[];for(let n=1;n<r.length;n++)e=R(r,n).join(""),r=e.match(k)||[];return e}}function Oe(e){const r={"%FE%FF":"��","%FF%FE":"��"};let n=z.exec(e);for(;n;){try{r[n[0]]=decodeURIComponent(n[0])}catch{const i=we(n[0]);i!==n[0]&&(r[n[0]]=i)}n=z.exec(e)}r["%C2"]="�";const s=Object.keys(r);for(const i of s)e=e.replace(new RegExp(i,"g"),r[i]);return e}function _e(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return decodeURIComponent(e)}catch{return Oe(e)}}function X(e,r){if(!(typeof e=="string"&&typeof r=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e===""||r==="")return[];const n=e.indexOf(r);return n===-1?[]:[e.slice(0,n),e.slice(n+r.length)]}function Te(e,r){const n={};if(Array.isArray(r))for(const s of r){const i=Object.getOwnPropertyDescriptor(e,s);i?.enumerable&&Object.defineProperty(n,s,i)}else for(const s of Reflect.ownKeys(e)){const i=Object.getOwnPropertyDescriptor(e,s);if(i.enumerable){const a=e[s];r(s,a,e)&&Object.defineProperty(n,s,i)}}return n}const Le=e=>e==null,$e=e=>encodeURIComponent(e).replace(/[!'()*]/g,r=>`%${r.charCodeAt(0).toString(16).toUpperCase()}`),w=Symbol("encodeFragmentIdentifier");function Me(e){switch(e.arrayFormat){case"index":return r=>(n,s)=>{const i=n.length;return s===void 0||e.skipNull&&s===null||e.skipEmptyString&&s===""?n:s===null?[...n,[m(r,e),"[",i,"]"].join("")]:[...n,[m(r,e),"[",m(i,e),"]=",m(s,e)].join("")]};case"bracket":return r=>(n,s)=>s===void 0||e.skipNull&&s===null||e.skipEmptyString&&s===""?n:s===null?[...n,[m(r,e),"[]"].join("")]:[...n,[m(r,e),"[]=",m(s,e)].join("")];case"colon-list-separator":return r=>(n,s)=>s===void 0||e.skipNull&&s===null||e.skipEmptyString&&s===""?n:s===null?[...n,[m(r,e),":list="].join("")]:[...n,[m(r,e),":list=",m(s,e)].join("")];case"comma":case"separator":case"bracket-separator":{const r=e.arrayFormat==="bracket-separator"?"[]=":"=";return n=>(s,i)=>i===void 0||e.skipNull&&i===null||e.skipEmptyString&&i===""?s:(i=i===null?"":i,s.length===0?[[m(n,e),r,m(i,e)].join("")]:[[s,m(i,e)].join(e.arrayFormatSeparator)])}default:return r=>(n,s)=>s===void 0||e.skipNull&&s===null||e.skipEmptyString&&s===""?n:s===null?[...n,m(r,e)]:[...n,[m(r,e),"=",m(s,e)].join("")]}}function Be(e){let r;switch(e.arrayFormat){case"index":return(n,s,i)=>{if(r=/\[(\d*)]$/.exec(n),n=n.replace(/\[\d*]$/,""),!r){i[n]=s;return}i[n]===void 0&&(i[n]={}),i[n][r[1]]=s};case"bracket":return(n,s,i)=>{if(r=/(\[])$/.exec(n),n=n.replace(/\[]$/,""),!r){i[n]=s;return}if(i[n]===void 0){i[n]=[s];return}i[n]=[...i[n],s]};case"colon-list-separator":return(n,s,i)=>{if(r=/(:list)$/.exec(n),n=n.replace(/:list$/,""),!r){i[n]=s;return}if(i[n]===void 0){i[n]=[s];return}i[n]=[...i[n],s]};case"comma":case"separator":return(n,s,i)=>{const a=typeof s=="string"&&s.includes(e.arrayFormatSeparator),c=typeof s=="string"&&!a&&x(s,e).includes(e.arrayFormatSeparator);s=c?x(s,e):s;const l=a||c?s.split(e.arrayFormatSeparator).map(u=>x(u,e)):s===null?s:x(s,e);i[n]=l};case"bracket-separator":return(n,s,i)=>{const a=/(\[])$/.test(n);if(n=n.replace(/\[]$/,""),!a){i[n]=s&&x(s,e);return}const c=s===null?[]:s.split(e.arrayFormatSeparator).map(l=>x(l,e));if(i[n]===void 0){i[n]=c;return}i[n]=[...i[n],...c]};default:return(n,s,i)=>{if(i[n]===void 0){i[n]=s;return}i[n]=[...[i[n]].flat(),s]}}}function Z(e){if(typeof e!="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function m(e,r){return r.encode?r.strict?$e(e):encodeURIComponent(e):e}function x(e,r){return r.decode?_e(e):e}function v(e){return Array.isArray(e)?e.sort():typeof e=="object"?v(Object.keys(e)).sort((r,n)=>Number(r)-Number(n)).map(r=>e[r]):e}function ee(e){const r=e.indexOf("#");return r!==-1&&(e=e.slice(0,r)),e}function Pe(e){let r="";const n=e.indexOf("#");return n!==-1&&(r=e.slice(n)),r}function H(e,r){return r.parseNumbers&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?e=Number(e):r.parseBooleans&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")&&(e=e.toLowerCase()==="true"),e}function L(e){e=ee(e);const r=e.indexOf("?");return r===-1?"":e.slice(r+1)}function $(e,r){r={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,...r},Z(r.arrayFormatSeparator);const n=Be(r),s=Object.create(null);if(typeof e!="string"||(e=e.trim().replace(/^[?#&]/,""),!e))return s;for(const i of e.split("&")){if(i==="")continue;const a=r.decode?i.replace(/\+/g," "):i;let[c,l]=X(a,"=");c===void 0&&(c=a),l=l===void 0?null:["comma","separator","bracket-separator"].includes(r.arrayFormat)?l:x(l,r),n(x(c,r),l,s)}for(const[i,a]of Object.entries(s))if(typeof a=="object"&&a!==null)for(const[c,l]of Object.entries(a))a[c]=H(l,r);else s[i]=H(a,r);return r.sort===!1?s:(r.sort===!0?Object.keys(s).sort():Object.keys(s).sort(r.sort)).reduce((i,a)=>{const c=s[a];return c&&typeof c=="object"&&!Array.isArray(c)?i[a]=v(c):i[a]=c,i},Object.create(null))}function re(e,r){if(!e)return"";r={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...r},Z(r.arrayFormatSeparator);const n=c=>r.skipNull&&Le(e[c])||r.skipEmptyString&&e[c]==="",s=Me(r),i={};for(const[c,l]of Object.entries(e))n(c)||(i[c]=l);const a=Object.keys(i);return r.sort!==!1&&a.sort(r.sort),a.map(c=>{const l=e[c];return l===void 0?"":l===null?m(c,r):Array.isArray(l)?l.length===0&&r.arrayFormat==="bracket-separator"?m(c,r)+"[]":l.reduce(s(c),[]).join("&"):m(c,r)+"="+m(l,r)}).filter(c=>c.length>0).join("&")}function ne(e,r){r={decode:!0,...r};let[n,s]=X(e,"#");return n===void 0&&(n=e),{url:n?.split("?")?.[0]??"",query:$(L(e),r),...r&&r.parseFragmentIdentifier&&s?{fragmentIdentifier:x(s,r)}:{}}}function te(e,r){r={encode:!0,strict:!0,[w]:!0,...r};const n=ee(e.url).split("?")[0]||"",s=L(e.url),i={...$(s,{sort:!1}),...e.query};let a=re(i,r);a&&(a=`?${a}`);let c=Pe(e.url);if(e.fragmentIdentifier){const l=new URL(n);l.hash=e.fragmentIdentifier,c=r[w]?l.hash:`#${e.fragmentIdentifier}`}return`${n}${a}${c}`}function se(e,r,n){n={parseFragmentIdentifier:!0,[w]:!1,...n};const{url:s,query:i,fragmentIdentifier:a}=ne(e,n);return te({url:s,query:Te(i,r),fragmentIdentifier:a},n)}function Ge(e,r,n){const s=Array.isArray(r)?i=>!r.includes(i):(i,a)=>!r(i,a);return se(e,s,n)}const Ue=Object.freeze(Object.defineProperty({__proto__:null,exclude:Ge,extract:L,parse:$,parseUrl:ne,pick:se,stringify:re,stringifyUrl:te},Symbol.toStringTag,{value:"Module"})),ke="_songHeader_1ri0k_1",ze="_youtubeLink_1ri0k_15",He="_songName_1ri0k_32",D={songHeader:ke,youtubeLink:ze,songName:He},ie={24:"#48283a99",25:"#432a4e99",26:"#2d2a4e99",27:"#2a434e99"},q=["#4DB3FF","#80B300","#FF6655","#FF99E6","#33FFCC","#e633c8","#dbe812","#FF1A66","#991AFF","#E6B333","#1AB399","#4D8066","#CC9999","#00E680","#809980","#E6FF80","#1AFF33","#999933","#E6331A","#CCCC00","#66E64D","#4D80CC","#9900B3","#4DB380","#FF4D4D"],qe=({chart:e,children:r=null})=>{const n=e.otherChartInstances.slice().sort((a,c)=>c.mix-a.mix),[s,i]=Ee(e.label);return t.jsxs("div",{className:D.songHeader,children:[t.jsx(Ne,{type:s,level:i??"?"}),t.jsxs("div",{className:D.songName,children:[t.jsx(I,{size:"xl",fw:"bold",component:oe,to:W.leaderboard.sharedChart.getPath({sharedChartId:e.id}),children:e.songName})," ",t.jsx(f,{component:"span",c:"dimmed",children:e.difficulty?`(${e.difficulty.toFixed(1)}) `:""})]}),t.jsx("div",{className:D.youtubeLink,children:t.jsx("a",{href:`https://youtube.com/results?${Ue.stringify({search_query:`${e.songName} ${e.label}`.replace(/( -)|(- )/g," ")})}`,target:"_blank",rel:"noopener noreferrer",children:t.jsx(xe,{})})}),t.jsxs(K,{gap:"xs",ml:"auto",fz:"sm",children:[n.map(a=>a.level===e.level?null:t.jsxs(C,{color:ie[a.mix],children:[Y[a.mix],": ",a.label]},a.mix)),r]})]})},Ve=({resultId:e})=>t.jsxs("a",{href:`https://api.pumpking.top:3001/results/${e}/screenshot`,target:"_blank",rel:"noopener noreferrer",children:["screenshot ",t.jsx(pe,{style:{fontSize:"80%"}})]}),We=()=>{const e=le();return de(S.admin.deleteResult.mutationOptions({onSuccess:()=>{e.invalidateQueries(S.charts.search.infiniteQueryFilter()),e.invalidateQueries(S.charts.chart.queryFilter()),e.invalidateQueries(S.players.stats.queryFilter())}}))},V={xx:26,phoenix:27},Ke=({mix:e})=>{const{scoring:r}=be();return!r||!V[r]?null:Se(e)&&V[r]!==e?t.jsx(C,{color:ie[e],children:Y[e]}):null},Qe=!1,Ye=(e,r)=>{if(r.recognitionType==="manual")return t.jsxs("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[!r.isExactGainedDate&&t.jsx("div",{children:e.EXACT_DATE_UNKNOWN}),t.jsxs("div",{children:[e.SCORE_ADDED_MANUALLY," ",new Date(r.added).toLocaleDateString()]}),r.isExactGainedDate&&t.jsxs("div",{children:[e.SCORE_WAS_TAKEN," ",new Date(r.gained).toLocaleDateString()]})]});if(r.isExactGainedDate)return new Date(r.gained).toLocaleDateString();{const n=r.recognitionType==null?`${e.FROM} my best ${e.OR} machine best`:r.recognitionType==="personal_best"?`${e.FROM} my best`:r.recognitionType==="machine_best"?`${e.FROM} machine best`:"???";return t.jsxs("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[t.jsx("div",{children:e.EXACT_DATE_UNKNOWN}),t.jsxs("div",{children:[e.SCORE_WAS_TAKEN," ",n]}),t.jsxs("div",{children:[e.DATE_RECORDED,": ",new Date(r.gained).toLocaleDateString()]})]})}},Je=({result:e,chart:r})=>{const n=O(),s=Q(),i=_(T),a=i.sortChartsBy==="pp",c=e.playerId===s.data?.id,l=!!s.data?.is_admin,u=We(),F=async()=>{window.confirm(n.DELETE_RESULT_CONFIRM)&&u.mutate({resultId:e.id})},g=e.playerId==null?null:W.profile.getPath({id:e.playerId});return t.jsxs("tr",{className:h({latest:e.isLatestScore}),style:e.highlightIndex>=0?{background:q[e.highlightIndex]+"3A",outline:`1px solid ${q[e.highlightIndex]}A0`}:{},children:[t.jsx("td",{className:"place",style:c?{fontWeight:"bold",color:"#ddd"}:{},children:`#${r.results.findIndex(o=>o.id===e.id)+1}`}),t.jsx("td",{className:h("nickname"),style:e.highlightIndex>=0||c?{fontWeight:"bold"}:{},children:t.jsxs(Ie,{gap:"xxs",align:"center",children:[e.region?t.jsx(me,{region:e.region}):null,t.jsxs("span",{className:"nickname-text",children:[g?t.jsx(I,{component:B,to:g,children:e.playerName}):e.playerName,!!e.placeDifference&&t.jsxs("span",{className:"change-holder up",children:[t.jsx("span",{children:e.placeDifference}),t.jsx(ue,{})]}),a&&e.highlightIndex>=0&&t.jsxs("span",{className:"debug-elo-info",children:[" ",e.pp&&`${e.pp}pp`]})]}),t.jsxs(K,{gap:"0.25em",ml:"auto",children:[e.mods?.includes("HJ")&&t.jsx(C,{color:"orange",children:"HJ"}),e.mods?.includes("VJ")&&t.jsx(C,{color:"red",children:"R"}),t.jsx(Ke,{mix:e.mix})]})]})}),t.jsx("td",{className:h("score"),children:t.jsxs(A,{withArrow:!0,shadow:"sm",width:200,position:"top",children:[t.jsx(A.Target,{children:t.jsxs("span",{className:"score-span",children:[!e.scoreIncrease&&t.jsx("span",{style:{fontSize:"80%"},children:"* "}),t.jsx("span",{children:Math.floor(e.score/1e3)}),t.jsxs("span",{style:{fontSize:"70%"},children:[",",`${e.score%1e3}`.padStart(3,"0")]})]})}),t.jsx(A.Dropdown,{p:"sm",children:t.jsxs(P,{children:[t.jsx(Ve,{resultId:e.id}),t.jsxs(P,{component:"dl",m:0,style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:"0.25rem 0.5rem"},children:[Qe,t.jsxs(f,{component:"dt",c:"dimmed",size:"sm",children:[n.PLAYER,":"]}),t.jsx(f,{component:"dd",m:0,size:"sm",children:g?t.jsxs(I,{component:B,to:g,children:[e.playerName," (",e.playerNameArcade,")"]}):`${e.playerName} (${e.playerNameArcade})`}),e.exp?t.jsxs(t.Fragment,{children:[t.jsxs(f,{component:"dt",c:"dimmed",size:"sm",fw:700,children:[n.EXP,":"]}),t.jsxs(f,{component:"dd",m:0,size:"sm",fw:700,bg:"dark.5",px:4,children:["+",e.exp]})]}):null,e.pp?t.jsxs(t.Fragment,{children:[t.jsxs(f,{component:"dt",c:"dimmed",size:"sm",fw:700,children:[n.PP,":"]}),t.jsxs(f,{component:"dd",m:0,size:"sm",fw:700,bg:"dark.5",px:4,children:[e.pp,"pp"]})]}):null,e.isExactGainedDate&&e.mods&&t.jsxs(t.Fragment,{children:[t.jsxs(f,{component:"dt",c:"dimmed",size:"sm",children:[n.MODS,":"]}),t.jsx(f,{component:"dd",m:0,size:"sm",children:e.mods})]}),e.isExactGainedDate&&e.combo!=null&&t.jsxs(t.Fragment,{children:[t.jsxs(f,{component:"dt",c:"dimmed",size:"sm",hiddenFrom:"sm",children:[n.COMBO,":"]}),t.jsx(f,{component:"dd",m:0,size:"sm",hiddenFrom:"sm",children:e.combo})]})]}),!e.isExactGainedDate&&t.jsx(fe,{mt:"xs",lh:"xs",color:"yellow",p:"xxs",pl:"xs",pr:"xs",icon:t.jsx(ge,{}),styles:{message:{fontSize:"var(--mantine-font-size-sm)"}},children:n.MY_BEST_SCORE_WARNING}),e.isExactGainedDate&&!e.scoreIncrease&&t.jsx(f,{size:"sm",mt:"xs",children:n.SIGHTREAD}),l&&t.jsx(he,{mt:"xs",size:"xs",color:"red",variant:"light",fullWidth:!0,leftSection:t.jsx(je,{}),onClick:F,loading:u.isPending,children:n.DELETE_RESULT})]})})]})}),t.jsx("td",{className:h("grade"),children:t.jsx("div",{className:"img-holder",children:!i.scoring||i.scoring==="phoenix"?t.jsx(U,{w:"auto",h:"1rem",score:e.score,isPass:e.passed??!1,scoring:"phoenix"}):t.jsx(U,{w:"auto",h:"1rem",grade:e.grade,scoring:"xx"})})}),t.jsx("td",{className:h("number","miss"),children:e.stats[4]}),t.jsx("td",{className:h("number","bad"),children:e.stats[3]}),t.jsx("td",{className:h("number","good"),children:e.stats[2]}),t.jsx("td",{className:h("number","great"),children:e.stats[1]}),t.jsx("td",{className:h("number","perfect"),children:e.stats[0]}),t.jsx("td",{className:h("combo","desktop-only"),children:e.combo&&`${e.combo}x`}),t.jsx("td",{className:h("date",{latest:e.isLatestScore}),children:t.jsx(Ce,{label:Ye(n,e),children:t.jsxs("div",{children:[De(n,new Date(e.gained)),e.isExactGainedDate?"":"?"]})})})]},e.id)};function Xe(e){return ye({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8ZM7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708l2-2ZM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10Z"}}]})(e)}const Ze=({children:e,count:r})=>{const[n,s]=y.useState(!0),i=O();return n&&r>1?t.jsx("tr",{className:"results-collapser",onClick:()=>s(!1),children:t.jsx("td",{colSpan:"20",children:t.jsx("div",{children:t.jsx("button",{children:r&&i.SHOW_MORE_RESULTS?t.jsx(t.Fragment,{children:i.SHOW_MORE_RESULTS(r)}):t.jsx(Xe,{})})})})}):t.jsx(t.Fragment,{children:e})},cr=y.memo(function({chart:r}){const n=Q().data?.id,s=_(T),i=Re(),[a,c]=y.useState(!1),l=O(),u=r.results.reduce((o,d)=>d.isHidden?o+1:o,0),F=r.results.filter(o=>a||!o.isHidden).map((o,d,p)=>{const b=new Date(o.added).getTime()===new Date(r.updatedOn).getTime(),E=s.sortChartsBy==="pp"&&!s.sortChartsByPlayers?.length?p[0].playerId:null,N=(E?[E,...i]:i).indexOf(o.playerId??-1),j=b||o.playerId===n||N>=0;let M=0;if(o.scoreIncrease&&b){const ae=o.score-o.scoreIncrease;M=G.findLastIndex(ce=>ce.score>ae,p)-d}return{...o,topPlace:d+1,isImportant:j,highlightIndex:N,placeDifference:M,isLatestScore:b}}).map((o,d,p)=>{const E=p.slice(d+1,d+1+2).some(j=>j.isImportant),N=p.slice(d-2,d).some(j=>j.isImportant);return{...o,isCollapsible:!o.isImportant&&!E&&!N}}),g=F.reduce((o,d)=>(o.length?o[o.length-1].isGroupCollapsible!==d.isCollapsible?o.push({isGroupCollapsible:d.isCollapsible,results:[d]}):o[o.length-1].results.push(d):o.push({isGroupCollapsible:d.isCollapsible,results:[d]}),o),[]);return t.jsxs("div",{className:"song-block",children:[t.jsx(qe,{chart:r,children:u>0&&t.jsxs(t.Fragment,{children:[t.jsxs(f,{size:"xs",lh:1,children:[l.HIDDEN,": ",u]}),t.jsx(Ae,{variant:"subtle","aria-label":"Show all",onClick:()=>c(!a),children:t.jsx(Fe,{})})]})}),t.jsx("div",{className:"charts",children:!G.isEmpty(F)&&t.jsx("div",{className:"chart",children:t.jsx("div",{className:"results",children:t.jsx("table",{children:t.jsx("tbody",{children:g.map(o=>{const d=o.results.map(p=>t.jsx(y.Fragment,{children:t.jsx(Je,{chart:r,result:p})},p.id));return o.isGroupCollapsible?t.jsx(Ze,{count:d.length,children:d},`group-${o.results[0].id}`):t.jsx(y.Fragment,{children:d},`group-${o.results[0].id}`)})})})})})})]})});export{cr as C};
//# sourceMappingURL=Chart-CIvdZT31.js.map
