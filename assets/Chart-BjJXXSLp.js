import{j as t,G as I,a4 as S,Q as T,a5 as Q,T as f,a6 as A,K as de,A as me,D as C,y as J,J as Y,a3 as h,a7 as fe,a8 as z,P as w,B,E as he,z as xe,r as j}from"./index-D1OnbRLe.js";import{_ as G,A as U}from"./fp-D0TM7b5o.js";import{e as pe,f as ue,g as ge,h as ye,i as je,G as Fe,j as be,k as Ee}from"./index.esm-C3718zaH.js";import{b as _,f as $,u as Ce}from"./useFilter-B9UY1dUX.js";import{l as Se,C as Ae,M as X,i as Ne,G as H,T as De}from"./Grade-B2rY5t8S.js";import{g as we}from"./timeAgo-De1FRsMQ.js";const Ie=()=>{const e=_($);return[...e.playersAll??[],...e.playersNone??[],...e.playersSome??[],...e.sortChartsByPlayers??[]]},Z="%[a-f0-9]{2}",k=new RegExp("("+Z+")|([^%]+?)","gi"),V=new RegExp("("+Z+")+","gi");function R(e,r){try{return[decodeURIComponent(e.join(""))]}catch{}if(e.length===1)return e;r=r||1;const n=e.slice(0,r),s=e.slice(r);return Array.prototype.concat.call([],R(n),R(s))}function Re(e){try{return decodeURIComponent(e)}catch{let r=e.match(k)||[];for(let n=1;n<r.length;n++)e=R(r,n).join(""),r=e.match(k)||[];return e}}function Oe(e){const r={"%FE%FF":"��","%FF%FE":"��"};let n=V.exec(e);for(;n;){try{r[n[0]]=decodeURIComponent(n[0])}catch{const i=Re(n[0]);i!==n[0]&&(r[n[0]]=i)}n=V.exec(e)}r["%C2"]="�";const s=Object.keys(r);for(const i of s)e=e.replace(new RegExp(i,"g"),r[i]);return e}function Te(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return decodeURIComponent(e)}catch{return Oe(e)}}function v(e,r){if(!(typeof e=="string"&&typeof r=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e===""||r==="")return[];const n=e.indexOf(r);return n===-1?[]:[e.slice(0,n),e.slice(n+r.length)]}function _e(e,r){const n={};if(Array.isArray(r))for(const s of r){const i=Object.getOwnPropertyDescriptor(e,s);i?.enumerable&&Object.defineProperty(n,s,i)}else for(const s of Reflect.ownKeys(e)){const i=Object.getOwnPropertyDescriptor(e,s);if(i.enumerable){const a=e[s];r(s,a,e)&&Object.defineProperty(n,s,i)}}return n}const $e=e=>e==null,Le=e=>encodeURIComponent(e).replace(/[!'()*]/g,r=>`%${r.charCodeAt(0).toString(16).toUpperCase()}`),O=Symbol("encodeFragmentIdentifier");function Me(e){switch(e.arrayFormat){case"index":return r=>(n,s)=>{const i=n.length;return s===void 0||e.skipNull&&s===null||e.skipEmptyString&&s===""?n:s===null?[...n,[m(r,e),"[",i,"]"].join("")]:[...n,[m(r,e),"[",m(i,e),"]=",m(s,e)].join("")]};case"bracket":return r=>(n,s)=>s===void 0||e.skipNull&&s===null||e.skipEmptyString&&s===""?n:s===null?[...n,[m(r,e),"[]"].join("")]:[...n,[m(r,e),"[]=",m(s,e)].join("")];case"colon-list-separator":return r=>(n,s)=>s===void 0||e.skipNull&&s===null||e.skipEmptyString&&s===""?n:s===null?[...n,[m(r,e),":list="].join("")]:[...n,[m(r,e),":list=",m(s,e)].join("")];case"comma":case"separator":case"bracket-separator":{const r=e.arrayFormat==="bracket-separator"?"[]=":"=";return n=>(s,i)=>i===void 0||e.skipNull&&i===null||e.skipEmptyString&&i===""?s:(i=i===null?"":i,s.length===0?[[m(n,e),r,m(i,e)].join("")]:[[s,m(i,e)].join(e.arrayFormatSeparator)])}default:return r=>(n,s)=>s===void 0||e.skipNull&&s===null||e.skipEmptyString&&s===""?n:s===null?[...n,m(r,e)]:[...n,[m(r,e),"=",m(s,e)].join("")]}}function Pe(e){let r;switch(e.arrayFormat){case"index":return(n,s,i)=>{if(r=/\[(\d*)]$/.exec(n),n=n.replace(/\[\d*]$/,""),!r){i[n]=s;return}i[n]===void 0&&(i[n]={}),i[n][r[1]]=s};case"bracket":return(n,s,i)=>{if(r=/(\[])$/.exec(n),n=n.replace(/\[]$/,""),!r){i[n]=s;return}if(i[n]===void 0){i[n]=[s];return}i[n]=[...i[n],s]};case"colon-list-separator":return(n,s,i)=>{if(r=/(:list)$/.exec(n),n=n.replace(/:list$/,""),!r){i[n]=s;return}if(i[n]===void 0){i[n]=[s];return}i[n]=[...i[n],s]};case"comma":case"separator":return(n,s,i)=>{const a=typeof s=="string"&&s.includes(e.arrayFormatSeparator),l=typeof s=="string"&&!a&&x(s,e).includes(e.arrayFormatSeparator);s=l?x(s,e):s;const o=a||l?s.split(e.arrayFormatSeparator).map(g=>x(g,e)):s===null?s:x(s,e);i[n]=o};case"bracket-separator":return(n,s,i)=>{const a=/(\[])$/.test(n);if(n=n.replace(/\[]$/,""),!a){i[n]=s&&x(s,e);return}const l=s===null?[]:s.split(e.arrayFormatSeparator).map(o=>x(o,e));if(i[n]===void 0){i[n]=l;return}i[n]=[...i[n],...l]};default:return(n,s,i)=>{if(i[n]===void 0){i[n]=s;return}i[n]=[...[i[n]].flat(),s]}}}function ee(e){if(typeof e!="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function m(e,r){return r.encode?r.strict?Le(e):encodeURIComponent(e):e}function x(e,r){return r.decode?Te(e):e}function re(e){return Array.isArray(e)?e.sort():typeof e=="object"?re(Object.keys(e)).sort((r,n)=>Number(r)-Number(n)).map(r=>e[r]):e}function ne(e){const r=e.indexOf("#");return r!==-1&&(e=e.slice(0,r)),e}function ze(e){let r="";const n=e.indexOf("#");return n!==-1&&(r=e.slice(n)),r}function W(e,r){return r.parseNumbers&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?e=Number(e):r.parseBooleans&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")&&(e=e.toLowerCase()==="true"),e}function L(e){e=ne(e);const r=e.indexOf("?");return r===-1?"":e.slice(r+1)}function M(e,r){r={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,...r},ee(r.arrayFormatSeparator);const n=Pe(r),s=Object.create(null);if(typeof e!="string"||(e=e.trim().replace(/^[?#&]/,""),!e))return s;for(const i of e.split("&")){if(i==="")continue;const a=r.decode?i.replace(/\+/g," "):i;let[l,o]=v(a,"=");l===void 0&&(l=a),o=o===void 0?null:["comma","separator","bracket-separator"].includes(r.arrayFormat)?o:x(o,r),n(x(l,r),o,s)}for(const[i,a]of Object.entries(s))if(typeof a=="object"&&a!==null)for(const[l,o]of Object.entries(a))a[l]=W(o,r);else s[i]=W(a,r);return r.sort===!1?s:(r.sort===!0?Object.keys(s).sort():Object.keys(s).sort(r.sort)).reduce((i,a)=>{const l=s[a];return l&&typeof l=="object"&&!Array.isArray(l)?i[a]=re(l):i[a]=l,i},Object.create(null))}function te(e,r){if(!e)return"";r={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...r},ee(r.arrayFormatSeparator);const n=l=>r.skipNull&&$e(e[l])||r.skipEmptyString&&e[l]==="",s=Me(r),i={};for(const[l,o]of Object.entries(e))n(l)||(i[l]=o);const a=Object.keys(i);return r.sort!==!1&&a.sort(r.sort),a.map(l=>{const o=e[l];return o===void 0?"":o===null?m(l,r):Array.isArray(o)?o.length===0&&r.arrayFormat==="bracket-separator"?m(l,r)+"[]":o.reduce(s(l),[]).join("&"):m(l,r)+"="+m(o,r)}).filter(l=>l.length>0).join("&")}function se(e,r){r={decode:!0,...r};let[n,s]=v(e,"#");return n===void 0&&(n=e),{url:n?.split("?")?.[0]??"",query:M(L(e),r),...r&&r.parseFragmentIdentifier&&s?{fragmentIdentifier:x(s,r)}:{}}}function ie(e,r){r={encode:!0,strict:!0,[O]:!0,...r};const n=ne(e.url).split("?")[0]||"",s=L(e.url),i={...M(s,{sort:!1}),...e.query};let a=te(i,r);a&&(a=`?${a}`);let l=ze(e.url);if(e.fragmentIdentifier){const o=new URL(n);o.hash=e.fragmentIdentifier,l=r[O]?o.hash:`#${e.fragmentIdentifier}`}return`${n}${a}${l}`}function ae(e,r,n){n={parseFragmentIdentifier:!0,[O]:!1,...n};const{url:s,query:i,fragmentIdentifier:a}=se(e,n);return ie({url:s,query:_e(i,r),fragmentIdentifier:a},n)}function Be(e,r,n){const s=Array.isArray(r)?i=>!r.includes(i):(i,a)=>!r(i,a);return ae(e,s,n)}const Ge=Object.freeze(Object.defineProperty({__proto__:null,exclude:Be,extract:L,parse:M,parseUrl:se,pick:ae,stringify:te,stringifyUrl:ie},Symbol.toStringTag,{value:"Module"})),le={24:"#48283a99",25:"#432a4e99",26:"#2d2a4e99",27:"#2a434e99"},q=["#4DB3FF","#80B300","#FF6655","#FF99E6","#33FFCC","#e633c8","#dbe812","#FF1A66","#991AFF","#E6B333","#1AB399","#4D8066","#CC9999","#00E680","#809980","#E6FF80","#1AFF33","#999933","#E6331A","#CCCC00","#66E64D","#4D80CC","#9900B3","#4DB380","#FF4D4D"],Ue=({chart:e,children:r=null})=>{const n=e.otherChartInstances.slice().sort((a,l)=>l.mix-a.mix),[s,i]=Se(e.label);return t.jsxs(I,{p:"xs",bdrs:"xl",gap:"sm",align:"center",wrap:"nowrap",children:[t.jsx(Ae,{type:s,level:i??"?"}),t.jsx(S,{size:"xl",lh:"xs",fw:"bold",style:{textOverflow:"ellipsis",overflow:"hidden"},component:Q,to:T.leaderboard.sharedChart.getPath({sharedChartId:e.id}),children:e.songName})," ",t.jsx(f,{component:"span",c:"dimmed",children:e.difficulty?`(${e.difficulty.toFixed(1)}) `:""}),t.jsx(S,{href:`https://youtube.com/results?${Ge.stringify({search_query:`${e.songName} ${e.label}`.replace(/( -)|(- )/g," ")})}`,target:"_blank",rel:"noopener noreferrer",fz:"xl",lh:1,children:t.jsx(pe,{})}),n.map(a=>a.level===e.level?null:t.jsxs(A,{color:le[a.mix],children:[X[a.mix],": ",a.label]},a.mix)),r]})},He=({resultId:e})=>t.jsxs("a",{href:`https://api.pumpking.top:3001/results/${e}/screenshot`,target:"_blank",rel:"noopener noreferrer",children:["screenshot ",t.jsx(ue,{style:{fontSize:"80%"}})]}),ke=()=>{const e=de();return me(C.admin.deleteResult.mutationOptions({onSuccess:()=>{e.invalidateQueries(C.charts.search.infiniteQueryFilter()),e.invalidateQueries(C.charts.chart.queryFilter()),e.invalidateQueries(C.players.stats.queryFilter())}}))},K={xx:26,phoenix:27},Ve=({mix:e})=>{const{scoring:r}=Ce();return!r||!K[r]?null:Ne(e)&&K[r]!==e?t.jsx(A,{size:"xs",color:le[e],children:X[e]}):null},We=!1,qe=(e,r)=>{if(r.recognitionType==="manual")return t.jsxs("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[!r.isExactGainedDate&&t.jsx("div",{children:e.EXACT_DATE_UNKNOWN}),t.jsxs("div",{children:[e.SCORE_ADDED_MANUALLY," ",new Date(r.added).toLocaleDateString()]}),r.isExactGainedDate&&t.jsxs("div",{children:[e.SCORE_WAS_TAKEN," ",new Date(r.gained).toLocaleDateString()]})]});if(r.isExactGainedDate)return new Date(r.gained).toLocaleDateString();{const n=r.recognitionType==null?`${e.FROM} my best ${e.OR} machine best`:r.recognitionType==="personal_best"?`${e.FROM} my best`:r.recognitionType==="machine_best"?`${e.FROM} machine best`:"???";return t.jsxs("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[t.jsx("div",{children:e.EXACT_DATE_UNKNOWN}),t.jsxs("div",{children:[e.SCORE_WAS_TAKEN," ",n]}),t.jsxs("div",{children:[e.DATE_RECORDED,": ",new Date(r.gained).toLocaleDateString()]})]})}},Ke=({result:e,chart:r})=>{const n=J(),s=Y(),i=_($),a=i.sortChartsBy==="pp",l=e.playerId===s.data?.id,o=!!s.data?.is_admin,g=ke(),N=async()=>{window.confirm(n.DELETE_RESULT_CONFIRM)&&g.mutate({resultId:e.id})},u=e.playerId==null?null:T.profile.getPath({id:e.playerId});return t.jsxs("tr",{className:h({latest:e.isLatestScore}),style:e.highlightIndex>=0?{background:q[e.highlightIndex]+"3A",outline:`1px solid ${q[e.highlightIndex]}A0`}:{},children:[t.jsx("td",{className:"place",style:l?{fontWeight:"bold",color:"#ddd"}:{},children:`#${r.results.findIndex(D=>D.id===e.id)+1}`}),t.jsx("td",{className:h("nickname"),style:e.highlightIndex>=0||l?{fontWeight:"bold"}:{},children:t.jsxs(I,{gap:"xxs",align:"center",children:[e.region?t.jsx(fe,{region:e.region,size:"sm"}):null,t.jsxs(f,{size:"sm",style:{flex:"1 1 0",textOverflow:"ellipsis",overflow:"hidden"},children:[u?t.jsx(S,{component:z,to:u,size:"sm",children:e.playerName}):t.jsx("span",{children:e.playerName}),!!e.placeDifference&&t.jsxs(f,{component:"span",ml:"xxs",children:[t.jsx(ge,{style:{paddingTop:"0.3em",width:"0.8em"}}),e.placeDifference]})]}),a&&e.highlightIndex>=0&&t.jsxs("span",{className:"debug-elo-info",children:[" ",e.pp&&`${e.pp}pp`]}),t.jsxs(I,{gap:"0.25em",ml:"auto",wrap:"nowrap",children:[e.mods?.includes("HJ")&&t.jsx(A,{color:"orange",size:"xs",children:"HJ"}),e.mods?.includes("VJ")&&t.jsx(A,{color:"red",size:"xs",children:"R"}),t.jsx(Ve,{mix:e.mix})]})]})}),t.jsx("td",{className:h("score"),children:t.jsxs(w,{withArrow:!0,shadow:"sm",width:200,position:"top",children:[t.jsx(w.Target,{children:t.jsxs("span",{className:"score-span",children:[t.jsx("span",{children:Math.floor(e.score/1e3)}),t.jsxs("span",{style:{fontSize:"70%"},children:[",",`${e.score%1e3}`.padStart(3,"0")]})]})}),t.jsx(w.Dropdown,{p:"sm",children:t.jsxs(B,{children:[t.jsx(He,{resultId:e.id}),t.jsxs(B,{component:"dl",m:0,style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:"0.25rem 0.5rem"},children:[We,t.jsxs(f,{component:"dt",c:"dimmed",size:"sm",children:[n.PLAYER,":"]}),t.jsx(f,{component:"dd",m:0,size:"sm",children:u?t.jsxs(S,{component:z,to:u,children:[e.playerName,e.playerNameArcade?` (${e.playerNameArcade})`:null]}):`${e.playerName}`+e.playerNameArcade?` (${e.playerNameArcade})`:null}),e.exp?t.jsxs(t.Fragment,{children:[t.jsxs(f,{component:"dt",c:"dimmed",size:"sm",fw:700,children:[n.EXP,":"]}),t.jsxs(f,{component:"dd",m:0,size:"sm",fw:700,bg:"dark.5",px:4,children:["+",e.exp]})]}):null,e.pp?t.jsxs(t.Fragment,{children:[t.jsxs(f,{component:"dt",c:"dimmed",size:"sm",fw:700,children:[n.PP,":"]}),t.jsxs(f,{component:"dd",m:0,size:"sm",fw:700,bg:"dark.5",px:4,children:[e.pp,"pp"]})]}):null,e.isExactGainedDate&&e.mods&&t.jsxs(t.Fragment,{children:[t.jsxs(f,{component:"dt",c:"dimmed",size:"sm",children:[n.MODS,":"]}),t.jsx(f,{component:"dd",m:0,size:"sm",children:e.mods})]}),e.isExactGainedDate&&e.combo!=null&&t.jsxs(t.Fragment,{children:[t.jsxs(f,{component:"dt",c:"dimmed",size:"sm",hiddenFrom:"sm",children:[n.COMBO,":"]}),t.jsx(f,{component:"dd",m:0,size:"sm",hiddenFrom:"sm",children:e.combo})]})]}),!e.isExactGainedDate&&t.jsx(he,{mt:"xs",lh:"xs",color:"yellow",p:"xxs",pl:"xs",pr:"xs",icon:t.jsx(ye,{}),styles:{message:{fontSize:"var(--mantine-font-size-sm)"}},children:n.MY_BEST_SCORE_WARNING}),e.isExactGainedDate&&!e.scoreIncrease&&t.jsx(f,{size:"sm",mt:"xs",children:n.SIGHTREAD}),o&&t.jsx(xe,{mt:"xs",size:"xs",color:"red",variant:"light",fullWidth:!0,leftSection:t.jsx(je,{}),onClick:N,loading:g.isPending,children:n.DELETE_RESULT})]})})]})}),t.jsx("td",{className:h("grade"),children:t.jsx("div",{className:"img-holder",children:!i.scoring||i.scoring==="phoenix"?t.jsx(H,{w:"auto",h:"1rem",score:e.score,isPass:e.passed??!1,scoring:"phoenix"}):t.jsx(H,{w:"auto",h:"1rem",grade:e.grade,scoring:"xx"})})}),t.jsx("td",{className:h("number","miss"),children:e.stats[4]}),t.jsx("td",{className:h("number","bad"),children:e.stats[3]}),t.jsx("td",{className:h("number","good"),children:e.stats[2]}),t.jsx("td",{className:h("number","great"),children:e.stats[1]}),t.jsx("td",{className:h("number","perfect"),children:e.stats[0]}),t.jsx("td",{className:h("combo","desktop-only"),children:e.combo&&`${e.combo}x`}),t.jsx("td",{className:h("date",{latest:e.isLatestScore}),children:t.jsx(De,{label:qe(n,e),children:t.jsxs("div",{children:[we(n,new Date(e.gained)),e.isExactGainedDate?"":"?"]})})})]},e.id)};function Qe(e){return Fe({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8ZM7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708l2-2ZM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10Z"}}]})(e)}const Je=({children:e,count:r})=>{const[n,s]=j.useState(!0),i=J();return n&&r>1?t.jsx("tr",{className:"results-collapser",onClick:()=>s(!1),children:t.jsx("td",{colSpan:"20",children:t.jsx("div",{children:t.jsx("button",{children:r&&i.SHOW_MORE_RESULTS?t.jsx(t.Fragment,{children:i.SHOW_MORE_RESULTS(r)}):t.jsx(Qe,{})})})})}):t.jsx(t.Fragment,{children:e})},tr=j.memo(function({chart:r}){const n=Y().data,s=n?.id,i=n?.can_add_results_manually,a=_($),l=Ie(),[o,g]=j.useState(!1),N=r.results.reduce((c,d)=>d.isHidden?c+1:c,0),u=r.results.filter(c=>o||!c.isHidden).map((c,d,p)=>{const F=new Date(c.added).getTime()===new Date(r.updatedOn).getTime(),b=a.sortChartsBy==="pp"&&!a.sortChartsByPlayers?.length?p[0].playerId:null,E=(b?[b,...l]:l).indexOf(c.playerId??-1),y=F||c.playerId===s||E>=0;let P=0;if(c.scoreIncrease&&F){const ce=c.score-c.scoreIncrease;P=G.findLastIndex(oe=>oe.score>ce,p)-d}return{...c,topPlace:d+1,isImportant:y,highlightIndex:E,placeDifference:P,isLatestScore:F}}).map((c,d,p)=>{const b=p.slice(d+1,d+1+2).some(y=>y.isImportant),E=p.slice(d-2,d).some(y=>y.isImportant);return{...c,isCollapsible:!c.isImportant&&!b&&!E}}),D=u.reduce((c,d)=>(c.length?c[c.length-1].isGroupCollapsible!==d.isCollapsible?c.push({isGroupCollapsible:d.isCollapsible,results:[d]}):c[c.length-1].results.push(d):c.push({isGroupCollapsible:d.isCollapsible,results:[d]}),c),[]);return t.jsxs("div",{className:"song-block",children:[t.jsxs(Ue,{chart:r,children:[i&&t.jsx(U,{ml:"auto",variant:"subtle","aria-label":"Add result",component:Q,to:T.leaderboard.sharedChart.addResult.getPath({sharedChartId:String(r.id)}),children:t.jsx(be,{})}),N>0&&t.jsx(U,{ml:i?void 0:"auto",variant:"subtle","aria-label":"Show all",onClick:()=>g(!o),children:t.jsx(Ee,{})})]}),t.jsx("div",{className:"charts",children:!G.isEmpty(u)&&t.jsx("div",{className:"chart",children:t.jsx("div",{className:"results",children:t.jsx("table",{children:t.jsx("tbody",{children:D.map(c=>{const d=c.results.map(p=>t.jsx(j.Fragment,{children:t.jsx(Ke,{chart:r,result:p})},p.id));return c.isGroupCollapsible?t.jsx(Je,{count:d.length,children:d},`group-${c.results[0].id}`):t.jsx(j.Fragment,{children:d},`group-${c.results[0].id}`)})})})})})})]})});export{tr as C};
//# sourceMappingURL=Chart-BjJXXSLp.js.map
