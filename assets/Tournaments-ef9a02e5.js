import{u as C,aj as D,r as y,ak as j,a7 as a,al as E,j as e,Q as P,W as b,N as R,e as _,i as A}from"./index-149cb18e.js";import{c as F}from"./index-917c6aae.js";import{n as $}from"./numeral-bd0644fa.js";import{C as I}from"./ChartLabel-f6ae5821.js";function O(){const o=C(),g=D(),[n,v]=y.useState(null),d=j(s=>s.tournament.data),f=j(s=>s.results.profiles),T=j(s=>s.tournament.isLoading),N=j(s=>a.get("player.id",s.user.data));if(y.useEffect(()=>{g(E())},[g]),y.useEffect(()=>{if(N&&!n&&a.get("brackets",d)){const s=a.find(c=>c.playerIds.includes(N),d.brackets);s&&v(s)}},[N,n,d]),T||a.isEmpty(f))return e.jsx(P,{});const{tournament:i,brackets:w}=d;if(!i)return null;const S=new Date(i.start_date),L=S.toLocaleString("default",{month:"long"}),k=`${S.getFullYear()} ${L}`;return e.jsxs("div",{className:"tournaments-page",children:[e.jsx("header",{children:k}),e.jsxs("div",{className:"description",children:[e.jsxs("div",{className:"labeled-item",children:[e.jsx("div",{className:"title",children:o.START_DATE}),e.jsx("div",{className:"text",children:new Date(i.start_date).toLocaleDateString()})]}),e.jsxs("div",{className:"labeled-item",children:[e.jsx("div",{className:"title",children:o.END_DATE}),e.jsx("div",{className:"text",children:new Date(i.end_date).toLocaleDateString()})]})]}),e.jsx("div",{className:"brackets-title",children:o.BRACKETS}),e.jsx("div",{className:"brackets",children:w.map(s=>e.jsxs("div",{className:F("bracket",{active:s.name===a.get("name",n)}),onClick:()=>v(s),children:[e.jsx("div",{className:"bracket-name",children:s.name}),s.charts.map(c=>{const[l,m]=b(c.label);return e.jsxs("div",{className:"chart",children:[e.jsx(I,{type:l,level:m})," ",c.trackName]},c.sharedChartId)})]},s.name))}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"results-title",children:o.RESULTS}),e.jsx("div",{className:"results",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"player-name",children:o.PLAYER}),e.jsx("th",{className:"total",children:o.TOTAL}),n.charts.map(s=>{const[c,l]=b(s.label);return e.jsx("th",{colSpan:2,children:e.jsxs("div",{className:"chart-header",children:[e.jsx(I,{type:c,level:l})," ",e.jsx(R,{exact:!0,to:_.leaderboard.sharedChart.getPath({sharedChartId:s.sharedChartId}),children:s.trackName})]})},s.sharedChartId)})]})}),e.jsx("tbody",{children:(()=>{const s=a.flow(a.groupBy("player_id"),a.mapValues(a.flow(a.map(t=>({...t,columnIndex:a.findIndex({sharedChartId:t.shared_chart},n.charts)})),a.groupBy("columnIndex"))))(n.scores),c=n.charts.map((t,r)=>({...t,maxScore:a.flow(a.values,a.flatMap(r),a.maxBy("score"),a.get("score"))(s)})),l=a.mapValues(a.flow(a.toPairs,a.map(([t,r])=>{const h=c[t].maxScore,u=a.flow(a.maxBy("score"),a.get("score"))(r),x=(u/h*100).toFixed(1);return[t,{playerName:r[0].player_name,score:u,percent:x,percentRaw:u/h}]}),t=>{const r=a.sumBy("[1].percentRaw",t);return{infoByIndex:a.fromPairs(t),totalPercentRaw:r,totalPercent:(r*100).toFixed(1)}}),s),m=a.flow(a.keys,a.orderBy(t=>l[t].totalPercentRaw,["desc"]))(l),B=a.remove(t=>m.includes(a.toString(t))||!f[t],n.playerIds);return[...m,...B].map(t=>{const r=l[t]||{},h=a.get("name",f[t])||r.playerName;return e.jsxs("tr",{children:[e.jsx("td",{className:"player-name",children:h}),e.jsx("td",{className:"total",children:r.totalPercent||0}),n.charts.map((u,x)=>{const p=r.infoByIndex&&r.infoByIndex[x];return e.jsxs(A.Fragment,{children:[e.jsx("td",{children:p&&`${p.percent}%`}),e.jsx("td",{children:p&&$(p.score).format("0,0")})]},x)})]},t)})})()})]})})]})]})}export{O as default};
//# sourceMappingURL=Tournaments-ef9a02e5.js.map
