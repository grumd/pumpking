import{ab as w,ac as D,u as B,ad as k,r as g,ae as N,_ as t,j as e,O as A,N as O,e as P,i as _}from"./index-877c6124.js";import{c as U}from"./index-7b37c3e4.js";import{n as F}from"./numeral-b3521269.js";import{C as T}from"./ChartLabel-6ddb1c8e.js";import{l as R}from"./leaderboards-1a095e3e.js";import"./index-0c1dbf60.js";import"./index.esm-8a8dc983.js";const M="TOURNAMENT/LOADING",$="TOURNAMENT/SUCCESS",G="TOURNAMENT/ERROR",V=()=>async n=>{n({type:M});try{const o=await n(w({url:`${D}/tournament/info`}));return n({type:$,data:o}),o}catch(o){return n({type:G,error:o}),null}};function W(){const n=B(),o=k(),[c,v]=g.useState(null),i=N(a=>a.tournament.data),f=N(a=>a.results.profiles),E=N(a=>a.tournament.isLoading),y=N(a=>t.get("player.id",a.user.data));if(g.useEffect(()=>{o(V())},[o]),g.useEffect(()=>{if(y&&!c&&t.get("brackets",i)){const a=t.find(l=>l.playerIds.includes(y),i.brackets);a&&v(a)}},[y,c,i]),E||t.isEmpty(f))return e.jsx(A,{});const{tournament:m,brackets:I}=i;if(!m)return null;const S=new Date(m.start_date),b=S.toLocaleString("default",{month:"long"}),C=`${S.getFullYear()} ${b}`;return e.jsxs("div",{className:"tournaments-page",children:[e.jsx("header",{children:C}),e.jsxs("div",{className:"description",children:[e.jsxs("div",{className:"labeled-item",children:[e.jsx("div",{className:"title",children:n.START_DATE}),e.jsx("div",{className:"text",children:new Date(m.start_date).toLocaleDateString()})]}),e.jsxs("div",{className:"labeled-item",children:[e.jsx("div",{className:"title",children:n.END_DATE}),e.jsx("div",{className:"text",children:new Date(m.end_date).toLocaleDateString()})]})]}),e.jsx("div",{className:"brackets-title",children:n.BRACKETS}),e.jsx("div",{className:"brackets",children:I.map(a=>e.jsxs("div",{className:U("bracket",{active:a.name===t.get("name",c)}),onClick:()=>v(a),children:[e.jsx("div",{className:"bracket-name",children:a.name}),a.charts.map(l=>{const[d,h]=R(l.label);return e.jsxs("div",{className:"chart",children:[e.jsx(T,{type:d,level:h})," ",l.trackName]},l.sharedChartId)})]},a.name))}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"results-title",children:n.RESULTS}),e.jsx("div",{className:"results",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"player-name",children:n.PLAYER}),e.jsx("th",{className:"total",children:n.TOTAL}),c.charts.map(a=>{const[l,d]=R(a.label);return e.jsx("th",{colSpan:2,children:e.jsxs("div",{className:"chart-header",children:[e.jsx(T,{type:l,level:d})," ",e.jsx(O,{exact:!0,to:P.leaderboard.sharedChart.getPath({sharedChartId:a.sharedChartId}),children:a.trackName})]})},a.sharedChartId)})]})}),e.jsx("tbody",{children:(()=>{const a=t.flow(t.groupBy("player_id"),t.mapValues(t.flow(t.map(s=>({...s,columnIndex:t.findIndex({sharedChartId:s.shared_chart},c.charts)})),t.groupBy("columnIndex"))))(c.scores),l=c.charts.map((s,r)=>({...s,maxScore:t.flow(t.values,t.flatMap(r),t.maxBy("score"),t.get("score"))(a)})),d=t.mapValues(t.flow(t.toPairs,t.map(([s,r])=>{const u=l[s].maxScore,x=t.flow(t.maxBy("score"),t.get("score"))(r),p=(x/u*100).toFixed(1);return[s,{playerName:r[0].player_name,score:x,percent:p,percentRaw:x/u}]}),s=>{const r=t.sumBy("[1].percentRaw",s);return{infoByIndex:t.fromPairs(s),totalPercentRaw:r,totalPercent:(r*100).toFixed(1)}}),a),h=t.flow(t.keys,t.orderBy(s=>d[s].totalPercentRaw,["desc"]))(d),L=t.remove(s=>h.includes(t.toString(s))||!f[s],c.playerIds);return[...h,...L].map(s=>{const r=d[s]||{},u=t.get("name",f[s])||r.playerName;return e.jsxs("tr",{children:[e.jsx("td",{className:"player-name",children:u}),e.jsx("td",{className:"total",children:r.totalPercent||0}),c.charts.map((x,p)=>{const j=r.infoByIndex&&r.infoByIndex[p];return e.jsxs(_.Fragment,{children:[e.jsx("td",{children:j&&`${j.percent}%`}),e.jsx("td",{children:j&&F(j.score).format("0,0")})]},p)})]},s)})})()})]})})]})]})}export{W as default};
//# sourceMappingURL=Tournaments-0cae3a33.js.map
