import{j as t,G as D,a5 as S,x as q,N as ae,T as m,a6 as C,s as ce,m as oe,n as E,k as V,q as W,a3 as h,a7 as le,a8 as L,a4 as A,B as M,A as de,l as fe,r as y}from"./index-B6sVSm1a.js";import{_ as B}from"./fp-BnQ8qd1l.js";import{f as me,g as he,h as xe,i as pe,j as ue,G as ge,k as ye}from"./index.esm-CQ375GJp.js";import{b as O,f as R,u as je}from"./useFilter-DWMvfnB6.js";import{l as Fe,C as be,M as K,i as Ee,G as z,T as Se,A as Ce}from"./Grade-B1Ys0k-X.js";import{g as Ne}from"./timeAgo-CpSJDwxj.js";const Ae=()=>{const e=O(R);return[...e.playersAll??[],...e.playersNone??[],...e.playersSome??[],...e.sortChartsByPlayers??[]]},Q="%[a-f0-9]{2}",P=new RegExp("("+Q+")|([^%]+?)","gi"),G=new RegExp("("+Q+")+","gi");function I(e,r){try{return[decodeURIComponent(e.join(""))]}catch{}if(e.length===1)return e;r=r||1;const n=e.slice(0,r),s=e.slice(r);return Array.prototype.concat.call([],I(n),I(s))}function De(e){try{return decodeURIComponent(e)}catch{let r=e.match(P)||[];for(let n=1;n<r.length;n++)e=I(r,n).join(""),r=e.match(P)||[];return e}}function Ie(e){const r={"%FE%FF":"��","%FF%FE":"��"};let n=G.exec(e);for(;n;){try{r[n[0]]=decodeURIComponent(n[0])}catch{const i=De(n[0]);i!==n[0]&&(r[n[0]]=i)}n=G.exec(e)}r["%C2"]="�";const s=Object.keys(r);for(const i of s)e=e.replace(new RegExp(i,"g"),r[i]);return e}function we(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return decodeURIComponent(e)}catch{return Ie(e)}}function Y(e,r){if(!(typeof e=="string"&&typeof r=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e===""||r==="")return[];const n=e.indexOf(r);return n===-1?[]:[e.slice(0,n),e.slice(n+r.length)]}function Oe(e,r){const n={};if(Array.isArray(r))for(const s of r){const i=Object.getOwnPropertyDescriptor(e,s);i?.enumerable&&Object.defineProperty(n,s,i)}else for(const s of Reflect.ownKeys(e)){const i=Object.getOwnPropertyDescriptor(e,s);if(i.enumerable){const a=e[s];r(s,a,e)&&Object.defineProperty(n,s,i)}}return n}const Re=e=>e==null,Te=e=>encodeURIComponent(e).replace(/[!'()*]/g,r=>`%${r.charCodeAt(0).toString(16).toUpperCase()}`),w=Symbol("encodeFragmentIdentifier");function _e(e){switch(e.arrayFormat){case"index":return r=>(n,s)=>{const i=n.length;return s===void 0||e.skipNull&&s===null||e.skipEmptyString&&s===""?n:s===null?[...n,[f(r,e),"[",i,"]"].join("")]:[...n,[f(r,e),"[",f(i,e),"]=",f(s,e)].join("")]};case"bracket":return r=>(n,s)=>s===void 0||e.skipNull&&s===null||e.skipEmptyString&&s===""?n:s===null?[...n,[f(r,e),"[]"].join("")]:[...n,[f(r,e),"[]=",f(s,e)].join("")];case"colon-list-separator":return r=>(n,s)=>s===void 0||e.skipNull&&s===null||e.skipEmptyString&&s===""?n:s===null?[...n,[f(r,e),":list="].join("")]:[...n,[f(r,e),":list=",f(s,e)].join("")];case"comma":case"separator":case"bracket-separator":{const r=e.arrayFormat==="bracket-separator"?"[]=":"=";return n=>(s,i)=>i===void 0||e.skipNull&&i===null||e.skipEmptyString&&i===""?s:(i=i===null?"":i,s.length===0?[[f(n,e),r,f(i,e)].join("")]:[[s,f(i,e)].join(e.arrayFormatSeparator)])}default:return r=>(n,s)=>s===void 0||e.skipNull&&s===null||e.skipEmptyString&&s===""?n:s===null?[...n,f(r,e)]:[...n,[f(r,e),"=",f(s,e)].join("")]}}function $e(e){let r;switch(e.arrayFormat){case"index":return(n,s,i)=>{if(r=/\[(\d*)]$/.exec(n),n=n.replace(/\[\d*]$/,""),!r){i[n]=s;return}i[n]===void 0&&(i[n]={}),i[n][r[1]]=s};case"bracket":return(n,s,i)=>{if(r=/(\[])$/.exec(n),n=n.replace(/\[]$/,""),!r){i[n]=s;return}if(i[n]===void 0){i[n]=[s];return}i[n]=[...i[n],s]};case"colon-list-separator":return(n,s,i)=>{if(r=/(:list)$/.exec(n),n=n.replace(/:list$/,""),!r){i[n]=s;return}if(i[n]===void 0){i[n]=[s];return}i[n]=[...i[n],s]};case"comma":case"separator":return(n,s,i)=>{const a=typeof s=="string"&&s.includes(e.arrayFormatSeparator),c=typeof s=="string"&&!a&&x(s,e).includes(e.arrayFormatSeparator);s=c?x(s,e):s;const l=a||c?s.split(e.arrayFormatSeparator).map(u=>x(u,e)):s===null?s:x(s,e);i[n]=l};case"bracket-separator":return(n,s,i)=>{const a=/(\[])$/.test(n);if(n=n.replace(/\[]$/,""),!a){i[n]=s&&x(s,e);return}const c=s===null?[]:s.split(e.arrayFormatSeparator).map(l=>x(l,e));if(i[n]===void 0){i[n]=c;return}i[n]=[...i[n],...c]};default:return(n,s,i)=>{if(i[n]===void 0){i[n]=s;return}i[n]=[...[i[n]].flat(),s]}}}function J(e){if(typeof e!="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function f(e,r){return r.encode?r.strict?Te(e):encodeURIComponent(e):e}function x(e,r){return r.decode?we(e):e}function X(e){return Array.isArray(e)?e.sort():typeof e=="object"?X(Object.keys(e)).sort((r,n)=>Number(r)-Number(n)).map(r=>e[r]):e}function Z(e){const r=e.indexOf("#");return r!==-1&&(e=e.slice(0,r)),e}function Le(e){let r="";const n=e.indexOf("#");return n!==-1&&(r=e.slice(n)),r}function U(e,r){return r.parseNumbers&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?e=Number(e):r.parseBooleans&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")&&(e=e.toLowerCase()==="true"),e}function T(e){e=Z(e);const r=e.indexOf("?");return r===-1?"":e.slice(r+1)}function _(e,r){r={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,...r},J(r.arrayFormatSeparator);const n=$e(r),s=Object.create(null);if(typeof e!="string"||(e=e.trim().replace(/^[?#&]/,""),!e))return s;for(const i of e.split("&")){if(i==="")continue;const a=r.decode?i.replace(/\+/g," "):i;let[c,l]=Y(a,"=");c===void 0&&(c=a),l=l===void 0?null:["comma","separator","bracket-separator"].includes(r.arrayFormat)?l:x(l,r),n(x(c,r),l,s)}for(const[i,a]of Object.entries(s))if(typeof a=="object"&&a!==null)for(const[c,l]of Object.entries(a))a[c]=U(l,r);else s[i]=U(a,r);return r.sort===!1?s:(r.sort===!0?Object.keys(s).sort():Object.keys(s).sort(r.sort)).reduce((i,a)=>{const c=s[a];return c&&typeof c=="object"&&!Array.isArray(c)?i[a]=X(c):i[a]=c,i},Object.create(null))}function v(e,r){if(!e)return"";r={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...r},J(r.arrayFormatSeparator);const n=c=>r.skipNull&&Re(e[c])||r.skipEmptyString&&e[c]==="",s=_e(r),i={};for(const[c,l]of Object.entries(e))n(c)||(i[c]=l);const a=Object.keys(i);return r.sort!==!1&&a.sort(r.sort),a.map(c=>{const l=e[c];return l===void 0?"":l===null?f(c,r):Array.isArray(l)?l.length===0&&r.arrayFormat==="bracket-separator"?f(c,r)+"[]":l.reduce(s(c),[]).join("&"):f(c,r)+"="+f(l,r)}).filter(c=>c.length>0).join("&")}function ee(e,r){r={decode:!0,...r};let[n,s]=Y(e,"#");return n===void 0&&(n=e),{url:n?.split("?")?.[0]??"",query:_(T(e),r),...r&&r.parseFragmentIdentifier&&s?{fragmentIdentifier:x(s,r)}:{}}}function re(e,r){r={encode:!0,strict:!0,[w]:!0,...r};const n=Z(e.url).split("?")[0]||"",s=T(e.url),i={..._(s,{sort:!1}),...e.query};let a=v(i,r);a&&(a=`?${a}`);let c=Le(e.url);if(e.fragmentIdentifier){const l=new URL(n);l.hash=e.fragmentIdentifier,c=r[w]?l.hash:`#${e.fragmentIdentifier}`}return`${n}${a}${c}`}function ne(e,r,n){n={parseFragmentIdentifier:!0,[w]:!1,...n};const{url:s,query:i,fragmentIdentifier:a}=ee(e,n);return re({url:s,query:Oe(i,r),fragmentIdentifier:a},n)}function Me(e,r,n){const s=Array.isArray(r)?i=>!r.includes(i):(i,a)=>!r(i,a);return ne(e,s,n)}const Be=Object.freeze(Object.defineProperty({__proto__:null,exclude:Me,extract:T,parse:_,parseUrl:ee,pick:ne,stringify:v,stringifyUrl:re},Symbol.toStringTag,{value:"Module"})),te={24:"#48283a99",25:"#432a4e99",26:"#2d2a4e99",27:"#2a434e99"},H=["#4DB3FF","#80B300","#FF6655","#FF99E6","#33FFCC","#e633c8","#dbe812","#FF1A66","#991AFF","#E6B333","#1AB399","#4D8066","#CC9999","#00E680","#809980","#E6FF80","#1AFF33","#999933","#E6331A","#CCCC00","#66E64D","#4D80CC","#9900B3","#4DB380","#FF4D4D"],ze=({chart:e,children:r=null})=>{const n=e.otherChartInstances.slice().sort((a,c)=>c.mix-a.mix),[s,i]=Fe(e.label);return t.jsxs(D,{p:"xs",bdrs:"xl",gap:"sm",align:"center",children:[t.jsx(be,{type:s,level:i??"?"}),t.jsx(S,{flex:"1 1 0",size:"xl",lh:"xs",fw:"bold",component:ae,to:q.leaderboard.sharedChart.getPath({sharedChartId:e.id}),children:e.songName})," ",t.jsx(m,{component:"span",c:"dimmed",children:e.difficulty?`(${e.difficulty.toFixed(1)}) `:""}),t.jsx(S,{href:`https://youtube.com/results?${Be.stringify({search_query:`${e.songName} ${e.label}`.replace(/( -)|(- )/g," ")})}`,target:"_blank",rel:"noopener noreferrer",fz:"xl",lh:1,children:t.jsx(me,{})}),n.map(a=>a.level===e.level?null:t.jsxs(C,{color:te[a.mix],children:[K[a.mix],": ",a.label]},a.mix)),r]})},Pe=({resultId:e})=>t.jsxs("a",{href:`https://api.pumpking.top:3001/results/${e}/screenshot`,target:"_blank",rel:"noopener noreferrer",children:["screenshot ",t.jsx(he,{style:{fontSize:"80%"}})]}),Ge=()=>{const e=ce();return oe(E.admin.deleteResult.mutationOptions({onSuccess:()=>{e.invalidateQueries(E.charts.search.infiniteQueryFilter()),e.invalidateQueries(E.charts.chart.queryFilter()),e.invalidateQueries(E.players.stats.queryFilter())}}))},k={xx:26,phoenix:27},Ue=({mix:e})=>{const{scoring:r}=je();return!r||!k[r]?null:Ee(e)&&k[r]!==e?t.jsx(C,{color:te[e],children:K[e]}):null},He=!1,ke=(e,r)=>{if(r.recognitionType==="manual")return t.jsxs("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[!r.isExactGainedDate&&t.jsx("div",{children:e.EXACT_DATE_UNKNOWN}),t.jsxs("div",{children:[e.SCORE_ADDED_MANUALLY," ",new Date(r.added).toLocaleDateString()]}),r.isExactGainedDate&&t.jsxs("div",{children:[e.SCORE_WAS_TAKEN," ",new Date(r.gained).toLocaleDateString()]})]});if(r.isExactGainedDate)return new Date(r.gained).toLocaleDateString();{const n=r.recognitionType==null?`${e.FROM} my best ${e.OR} machine best`:r.recognitionType==="personal_best"?`${e.FROM} my best`:r.recognitionType==="machine_best"?`${e.FROM} machine best`:"???";return t.jsxs("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[t.jsx("div",{children:e.EXACT_DATE_UNKNOWN}),t.jsxs("div",{children:[e.SCORE_WAS_TAKEN," ",n]}),t.jsxs("div",{children:[e.DATE_RECORDED,": ",new Date(r.gained).toLocaleDateString()]})]})}},qe=({result:e,chart:r})=>{const n=V(),s=W(),i=O(R),a=i.sortChartsBy==="pp",c=e.playerId===s.data?.id,l=!!s.data?.is_admin,u=Ge(),N=async()=>{window.confirm(n.DELETE_RESULT_CONFIRM)&&u.mutate({resultId:e.id})},o=e.playerId==null?null:q.profile.getPath({id:e.playerId});return t.jsxs("tr",{className:h({latest:e.isLatestScore}),style:e.highlightIndex>=0?{background:H[e.highlightIndex]+"3A",outline:`1px solid ${H[e.highlightIndex]}A0`}:{},children:[t.jsx("td",{className:"place",style:c?{fontWeight:"bold",color:"#ddd"}:{},children:`#${r.results.findIndex(d=>d.id===e.id)+1}`}),t.jsx("td",{className:h("nickname"),style:e.highlightIndex>=0||c?{fontWeight:"bold"}:{},children:t.jsxs(D,{gap:"xxs",align:"center",children:[e.region?t.jsx(le,{region:e.region,size:"sm"}):null,t.jsx(m,{style:{flex:"1 1 0",textOverflow:"ellipsis",overflow:"hidden"},children:o?t.jsx(S,{component:L,to:o,size:"sm",children:e.playerName}):t.jsx(m,{size:"sm",children:e.playerName})}),!!e.placeDifference&&t.jsxs("span",{className:"change-holder up",children:[t.jsx("span",{children:e.placeDifference}),t.jsx(xe,{})]}),a&&e.highlightIndex>=0&&t.jsxs("span",{className:"debug-elo-info",children:[" ",e.pp&&`${e.pp}pp`]}),t.jsxs(D,{gap:"0.25em",ml:"auto",wrap:"nowrap",children:[e.mods?.includes("HJ")&&t.jsx(C,{color:"orange",size:"xs",children:"HJ"}),e.mods?.includes("VJ")&&t.jsx(C,{color:"red",size:"xs",children:"R"}),t.jsx(Ue,{mix:e.mix})]})]})}),t.jsx("td",{className:h("score"),children:t.jsxs(A,{withArrow:!0,shadow:"sm",width:200,position:"top",children:[t.jsx(A.Target,{children:t.jsxs("span",{className:"score-span",children:[t.jsx("span",{children:Math.floor(e.score/1e3)}),t.jsxs("span",{style:{fontSize:"70%"},children:[",",`${e.score%1e3}`.padStart(3,"0")]})]})}),t.jsx(A.Dropdown,{p:"sm",children:t.jsxs(M,{children:[t.jsx(Pe,{resultId:e.id}),t.jsxs(M,{component:"dl",m:0,style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:"0.25rem 0.5rem"},children:[He,t.jsxs(m,{component:"dt",c:"dimmed",size:"sm",children:[n.PLAYER,":"]}),t.jsx(m,{component:"dd",m:0,size:"sm",children:o?t.jsxs(S,{component:L,to:o,children:[e.playerName," (",e.playerNameArcade,")"]}):`${e.playerName} (${e.playerNameArcade})`}),e.exp?t.jsxs(t.Fragment,{children:[t.jsxs(m,{component:"dt",c:"dimmed",size:"sm",fw:700,children:[n.EXP,":"]}),t.jsxs(m,{component:"dd",m:0,size:"sm",fw:700,bg:"dark.5",px:4,children:["+",e.exp]})]}):null,e.pp?t.jsxs(t.Fragment,{children:[t.jsxs(m,{component:"dt",c:"dimmed",size:"sm",fw:700,children:[n.PP,":"]}),t.jsxs(m,{component:"dd",m:0,size:"sm",fw:700,bg:"dark.5",px:4,children:[e.pp,"pp"]})]}):null,e.isExactGainedDate&&e.mods&&t.jsxs(t.Fragment,{children:[t.jsxs(m,{component:"dt",c:"dimmed",size:"sm",children:[n.MODS,":"]}),t.jsx(m,{component:"dd",m:0,size:"sm",children:e.mods})]}),e.isExactGainedDate&&e.combo!=null&&t.jsxs(t.Fragment,{children:[t.jsxs(m,{component:"dt",c:"dimmed",size:"sm",hiddenFrom:"sm",children:[n.COMBO,":"]}),t.jsx(m,{component:"dd",m:0,size:"sm",hiddenFrom:"sm",children:e.combo})]})]}),!e.isExactGainedDate&&t.jsx(de,{mt:"xs",lh:"xs",color:"yellow",p:"xxs",pl:"xs",pr:"xs",icon:t.jsx(pe,{}),styles:{message:{fontSize:"var(--mantine-font-size-sm)"}},children:n.MY_BEST_SCORE_WARNING}),e.isExactGainedDate&&!e.scoreIncrease&&t.jsx(m,{size:"sm",mt:"xs",children:n.SIGHTREAD}),l&&t.jsx(fe,{mt:"xs",size:"xs",color:"red",variant:"light",fullWidth:!0,leftSection:t.jsx(ue,{}),onClick:N,loading:u.isPending,children:n.DELETE_RESULT})]})})]})}),t.jsx("td",{className:h("grade"),children:t.jsx("div",{className:"img-holder",children:!i.scoring||i.scoring==="phoenix"?t.jsx(z,{w:"auto",h:"1rem",score:e.score,isPass:e.passed??!1,scoring:"phoenix"}):t.jsx(z,{w:"auto",h:"1rem",grade:e.grade,scoring:"xx"})})}),t.jsx("td",{className:h("number","miss"),children:e.stats[4]}),t.jsx("td",{className:h("number","bad"),children:e.stats[3]}),t.jsx("td",{className:h("number","good"),children:e.stats[2]}),t.jsx("td",{className:h("number","great"),children:e.stats[1]}),t.jsx("td",{className:h("number","perfect"),children:e.stats[0]}),t.jsx("td",{className:h("combo","desktop-only"),children:e.combo&&`${e.combo}x`}),t.jsx("td",{className:h("date",{latest:e.isLatestScore}),children:t.jsx(Se,{label:ke(n,e),children:t.jsxs("div",{children:[Ne(n,new Date(e.gained)),e.isExactGainedDate?"":"?"]})})})]},e.id)};function Ve(e){return ge({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8ZM7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708l2-2ZM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10Z"}}]})(e)}const We=({children:e,count:r})=>{const[n,s]=y.useState(!0),i=V();return n&&r>1?t.jsx("tr",{className:"results-collapser",onClick:()=>s(!1),children:t.jsx("td",{colSpan:"20",children:t.jsx("div",{children:t.jsx("button",{children:r&&i.SHOW_MORE_RESULTS?t.jsx(t.Fragment,{children:i.SHOW_MORE_RESULTS(r)}):t.jsx(Ve,{})})})})}):t.jsx(t.Fragment,{children:e})},er=y.memo(function({chart:r}){const n=W().data?.id,s=O(R),i=Ae(),[a,c]=y.useState(!1),l=r.results.reduce((o,d)=>d.isHidden?o+1:o,0),u=r.results.filter(o=>a||!o.isHidden).map((o,d,p)=>{const j=new Date(o.added).getTime()===new Date(r.updatedOn).getTime(),F=s.sortChartsBy==="pp"&&!s.sortChartsByPlayers?.length?p[0].playerId:null,b=(F?[F,...i]:i).indexOf(o.playerId??-1),g=j||o.playerId===n||b>=0;let $=0;if(o.scoreIncrease&&j){const se=o.score-o.scoreIncrease;$=B.findLastIndex(ie=>ie.score>se,p)-d}return{...o,topPlace:d+1,isImportant:g,highlightIndex:b,placeDifference:$,isLatestScore:j}}).map((o,d,p)=>{const F=p.slice(d+1,d+1+2).some(g=>g.isImportant),b=p.slice(d-2,d).some(g=>g.isImportant);return{...o,isCollapsible:!o.isImportant&&!F&&!b}}),N=u.reduce((o,d)=>(o.length?o[o.length-1].isGroupCollapsible!==d.isCollapsible?o.push({isGroupCollapsible:d.isCollapsible,results:[d]}):o[o.length-1].results.push(d):o.push({isGroupCollapsible:d.isCollapsible,results:[d]}),o),[]);return t.jsxs("div",{className:"song-block",children:[t.jsx(ze,{chart:r,children:l>0&&t.jsx(Ce,{variant:"subtle","aria-label":"Show all",onClick:()=>c(!a),children:t.jsx(ye,{})})}),t.jsx("div",{className:"charts",children:!B.isEmpty(u)&&t.jsx("div",{className:"chart",children:t.jsx("div",{className:"results",children:t.jsx("table",{children:t.jsx("tbody",{children:N.map(o=>{const d=o.results.map(p=>t.jsx(y.Fragment,{children:t.jsx(qe,{chart:r,result:p})},p.id));return o.isGroupCollapsible?t.jsx(We,{count:d.length,children:d},`group-${o.results[0].id}`):t.jsx(y.Fragment,{children:d},`group-${o.results[0].id}`)})})})})})})]})});export{er as C};
//# sourceMappingURL=Chart-DPYwS6Xi.js.map
