import{i as C,d as D,r as y,e as j,_ as a,a3 as E,j as e,T as P,c as R,a4 as T,P as _,f as A,R as F}from"./index-221eff9b.js";import{C as b,n as $}from"./ChartLabel-7048b637.js";function K(){const o=C(),g=D(),[n,v]=y.useState(null),d=j(s=>s.tournament.data),f=j(s=>s.results.profiles),I=j(s=>s.tournament.isLoading),N=j(s=>a.get("player.id",s.user.data));if(y.useEffect(()=>{g(E())},[g]),y.useEffect(()=>{if(N&&!n&&a.get("brackets",d)){const s=a.find(c=>c.playerIds.includes(N),d.brackets);s&&v(s)}},[N,n,d]),I||a.isEmpty(f))return e.jsx(P,{});const{tournament:i,brackets:w}=d;if(!i)return null;const S=new Date(i.start_date),L=S.toLocaleString("default",{month:"long"}),B=`${S.getFullYear()} ${L}`;return e.jsxs("div",{className:"tournaments-page",children:[e.jsx("header",{children:B}),e.jsxs("div",{className:"description",children:[e.jsxs("div",{className:"labeled-item",children:[e.jsx("div",{className:"title",children:o.START_DATE}),e.jsx("div",{className:"text",children:new Date(i.start_date).toLocaleDateString()})]}),e.jsxs("div",{className:"labeled-item",children:[e.jsx("div",{className:"title",children:o.END_DATE}),e.jsx("div",{className:"text",children:new Date(i.end_date).toLocaleDateString()})]})]}),e.jsx("div",{className:"brackets-title",children:o.BRACKETS}),e.jsx("div",{className:"brackets",children:w.map(s=>e.jsxs("div",{className:R("bracket",{active:s.name===a.get("name",n)}),onClick:()=>v(s),children:[e.jsx("div",{className:"bracket-name",children:s.name}),s.charts.map(c=>{const[l,m]=T(c.label);return e.jsxs("div",{className:"chart",children:[e.jsx(b,{type:l,level:m})," ",c.trackName]},c.sharedChartId)})]},s.name))}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"results-title",children:o.RESULTS}),e.jsx("div",{className:"results",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"player-name",children:o.PLAYER}),e.jsx("th",{className:"total",children:o.TOTAL}),n.charts.map(s=>{const[c,l]=T(s.label);return e.jsx("th",{colSpan:2,children:e.jsxs("div",{className:"chart-header",children:[e.jsx(b,{type:c,level:l})," ",e.jsx(_,{exact:!0,to:A.leaderboard.sharedChart.getPath({sharedChartId:s.sharedChartId}),children:s.trackName})]})},s.sharedChartId)})]})}),e.jsx("tbody",{children:(()=>{const s=a.flow(a.groupBy("player_id"),a.mapValues(a.flow(a.map(t=>({...t,columnIndex:a.findIndex({sharedChartId:t.shared_chart},n.charts)})),a.groupBy("columnIndex"))))(n.scores),c=n.charts.map((t,r)=>({...t,maxScore:a.flow(a.values,a.flatMap(r),a.maxBy("score"),a.get("score"))(s)})),l=a.mapValues(a.flow(a.toPairs,a.map(([t,r])=>{const h=c[t].maxScore,x=a.flow(a.maxBy("score"),a.get("score"))(r),u=(x/h*100).toFixed(1);return[t,{playerName:r[0].player_name,score:x,percent:u,percentRaw:x/h}]}),t=>{const r=a.sumBy("[1].percentRaw",t);return{infoByIndex:a.fromPairs(t),totalPercentRaw:r,totalPercent:(r*100).toFixed(1)}}),s),m=a.flow(a.keys,a.orderBy(t=>l[t].totalPercentRaw,["desc"]))(l),k=a.remove(t=>m.includes(a.toString(t))||!f[t],n.playerIds);return[...m,...k].map(t=>{const r=l[t]||{},h=a.get("name",f[t])||r.playerName;return e.jsxs("tr",{children:[e.jsx("td",{className:"player-name",children:h}),e.jsx("td",{className:"total",children:r.totalPercent||0}),n.charts.map((x,u)=>{const p=r.infoByIndex&&r.infoByIndex[u];return e.jsxs(F.Fragment,{children:[e.jsx("td",{children:p&&`${p.percent}%`}),e.jsx("td",{children:p&&$(p.score).format("0,0")})]},u)})]},t)})})()})]})})]})]})}export{K as default};
//# sourceMappingURL=Tournaments-7d91d4da.js.map
